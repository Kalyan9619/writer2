{"ast":null,"code":"/*!\n * FilePondPluginImageTransform 3.7.4\n * Licensed under MIT, https://opensource.org/licenses/MIT/\n * Please visit https://pqina.nl/filepond/ for details.\n */\n\n/* eslint-disable */\n(function (global, factory) {\n  typeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory() : typeof define === 'function' && define.amd ? define(factory) : (global = global || self, global.FilePondPluginImageTransform = factory());\n})(this, function () {\n  'use strict'; // test if file is of type image\n\n  var isImage = function isImage(file) {\n    return /^image/.test(file.type);\n  };\n\n  var getFilenameWithoutExtension = function getFilenameWithoutExtension(name) {\n    return name.substr(0, name.lastIndexOf('.')) || name;\n  }; // only handles image/jpg, image/jpeg, image/png, and image/svg+xml for now\n\n\n  var ExtensionMap = {\n    jpeg: 'jpg',\n    'svg+xml': 'svg'\n  };\n\n  var renameFileToMatchMimeType = function renameFileToMatchMimeType(filename, mimeType) {\n    var name = getFilenameWithoutExtension(filename);\n    var type = mimeType.split('/')[1];\n    var extension = ExtensionMap[type] || type;\n    return ''.concat(name, '.').concat(extension);\n  }; // returns all the valid output formats we can encode towards\n\n\n  var getValidOutputMimeType = function getValidOutputMimeType(type) {\n    return /jpeg|png|svg\\+xml/.test(type) ? type : 'image/jpeg';\n  }; // test if file is of type image\n\n\n  var isImage$1 = function isImage(file) {\n    return /^image/.test(file.type);\n  };\n\n  var MATRICES = {\n    1: function _() {\n      return [1, 0, 0, 1, 0, 0];\n    },\n    2: function _(width) {\n      return [-1, 0, 0, 1, width, 0];\n    },\n    3: function _(width, height) {\n      return [-1, 0, 0, -1, width, height];\n    },\n    4: function _(width, height) {\n      return [1, 0, 0, -1, 0, height];\n    },\n    5: function _() {\n      return [0, 1, 1, 0, 0, 0];\n    },\n    6: function _(width, height) {\n      return [0, 1, -1, 0, height, 0];\n    },\n    7: function _(width, height) {\n      return [0, -1, -1, 0, height, width];\n    },\n    8: function _(width) {\n      return [0, -1, 1, 0, 0, width];\n    }\n  };\n\n  var getImageOrientationMatrix = function getImageOrientationMatrix(width, height, orientation) {\n    if (orientation === -1) {\n      orientation = 1;\n    }\n\n    return MATRICES[orientation](width, height);\n  };\n\n  var createVector = function createVector(x, y) {\n    return {\n      x: x,\n      y: y\n    };\n  };\n\n  var vectorDot = function vectorDot(a, b) {\n    return a.x * b.x + a.y * b.y;\n  };\n\n  var vectorSubtract = function vectorSubtract(a, b) {\n    return createVector(a.x - b.x, a.y - b.y);\n  };\n\n  var vectorDistanceSquared = function vectorDistanceSquared(a, b) {\n    return vectorDot(vectorSubtract(a, b), vectorSubtract(a, b));\n  };\n\n  var vectorDistance = function vectorDistance(a, b) {\n    return Math.sqrt(vectorDistanceSquared(a, b));\n  };\n\n  var getOffsetPointOnEdge = function getOffsetPointOnEdge(length, rotation) {\n    var a = length;\n    var A = 1.5707963267948966;\n    var B = rotation;\n    var C = 1.5707963267948966 - rotation;\n    var sinA = Math.sin(A);\n    var sinB = Math.sin(B);\n    var sinC = Math.sin(C);\n    var cosC = Math.cos(C);\n    var ratio = a / sinA;\n    var b = ratio * sinB;\n    var c = ratio * sinC;\n    return createVector(cosC * b, cosC * c);\n  };\n\n  var getRotatedRectSize = function getRotatedRectSize(rect, rotation) {\n    var w = rect.width;\n    var h = rect.height;\n    var hor = getOffsetPointOnEdge(w, rotation);\n    var ver = getOffsetPointOnEdge(h, rotation);\n    var tl = createVector(rect.x + Math.abs(hor.x), rect.y - Math.abs(hor.y));\n    var tr = createVector(rect.x + rect.width + Math.abs(ver.y), rect.y + Math.abs(ver.x));\n    var bl = createVector(rect.x - Math.abs(ver.y), rect.y + rect.height - Math.abs(ver.x));\n    return {\n      width: vectorDistance(tl, tr),\n      height: vectorDistance(tl, bl)\n    };\n  };\n\n  var getImageRectZoomFactor = function getImageRectZoomFactor(imageRect, cropRect) {\n    var rotation = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;\n    var center = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : {\n      x: 0.5,\n      y: 0.5\n    }; // calculate available space round image center position\n\n    var cx = center.x > 0.5 ? 1 - center.x : center.x;\n    var cy = center.y > 0.5 ? 1 - center.y : center.y;\n    var imageWidth = cx * 2 * imageRect.width;\n    var imageHeight = cy * 2 * imageRect.height; // calculate rotated crop rectangle size\n\n    var rotatedCropSize = getRotatedRectSize(cropRect, rotation);\n    return Math.max(rotatedCropSize.width / imageWidth, rotatedCropSize.height / imageHeight);\n  };\n\n  var getCenteredCropRect = function getCenteredCropRect(container, aspectRatio) {\n    var width = container.width;\n    var height = width * aspectRatio;\n\n    if (height > container.height) {\n      height = container.height;\n      width = height / aspectRatio;\n    }\n\n    var x = (container.width - width) * 0.5;\n    var y = (container.height - height) * 0.5;\n    return {\n      x: x,\n      y: y,\n      width: width,\n      height: height\n    };\n  };\n\n  var calculateCanvasSize = function calculateCanvasSize(image, canvasAspectRatio) {\n    var zoom = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 1;\n    var imageAspectRatio = image.height / image.width; // determine actual pixels on x and y axis\n\n    var canvasWidth = 1;\n    var canvasHeight = canvasAspectRatio;\n    var imgWidth = 1;\n    var imgHeight = imageAspectRatio;\n\n    if (imgHeight > canvasHeight) {\n      imgHeight = canvasHeight;\n      imgWidth = imgHeight / imageAspectRatio;\n    }\n\n    var scalar = Math.max(canvasWidth / imgWidth, canvasHeight / imgHeight);\n    var width = image.width / (zoom * scalar * imgWidth);\n    var height = width * canvasAspectRatio;\n    return {\n      width: width,\n      height: height\n    };\n  };\n\n  var canvasRelease = function canvasRelease(canvas) {\n    canvas.width = 1;\n    canvas.height = 1;\n    var ctx = canvas.getContext('2d');\n    ctx.clearRect(0, 0, 1, 1);\n  };\n\n  var isFlipped = function isFlipped(flip) {\n    return flip && (flip.horizontal || flip.vertical);\n  };\n\n  var getBitmap = function getBitmap(image, orientation, flip) {\n    if (orientation <= 1 && !isFlipped(flip)) {\n      image.width = image.naturalWidth;\n      image.height = image.naturalHeight;\n      return image;\n    }\n\n    var canvas = document.createElement('canvas');\n    var width = image.naturalWidth;\n    var height = image.naturalHeight; // if is rotated incorrectly swap width and height\n\n    var swapped = orientation >= 5 && orientation <= 8;\n\n    if (swapped) {\n      canvas.width = height;\n      canvas.height = width;\n    } else {\n      canvas.width = width;\n      canvas.height = height;\n    } // draw the image but first fix orientation and set correct flip\n\n\n    var ctx = canvas.getContext('2d'); // get base transformation matrix\n\n    if (orientation) {\n      ctx.transform.apply(ctx, getImageOrientationMatrix(width, height, orientation));\n    }\n\n    if (isFlipped(flip)) {\n      // flip horizontal\n      // [-1, 0, 0, 1, width, 0]\n      var matrix = [1, 0, 0, 1, 0, 0];\n\n      if (!swapped && flip.horizontal || swapped & flip.vertical) {\n        matrix[0] = -1;\n        matrix[4] = width;\n      } // flip vertical\n      // [1, 0, 0, -1, 0, height]\n\n\n      if (!swapped && flip.vertical || swapped && flip.horizontal) {\n        matrix[3] = -1;\n        matrix[5] = height;\n      }\n\n      ctx.transform.apply(ctx, matrix);\n    }\n\n    ctx.drawImage(image, 0, 0, width, height);\n    return canvas;\n  };\n\n  var imageToImageData = function imageToImageData(imageElement, orientation) {\n    var crop = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n    var options = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : {};\n    var canvasMemoryLimit = options.canvasMemoryLimit,\n        _options$background = options.background,\n        background = _options$background === void 0 ? null : _options$background;\n    var zoom = crop.zoom || 1; // fixes possible image orientation problems by drawing the image on the correct canvas\n\n    var bitmap = getBitmap(imageElement, orientation, crop.flip);\n    var imageSize = {\n      width: bitmap.width,\n      height: bitmap.height\n    };\n    var aspectRatio = crop.aspectRatio || imageSize.height / imageSize.width;\n    var canvasSize = calculateCanvasSize(imageSize, aspectRatio, zoom);\n\n    if (canvasMemoryLimit) {\n      var requiredMemory = canvasSize.width * canvasSize.height;\n\n      if (requiredMemory > canvasMemoryLimit) {\n        var scalar = Math.sqrt(canvasMemoryLimit) / Math.sqrt(requiredMemory);\n        imageSize.width = Math.floor(imageSize.width * scalar);\n        imageSize.height = Math.floor(imageSize.height * scalar);\n        canvasSize = calculateCanvasSize(imageSize, aspectRatio, zoom);\n      }\n    }\n\n    var canvas = document.createElement('canvas');\n    var canvasCenter = {\n      x: canvasSize.width * 0.5,\n      y: canvasSize.height * 0.5\n    };\n    var stage = {\n      x: 0,\n      y: 0,\n      width: canvasSize.width,\n      height: canvasSize.height,\n      center: canvasCenter\n    };\n    var shouldLimit = typeof crop.scaleToFit === 'undefined' || crop.scaleToFit;\n    var scale = zoom * getImageRectZoomFactor(imageSize, getCenteredCropRect(stage, aspectRatio), crop.rotation, shouldLimit ? crop.center : {\n      x: 0.5,\n      y: 0.5\n    }); // start drawing\n\n    canvas.width = Math.round(canvasSize.width / scale);\n    canvas.height = Math.round(canvasSize.height / scale);\n    canvasCenter.x /= scale;\n    canvasCenter.y /= scale;\n    var imageOffset = {\n      x: canvasCenter.x - imageSize.width * (crop.center ? crop.center.x : 0.5),\n      y: canvasCenter.y - imageSize.height * (crop.center ? crop.center.y : 0.5)\n    };\n    var ctx = canvas.getContext('2d');\n\n    if (background) {\n      ctx.fillStyle = background;\n      ctx.fillRect(0, 0, canvas.width, canvas.height);\n    } // move to draw offset\n\n\n    ctx.translate(canvasCenter.x, canvasCenter.y);\n    ctx.rotate(crop.rotation || 0); // draw the image\n\n    ctx.drawImage(bitmap, imageOffset.x - canvasCenter.x, imageOffset.y - canvasCenter.y, imageSize.width, imageSize.height); // get data from canvas\n\n    var imageData = ctx.getImageData(0, 0, canvas.width, canvas.height); // release canvas\n\n    canvasRelease(canvas); // return data\n\n    return imageData;\n  };\n  /**\n   * Polyfill toBlob for Edge\n   */\n\n\n  var IS_BROWSER = function () {\n    return typeof window !== 'undefined' && typeof window.document !== 'undefined';\n  }();\n\n  if (IS_BROWSER) {\n    if (!HTMLCanvasElement.prototype.toBlob) {\n      Object.defineProperty(HTMLCanvasElement.prototype, 'toBlob', {\n        value: function value(callback, type, quality) {\n          var dataURL = this.toDataURL(type, quality).split(',')[1];\n          setTimeout(function () {\n            var binStr = atob(dataURL);\n            var len = binStr.length;\n            var arr = new Uint8Array(len);\n\n            for (var i = 0; i < len; i++) {\n              arr[i] = binStr.charCodeAt(i);\n            }\n\n            callback(new Blob([arr], {\n              type: type || 'image/png'\n            }));\n          });\n        }\n      });\n    }\n  }\n\n  var canvasToBlob = function canvasToBlob(canvas, options) {\n    var beforeCreateBlob = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;\n    return new Promise(function (resolve) {\n      var promisedImage = beforeCreateBlob ? beforeCreateBlob(canvas) : canvas;\n      Promise.resolve(promisedImage).then(function (canvas) {\n        canvas.toBlob(resolve, options.type, options.quality);\n      });\n    });\n  };\n\n  var vectorMultiply = function vectorMultiply(v, amount) {\n    return createVector$1(v.x * amount, v.y * amount);\n  };\n\n  var vectorAdd = function vectorAdd(a, b) {\n    return createVector$1(a.x + b.x, a.y + b.y);\n  };\n\n  var vectorNormalize = function vectorNormalize(v) {\n    var l = Math.sqrt(v.x * v.x + v.y * v.y);\n\n    if (l === 0) {\n      return {\n        x: 0,\n        y: 0\n      };\n    }\n\n    return createVector$1(v.x / l, v.y / l);\n  };\n\n  var vectorRotate = function vectorRotate(v, radians, origin) {\n    var cos = Math.cos(radians);\n    var sin = Math.sin(radians);\n    var t = createVector$1(v.x - origin.x, v.y - origin.y);\n    return createVector$1(origin.x + cos * t.x - sin * t.y, origin.y + sin * t.x + cos * t.y);\n  };\n\n  var createVector$1 = function createVector() {\n    var x = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 0;\n    var y = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;\n    return {\n      x: x,\n      y: y\n    };\n  };\n\n  var getMarkupValue = function getMarkupValue(value, size) {\n    var scalar = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 1;\n    var axis = arguments.length > 3 ? arguments[3] : undefined;\n\n    if (typeof value === 'string') {\n      return parseFloat(value) * scalar;\n    }\n\n    if (typeof value === 'number') {\n      return value * (axis ? size[axis] : Math.min(size.width, size.height));\n    }\n\n    return;\n  };\n\n  var getMarkupStyles = function getMarkupStyles(markup, size, scale) {\n    var lineStyle = markup.borderStyle || markup.lineStyle || 'solid';\n    var fill = markup.backgroundColor || markup.fontColor || 'transparent';\n    var stroke = markup.borderColor || markup.lineColor || 'transparent';\n    var strokeWidth = getMarkupValue(markup.borderWidth || markup.lineWidth, size, scale);\n    var lineCap = markup.lineCap || 'round';\n    var lineJoin = markup.lineJoin || 'round';\n    var dashes = typeof lineStyle === 'string' ? '' : lineStyle.map(function (v) {\n      return getMarkupValue(v, size, scale);\n    }).join(',');\n    var opacity = markup.opacity || 1;\n    return {\n      'stroke-linecap': lineCap,\n      'stroke-linejoin': lineJoin,\n      'stroke-width': strokeWidth || 0,\n      'stroke-dasharray': dashes,\n      stroke: stroke,\n      fill: fill,\n      opacity: opacity\n    };\n  };\n\n  var isDefined = function isDefined(value) {\n    return value != null;\n  };\n\n  var getMarkupRect = function getMarkupRect(rect, size) {\n    var scalar = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 1;\n    var left = getMarkupValue(rect.x, size, scalar, 'width') || getMarkupValue(rect.left, size, scalar, 'width');\n    var top = getMarkupValue(rect.y, size, scalar, 'height') || getMarkupValue(rect.top, size, scalar, 'height');\n    var width = getMarkupValue(rect.width, size, scalar, 'width');\n    var height = getMarkupValue(rect.height, size, scalar, 'height');\n    var right = getMarkupValue(rect.right, size, scalar, 'width');\n    var bottom = getMarkupValue(rect.bottom, size, scalar, 'height');\n\n    if (!isDefined(top)) {\n      if (isDefined(height) && isDefined(bottom)) {\n        top = size.height - height - bottom;\n      } else {\n        top = bottom;\n      }\n    }\n\n    if (!isDefined(left)) {\n      if (isDefined(width) && isDefined(right)) {\n        left = size.width - width - right;\n      } else {\n        left = right;\n      }\n    }\n\n    if (!isDefined(width)) {\n      if (isDefined(left) && isDefined(right)) {\n        width = size.width - left - right;\n      } else {\n        width = 0;\n      }\n    }\n\n    if (!isDefined(height)) {\n      if (isDefined(top) && isDefined(bottom)) {\n        height = size.height - top - bottom;\n      } else {\n        height = 0;\n      }\n    }\n\n    return {\n      x: left || 0,\n      y: top || 0,\n      width: width || 0,\n      height: height || 0\n    };\n  };\n\n  var pointsToPathShape = function pointsToPathShape(points) {\n    return points.map(function (point, index) {\n      return ''.concat(index === 0 ? 'M' : 'L', ' ').concat(point.x, ' ').concat(point.y);\n    }).join(' ');\n  };\n\n  var setAttributes = function setAttributes(element, attr) {\n    return Object.keys(attr).forEach(function (key) {\n      return element.setAttribute(key, attr[key]);\n    });\n  };\n\n  var ns = 'http://www.w3.org/2000/svg';\n\n  var svg = function svg(tag, attr) {\n    var element = document.createElementNS(ns, tag);\n\n    if (attr) {\n      setAttributes(element, attr);\n    }\n\n    return element;\n  };\n\n  var updateRect = function updateRect(element) {\n    return setAttributes(element, Object.assign({}, element.rect, element.styles));\n  };\n\n  var updateEllipse = function updateEllipse(element) {\n    var cx = element.rect.x + element.rect.width * 0.5;\n    var cy = element.rect.y + element.rect.height * 0.5;\n    var rx = element.rect.width * 0.5;\n    var ry = element.rect.height * 0.5;\n    return setAttributes(element, Object.assign({\n      cx: cx,\n      cy: cy,\n      rx: rx,\n      ry: ry\n    }, element.styles));\n  };\n\n  var IMAGE_FIT_STYLE = {\n    contain: 'xMidYMid meet',\n    cover: 'xMidYMid slice'\n  };\n\n  var updateImage = function updateImage(element, markup) {\n    setAttributes(element, Object.assign({}, element.rect, element.styles, {\n      preserveAspectRatio: IMAGE_FIT_STYLE[markup.fit] || 'none'\n    }));\n  };\n\n  var TEXT_ANCHOR = {\n    left: 'start',\n    center: 'middle',\n    right: 'end'\n  };\n\n  var updateText = function updateText(element, markup, size, scale) {\n    var fontSize = getMarkupValue(markup.fontSize, size, scale);\n    var fontFamily = markup.fontFamily || 'sans-serif';\n    var fontWeight = markup.fontWeight || 'normal';\n    var textAlign = TEXT_ANCHOR[markup.textAlign] || 'start';\n    setAttributes(element, Object.assign({}, element.rect, element.styles, {\n      'stroke-width': 0,\n      'font-weight': fontWeight,\n      'font-size': fontSize,\n      'font-family': fontFamily,\n      'text-anchor': textAlign\n    })); // update text\n\n    if (element.text !== markup.text) {\n      element.text = markup.text;\n      element.textContent = markup.text.length ? markup.text : ' ';\n    }\n  };\n\n  var updateLine = function updateLine(element, markup, size, scale) {\n    setAttributes(element, Object.assign({}, element.rect, element.styles, {\n      fill: 'none'\n    }));\n    var line = element.childNodes[0];\n    var begin = element.childNodes[1];\n    var end = element.childNodes[2];\n    var origin = element.rect;\n    var target = {\n      x: element.rect.x + element.rect.width,\n      y: element.rect.y + element.rect.height\n    };\n    setAttributes(line, {\n      x1: origin.x,\n      y1: origin.y,\n      x2: target.x,\n      y2: target.y\n    });\n    if (!markup.lineDecoration) return;\n    begin.style.display = 'none';\n    end.style.display = 'none';\n    var v = vectorNormalize({\n      x: target.x - origin.x,\n      y: target.y - origin.y\n    });\n    var l = getMarkupValue(0.05, size, scale);\n\n    if (markup.lineDecoration.indexOf('arrow-begin') !== -1) {\n      var arrowBeginRotationPoint = vectorMultiply(v, l);\n      var arrowBeginCenter = vectorAdd(origin, arrowBeginRotationPoint);\n      var arrowBeginA = vectorRotate(origin, 2, arrowBeginCenter);\n      var arrowBeginB = vectorRotate(origin, -2, arrowBeginCenter);\n      setAttributes(begin, {\n        style: 'display:block;',\n        d: 'M'.concat(arrowBeginA.x, ',').concat(arrowBeginA.y, ' L').concat(origin.x, ',').concat(origin.y, ' L').concat(arrowBeginB.x, ',').concat(arrowBeginB.y)\n      });\n    }\n\n    if (markup.lineDecoration.indexOf('arrow-end') !== -1) {\n      var arrowEndRotationPoint = vectorMultiply(v, -l);\n      var arrowEndCenter = vectorAdd(target, arrowEndRotationPoint);\n      var arrowEndA = vectorRotate(target, 2, arrowEndCenter);\n      var arrowEndB = vectorRotate(target, -2, arrowEndCenter);\n      setAttributes(end, {\n        style: 'display:block;',\n        d: 'M'.concat(arrowEndA.x, ',').concat(arrowEndA.y, ' L').concat(target.x, ',').concat(target.y, ' L').concat(arrowEndB.x, ',').concat(arrowEndB.y)\n      });\n    }\n  };\n\n  var updatePath = function updatePath(element, markup, size, scale) {\n    setAttributes(element, Object.assign({}, element.styles, {\n      fill: 'none',\n      d: pointsToPathShape(markup.points.map(function (point) {\n        return {\n          x: getMarkupValue(point.x, size, scale, 'width'),\n          y: getMarkupValue(point.y, size, scale, 'height')\n        };\n      }))\n    }));\n  };\n\n  var createShape = function createShape(node) {\n    return function (markup) {\n      return svg(node, {\n        id: markup.id\n      });\n    };\n  };\n\n  var createImage = function createImage(markup) {\n    var shape = svg('image', {\n      id: markup.id,\n      'stroke-linecap': 'round',\n      'stroke-linejoin': 'round',\n      opacity: '0'\n    });\n\n    shape.onload = function () {\n      shape.setAttribute('opacity', markup.opacity || 1);\n    };\n\n    shape.setAttributeNS('http://www.w3.org/1999/xlink', 'xlink:href', markup.src);\n    return shape;\n  };\n\n  var createLine = function createLine(markup) {\n    var shape = svg('g', {\n      id: markup.id,\n      'stroke-linecap': 'round',\n      'stroke-linejoin': 'round'\n    });\n    var line = svg('line');\n    shape.appendChild(line);\n    var begin = svg('path');\n    shape.appendChild(begin);\n    var end = svg('path');\n    shape.appendChild(end);\n    return shape;\n  };\n\n  var CREATE_TYPE_ROUTES = {\n    image: createImage,\n    rect: createShape('rect'),\n    ellipse: createShape('ellipse'),\n    text: createShape('text'),\n    path: createShape('path'),\n    line: createLine\n  };\n  var UPDATE_TYPE_ROUTES = {\n    rect: updateRect,\n    ellipse: updateEllipse,\n    image: updateImage,\n    text: updateText,\n    path: updatePath,\n    line: updateLine\n  };\n\n  var createMarkupByType = function createMarkupByType(type, markup) {\n    return CREATE_TYPE_ROUTES[type](markup);\n  };\n\n  var updateMarkupByType = function updateMarkupByType(element, type, markup, size, scale) {\n    if (type !== 'path') {\n      element.rect = getMarkupRect(markup, size, scale);\n    }\n\n    element.styles = getMarkupStyles(markup, size, scale);\n    UPDATE_TYPE_ROUTES[type](element, markup, size, scale);\n  };\n\n  var sortMarkupByZIndex = function sortMarkupByZIndex(a, b) {\n    if (a[1].zIndex > b[1].zIndex) {\n      return 1;\n    }\n\n    if (a[1].zIndex < b[1].zIndex) {\n      return -1;\n    }\n\n    return 0;\n  };\n\n  var cropSVG = function cropSVG(blob) {\n    var crop = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    var markup = arguments.length > 2 ? arguments[2] : undefined;\n    var options = arguments.length > 3 ? arguments[3] : undefined;\n    return new Promise(function (resolve) {\n      var _options$background = options.background,\n          background = _options$background === void 0 ? null : _options$background; // load blob contents and wrap in crop svg\n\n      var fr = new FileReader();\n\n      fr.onloadend = function () {\n        // get svg text\n        var text = fr.result; // create element with svg and get size\n\n        var original = document.createElement('div');\n        original.style.cssText = 'position:absolute;pointer-events:none;width:0;height:0;visibility:hidden;';\n        original.innerHTML = text;\n        var originalNode = original.querySelector('svg');\n        document.body.appendChild(original); // request bounding box dimensions\n\n        var bBox = originalNode.getBBox();\n        original.parentNode.removeChild(original); // get title\n\n        var titleNode = original.querySelector('title'); // calculate new heights and widths\n\n        var viewBoxAttribute = originalNode.getAttribute('viewBox') || '';\n        var widthAttribute = originalNode.getAttribute('width') || '';\n        var heightAttribute = originalNode.getAttribute('height') || '';\n        var width = parseFloat(widthAttribute) || null;\n        var height = parseFloat(heightAttribute) || null;\n        var widthUnits = (widthAttribute.match(/[a-z]+/) || [])[0] || '';\n        var heightUnits = (heightAttribute.match(/[a-z]+/) || [])[0] || ''; // create new size\n\n        var viewBoxList = viewBoxAttribute.split(' ').map(parseFloat);\n        var viewBox = viewBoxList.length ? {\n          x: viewBoxList[0],\n          y: viewBoxList[1],\n          width: viewBoxList[2],\n          height: viewBoxList[3]\n        } : bBox;\n        var imageWidth = width != null ? width : viewBox.width;\n        var imageHeight = height != null ? height : viewBox.height;\n        originalNode.style.overflow = 'visible';\n        originalNode.setAttribute('width', imageWidth);\n        originalNode.setAttribute('height', imageHeight); // markup\n\n        var markupSVG = '';\n\n        if (markup && markup.length) {\n          var size = {\n            width: imageWidth,\n            height: imageHeight\n          };\n          markupSVG = markup.sort(sortMarkupByZIndex).reduce(function (prev, shape) {\n            var el = createMarkupByType(shape[0], shape[1]);\n            updateMarkupByType(el, shape[0], shape[1], size);\n            el.removeAttribute('id');\n\n            if (el.getAttribute('opacity') === 1) {\n              el.removeAttribute('opacity');\n            }\n\n            return prev + '\\n' + el.outerHTML + '\\n';\n          }, '');\n          markupSVG = '\\n\\n<g>'.concat(markupSVG.replace(/&nbsp;/g, ' '), '</g>\\n\\n');\n        }\n\n        var aspectRatio = crop.aspectRatio || imageHeight / imageWidth;\n        var canvasWidth = imageWidth;\n        var canvasHeight = canvasWidth * aspectRatio;\n        var shouldLimit = typeof crop.scaleToFit === 'undefined' || crop.scaleToFit;\n        var cropCenterX = crop.center ? crop.center.x : 0.5;\n        var cropCenterY = crop.center ? crop.center.y : 0.5;\n        var canvasZoomFactor = getImageRectZoomFactor({\n          width: imageWidth,\n          height: imageHeight\n        }, getCenteredCropRect({\n          width: canvasWidth,\n          height: canvasHeight\n        }, aspectRatio), crop.rotation, shouldLimit ? {\n          x: cropCenterX,\n          y: cropCenterY\n        } : {\n          x: 0.5,\n          y: 0.5\n        });\n        var scale = crop.zoom * canvasZoomFactor;\n        var rotation = crop.rotation * (180 / Math.PI);\n        var canvasCenter = {\n          x: canvasWidth * 0.5,\n          y: canvasHeight * 0.5\n        };\n        var imageOffset = {\n          x: canvasCenter.x - imageWidth * cropCenterX,\n          y: canvasCenter.y - imageHeight * cropCenterY\n        };\n        var cropTransforms = [// rotate\n        'rotate('.concat(rotation, ' ').concat(canvasCenter.x, ' ').concat(canvasCenter.y, ')'), // scale\n        'translate('.concat(canvasCenter.x, ' ').concat(canvasCenter.y, ')'), 'scale('.concat(scale, ')'), 'translate('.concat(-canvasCenter.x, ' ').concat(-canvasCenter.y, ')'), // offset\n        'translate('.concat(imageOffset.x, ' ').concat(imageOffset.y, ')')];\n        var cropFlipHorizontal = crop.flip && crop.flip.horizontal;\n        var cropFlipVertical = crop.flip && crop.flip.vertical;\n        var flipTransforms = ['scale('.concat(cropFlipHorizontal ? -1 : 1, ' ').concat(cropFlipVertical ? -1 : 1, ')'), 'translate('.concat(cropFlipHorizontal ? -imageWidth : 0, ' ').concat(cropFlipVertical ? -imageHeight : 0, ')')]; // crop\n\n        var transformed = '<?xml version=\"1.0\" encoding=\"UTF-8\"?>\\n<svg width=\"'.concat(canvasWidth).concat(widthUnits, '\" height=\"').concat(canvasHeight).concat(heightUnits, '\" \\nviewBox=\"0 0 ').concat(canvasWidth, ' ').concat(canvasHeight, '\" ').concat(background ? 'style=\"background:' + background + '\" ' : '', '\\npreserveAspectRatio=\"xMinYMin\"\\nxmlns:xlink=\"http://www.w3.org/1999/xlink\"\\nxmlns=\"http://www.w3.org/2000/svg\">\\n<!-- Generated by PQINA - https://pqina.nl/ -->\\n<title>').concat(titleNode ? titleNode.textContent : '', '</title>\\n<g transform=\"').concat(cropTransforms.join(' '), '\">\\n<g transform=\"').concat(flipTransforms.join(' '), '\">\\n').concat(originalNode.outerHTML).concat(markupSVG, '\\n</g>\\n</g>\\n</svg>'); // create new svg file\n\n        resolve(transformed);\n      };\n\n      fr.readAsText(blob);\n    });\n  };\n\n  var objectToImageData = function objectToImageData(obj) {\n    var imageData;\n\n    try {\n      imageData = new ImageData(obj.width, obj.height);\n    } catch (e) {\n      // IE + Old EDGE (tested on 12)\n      var canvas = document.createElement('canvas');\n      imageData = canvas.getContext('2d').createImageData(obj.width, obj.height);\n    }\n\n    imageData.data.set(obj.data);\n    return imageData;\n  };\n  /* javascript-obfuscator:disable */\n\n\n  var TransformWorker = function TransformWorker() {\n    // maps transform types to transform functions\n    var TRANSFORMS = {\n      resize: resize,\n      filter: filter\n    }; // applies all image transforms to the image data array\n\n    var applyTransforms = function applyTransforms(transforms, imageData) {\n      transforms.forEach(function (transform) {\n        imageData = TRANSFORMS[transform.type](imageData, transform.data);\n      });\n      return imageData;\n    }; // transform image hub\n\n\n    var transform = function transform(data, cb) {\n      var transforms = data.transforms; // if has filter and has resize, move filter to resize operation\n\n      var filterTransform = null;\n      transforms.forEach(function (transform) {\n        if (transform.type === 'filter') {\n          filterTransform = transform;\n        }\n      });\n\n      if (filterTransform) {\n        // find resize\n        var resizeTransform = null;\n        transforms.forEach(function (transform) {\n          if (transform.type === 'resize') {\n            resizeTransform = transform;\n          }\n        });\n\n        if (resizeTransform) {\n          // update resize operation\n          resizeTransform.data.matrix = filterTransform.data; // remove filter\n\n          transforms = transforms.filter(function (transform) {\n            return transform.type !== 'filter';\n          });\n        }\n      }\n\n      cb(applyTransforms(transforms, data.imageData));\n    }; // eslint-disable-next-line no-restricted-globals\n\n\n    self.onmessage = function (e) {\n      transform(e.data.message, function (response) {\n        // eslint-disable-next-line no-restricted-globals\n        self.postMessage({\n          id: e.data.id,\n          message: response\n        }, [response.data.buffer]);\n      });\n    };\n\n    var br = 1.0;\n    var bg = 1.0;\n    var bb = 1.0;\n\n    function applyFilterMatrix(index, data, m) {\n      var ir = data[index] / 255;\n      var ig = data[index + 1] / 255;\n      var ib = data[index + 2] / 255;\n      var ia = data[index + 3] / 255;\n      var mr = ir * m[0] + ig * m[1] + ib * m[2] + ia * m[3] + m[4];\n      var mg = ir * m[5] + ig * m[6] + ib * m[7] + ia * m[8] + m[9];\n      var mb = ir * m[10] + ig * m[11] + ib * m[12] + ia * m[13] + m[14];\n      var ma = ir * m[15] + ig * m[16] + ib * m[17] + ia * m[18] + m[19];\n      var or = Math.max(0, mr * ma) + br * (1.0 - ma);\n      var og = Math.max(0, mg * ma) + bg * (1.0 - ma);\n      var ob = Math.max(0, mb * ma) + bb * (1.0 - ma);\n      data[index] = Math.max(0.0, Math.min(1.0, or)) * 255;\n      data[index + 1] = Math.max(0.0, Math.min(1.0, og)) * 255;\n      data[index + 2] = Math.max(0.0, Math.min(1.0, ob)) * 255;\n    }\n\n    var identityMatrix = self.JSON.stringify([1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0]);\n\n    function isIdentityMatrix(filter) {\n      return self.JSON.stringify(filter || []) === identityMatrix;\n    }\n\n    function filter(imageData, matrix) {\n      if (!matrix || isIdentityMatrix(matrix)) return imageData;\n      var data = imageData.data;\n      var l = data.length;\n      var m11 = matrix[0];\n      var m12 = matrix[1];\n      var m13 = matrix[2];\n      var m14 = matrix[3];\n      var m15 = matrix[4];\n      var m21 = matrix[5];\n      var m22 = matrix[6];\n      var m23 = matrix[7];\n      var m24 = matrix[8];\n      var m25 = matrix[9];\n      var m31 = matrix[10];\n      var m32 = matrix[11];\n      var m33 = matrix[12];\n      var m34 = matrix[13];\n      var m35 = matrix[14];\n      var m41 = matrix[15];\n      var m42 = matrix[16];\n      var m43 = matrix[17];\n      var m44 = matrix[18];\n      var m45 = matrix[19];\n      var index = 0,\n          r = 0.0,\n          g = 0.0,\n          b = 0.0,\n          a = 0.0,\n          mr = 0.0,\n          mg = 0.0,\n          mb = 0.0,\n          ma = 0.0,\n          or = 0.0,\n          og = 0.0,\n          ob = 0.0;\n\n      for (; index < l; index += 4) {\n        r = data[index] / 255;\n        g = data[index + 1] / 255;\n        b = data[index + 2] / 255;\n        a = data[index + 3] / 255;\n        mr = r * m11 + g * m12 + b * m13 + a * m14 + m15;\n        mg = r * m21 + g * m22 + b * m23 + a * m24 + m25;\n        mb = r * m31 + g * m32 + b * m33 + a * m34 + m35;\n        ma = r * m41 + g * m42 + b * m43 + a * m44 + m45;\n        or = Math.max(0, mr * ma) + br * (1.0 - ma);\n        og = Math.max(0, mg * ma) + bg * (1.0 - ma);\n        ob = Math.max(0, mb * ma) + bb * (1.0 - ma);\n        data[index] = Math.max(0.0, Math.min(1.0, or)) * 255;\n        data[index + 1] = Math.max(0.0, Math.min(1.0, og)) * 255;\n        data[index + 2] = Math.max(0.0, Math.min(1.0, ob)) * 255; // don't update alpha value\n      }\n\n      return imageData;\n    }\n\n    function resize(imageData, data) {\n      var _data$mode = data.mode,\n          mode = _data$mode === void 0 ? 'contain' : _data$mode,\n          _data$upscale = data.upscale,\n          upscale = _data$upscale === void 0 ? false : _data$upscale,\n          width = data.width,\n          height = data.height,\n          matrix = data.matrix; // test if is identity matrix\n\n      matrix = !matrix || isIdentityMatrix(matrix) ? null : matrix; // need at least a width or a height\n      // also 0 is not a valid width or height\n\n      if (!width && !height) {\n        return filter(imageData, matrix);\n      } // make sure all bounds are set\n\n\n      if (width === null) {\n        width = height;\n      } else if (height === null) {\n        height = width;\n      }\n\n      if (mode !== 'force') {\n        var scalarWidth = width / imageData.width;\n        var scalarHeight = height / imageData.height;\n        var scalar = 1;\n\n        if (mode === 'cover') {\n          scalar = Math.max(scalarWidth, scalarHeight);\n        } else if (mode === 'contain') {\n          scalar = Math.min(scalarWidth, scalarHeight);\n        } // if image is too small, exit here with original image\n\n\n        if (scalar > 1 && upscale === false) {\n          return filter(imageData, matrix);\n        }\n\n        width = imageData.width * scalar;\n        height = imageData.height * scalar;\n      }\n\n      var originWidth = imageData.width;\n      var originHeight = imageData.height;\n      var targetWidth = Math.round(width);\n      var targetHeight = Math.round(height);\n      var inputData = imageData.data;\n      var outputData = new Uint8ClampedArray(targetWidth * targetHeight * 4);\n      var ratioWidth = originWidth / targetWidth;\n      var ratioHeight = originHeight / targetHeight;\n      var ratioWidthHalf = Math.ceil(ratioWidth * 0.5);\n      var ratioHeightHalf = Math.ceil(ratioHeight * 0.5);\n\n      for (var j = 0; j < targetHeight; j++) {\n        for (var i = 0; i < targetWidth; i++) {\n          var x2 = (i + j * targetWidth) * 4;\n          var weight = 0;\n          var weights = 0;\n          var weightsAlpha = 0;\n          var r = 0;\n          var g = 0;\n          var b = 0;\n          var a = 0;\n          var centerY = (j + 0.5) * ratioHeight;\n\n          for (var yy = Math.floor(j * ratioHeight); yy < (j + 1) * ratioHeight; yy++) {\n            var dy = Math.abs(centerY - (yy + 0.5)) / ratioHeightHalf;\n            var centerX = (i + 0.5) * ratioWidth;\n            var w0 = dy * dy;\n\n            for (var xx = Math.floor(i * ratioWidth); xx < (i + 1) * ratioWidth; xx++) {\n              var dx = Math.abs(centerX - (xx + 0.5)) / ratioWidthHalf;\n              var w = Math.sqrt(w0 + dx * dx);\n\n              if (w >= -1 && w <= 1) {\n                weight = 2 * w * w * w - 3 * w * w + 1;\n\n                if (weight > 0) {\n                  dx = 4 * (xx + yy * originWidth);\n                  var ref = inputData[dx + 3];\n                  a += weight * ref;\n                  weightsAlpha += weight;\n\n                  if (ref < 255) {\n                    weight = weight * ref / 250;\n                  }\n\n                  r += weight * inputData[dx];\n                  g += weight * inputData[dx + 1];\n                  b += weight * inputData[dx + 2];\n                  weights += weight;\n                }\n              }\n            }\n          }\n\n          outputData[x2] = r / weights;\n          outputData[x2 + 1] = g / weights;\n          outputData[x2 + 2] = b / weights;\n          outputData[x2 + 3] = a / weightsAlpha;\n          matrix && applyFilterMatrix(x2, outputData, matrix);\n        }\n      }\n\n      return {\n        data: outputData,\n        width: targetWidth,\n        height: targetHeight\n      };\n    }\n  };\n  /* javascript-obfuscator:enable */\n\n\n  var correctOrientation = function correctOrientation(view, offset) {\n    // Missing 0x45786966 Marker? No Exif Header, stop here\n    if (view.getUint32(offset + 4, false) !== 0x45786966) return; // next byte!\n\n    offset += 4; // First 2bytes defines byte align of TIFF data.\n    // If it is 0x4949=\"I I\", it means \"Intel\" type byte align\n\n    var intelByteAligned = view.getUint16(offset += 6, false) === 0x4949;\n    offset += view.getUint32(offset + 4, intelByteAligned);\n    var tags = view.getUint16(offset, intelByteAligned);\n    offset += 2; // find Orientation tag\n\n    for (var i = 0; i < tags; i++) {\n      if (view.getUint16(offset + i * 12, intelByteAligned) === 0x0112) {\n        view.setUint16(offset + i * 12 + 8, 1, intelByteAligned);\n        return true;\n      }\n    }\n\n    return false;\n  };\n\n  var readData = function readData(data) {\n    var view = new DataView(data); // Every JPEG file starts from binary value '0xFFD8'\n    // If it's not present, exit here\n\n    if (view.getUint16(0) !== 0xffd8) return null;\n    var offset = 2; // Start at 2 as we skipped two bytes (FFD8)\n\n    var marker;\n    var markerLength;\n    var orientationCorrected = false;\n\n    while (offset < view.byteLength) {\n      marker = view.getUint16(offset, false);\n      markerLength = view.getUint16(offset + 2, false) + 2; // Test if is APP and COM markers\n\n      var isData = marker >= 0xffe0 && marker <= 0xffef || marker === 0xfffe;\n\n      if (!isData) {\n        break;\n      }\n\n      if (!orientationCorrected) {\n        orientationCorrected = correctOrientation(view, offset, markerLength);\n      }\n\n      if (offset + markerLength > view.byteLength) {\n        break;\n      }\n\n      offset += markerLength;\n    }\n\n    return data.slice(0, offset);\n  };\n\n  var getImageHead = function getImageHead(file) {\n    return new Promise(function (resolve) {\n      var reader = new FileReader();\n\n      reader.onload = function () {\n        return resolve(readData(reader.result) || null);\n      };\n\n      reader.readAsArrayBuffer(file.slice(0, 256 * 1024));\n    });\n  };\n\n  var getBlobBuilder = function getBlobBuilder() {\n    return window.BlobBuilder = window.BlobBuilder || window.WebKitBlobBuilder || window.MozBlobBuilder || window.MSBlobBuilder;\n  };\n\n  var createBlob = function createBlob(arrayBuffer, mimeType) {\n    var BB = getBlobBuilder();\n\n    if (BB) {\n      var bb = new BB();\n      bb.append(arrayBuffer);\n      return bb.getBlob(mimeType);\n    }\n\n    return new Blob([arrayBuffer], {\n      type: mimeType\n    });\n  };\n\n  var getUniqueId = function getUniqueId() {\n    return Math.random().toString(36).substr(2, 9);\n  };\n\n  var createWorker = function createWorker(fn) {\n    var workerBlob = new Blob(['(', fn.toString(), ')()'], {\n      type: 'application/javascript'\n    });\n    var workerURL = URL.createObjectURL(workerBlob);\n    var worker = new Worker(workerURL);\n    var trips = [];\n    return {\n      transfer: function transfer() {},\n      // (message, cb) => {}\n      post: function post(message, cb, transferList) {\n        var id = getUniqueId();\n        trips[id] = cb;\n\n        worker.onmessage = function (e) {\n          var cb = trips[e.data.id];\n          if (!cb) return;\n          cb(e.data.message);\n          delete trips[e.data.id];\n        };\n\n        worker.postMessage({\n          id: id,\n          message: message\n        }, transferList);\n      },\n      terminate: function terminate() {\n        worker.terminate();\n        URL.revokeObjectURL(workerURL);\n      }\n    };\n  };\n\n  var loadImage = function loadImage(url) {\n    return new Promise(function (resolve, reject) {\n      var img = new Image();\n\n      img.onload = function () {\n        resolve(img);\n      };\n\n      img.onerror = function (e) {\n        reject(e);\n      };\n\n      img.src = url;\n    });\n  };\n\n  var chain = function chain(funcs) {\n    return funcs.reduce(function (promise, func) {\n      return promise.then(function (result) {\n        return func().then(Array.prototype.concat.bind(result));\n      });\n    }, Promise.resolve([]));\n  };\n\n  var canvasApplyMarkup = function canvasApplyMarkup(canvas, markup) {\n    return new Promise(function (resolve) {\n      var size = {\n        width: canvas.width,\n        height: canvas.height\n      };\n      var ctx = canvas.getContext('2d');\n      var drawers = markup.sort(sortMarkupByZIndex).map(function (item) {\n        return function () {\n          return new Promise(function (resolve) {\n            var result = TYPE_DRAW_ROUTES[item[0]](ctx, size, item[1], resolve);\n            if (result) resolve();\n          });\n        };\n      });\n      chain(drawers).then(function () {\n        return resolve(canvas);\n      });\n    });\n  };\n\n  var applyMarkupStyles = function applyMarkupStyles(ctx, styles) {\n    ctx.beginPath();\n    ctx.lineCap = styles['stroke-linecap'];\n    ctx.lineJoin = styles['stroke-linejoin'];\n    ctx.lineWidth = styles['stroke-width'];\n\n    if (styles['stroke-dasharray'].length) {\n      ctx.setLineDash(styles['stroke-dasharray'].split(','));\n    }\n\n    ctx.fillStyle = styles['fill'];\n    ctx.strokeStyle = styles['stroke'];\n    ctx.globalAlpha = styles.opacity || 1;\n  };\n\n  var drawMarkupStyles = function drawMarkupStyles(ctx) {\n    ctx.fill();\n    ctx.stroke();\n    ctx.globalAlpha = 1;\n  };\n\n  var drawRect = function drawRect(ctx, size, markup) {\n    var rect = getMarkupRect(markup, size);\n    var styles = getMarkupStyles(markup, size);\n    applyMarkupStyles(ctx, styles);\n    ctx.rect(rect.x, rect.y, rect.width, rect.height);\n    drawMarkupStyles(ctx, styles);\n    return true;\n  };\n\n  var drawEllipse = function drawEllipse(ctx, size, markup) {\n    var rect = getMarkupRect(markup, size);\n    var styles = getMarkupStyles(markup, size);\n    applyMarkupStyles(ctx, styles);\n    var x = rect.x,\n        y = rect.y,\n        w = rect.width,\n        h = rect.height,\n        kappa = 0.5522848,\n        ox = w / 2 * kappa,\n        oy = h / 2 * kappa,\n        xe = x + w,\n        ye = y + h,\n        xm = x + w / 2,\n        ym = y + h / 2;\n    ctx.moveTo(x, ym);\n    ctx.bezierCurveTo(x, ym - oy, xm - ox, y, xm, y);\n    ctx.bezierCurveTo(xm + ox, y, xe, ym - oy, xe, ym);\n    ctx.bezierCurveTo(xe, ym + oy, xm + ox, ye, xm, ye);\n    ctx.bezierCurveTo(xm - ox, ye, x, ym + oy, x, ym);\n    drawMarkupStyles(ctx, styles);\n    return true;\n  };\n\n  var drawImage = function drawImage(ctx, size, markup, done) {\n    var rect = getMarkupRect(markup, size);\n    var styles = getMarkupStyles(markup, size);\n    applyMarkupStyles(ctx, styles);\n    var image = new Image(); // if is cross origin image add cross origin attribute\n\n    var isCrossOriginImage = new URL(markup.src, window.location.href).origin !== window.location.origin;\n    if (isCrossOriginImage) image.crossOrigin = '';\n\n    image.onload = function () {\n      if (markup.fit === 'cover') {\n        var ar = rect.width / rect.height;\n        var width = ar > 1 ? image.width : image.height * ar;\n        var height = ar > 1 ? image.width / ar : image.height;\n        var x = image.width * 0.5 - width * 0.5;\n        var y = image.height * 0.5 - height * 0.5;\n        ctx.drawImage(image, x, y, width, height, rect.x, rect.y, rect.width, rect.height);\n      } else if (markup.fit === 'contain') {\n        var scalar = Math.min(rect.width / image.width, rect.height / image.height);\n\n        var _width = scalar * image.width;\n\n        var _height = scalar * image.height;\n\n        var _x = rect.x + rect.width * 0.5 - _width * 0.5;\n\n        var _y = rect.y + rect.height * 0.5 - _height * 0.5;\n\n        ctx.drawImage(image, 0, 0, image.width, image.height, _x, _y, _width, _height);\n      } else {\n        ctx.drawImage(image, 0, 0, image.width, image.height, rect.x, rect.y, rect.width, rect.height);\n      }\n\n      drawMarkupStyles(ctx, styles);\n      done();\n    };\n\n    image.src = markup.src;\n  };\n\n  var drawText = function drawText(ctx, size, markup) {\n    var rect = getMarkupRect(markup, size);\n    var styles = getMarkupStyles(markup, size);\n    applyMarkupStyles(ctx, styles);\n    var fontSize = getMarkupValue(markup.fontSize, size);\n    var fontFamily = markup.fontFamily || 'sans-serif';\n    var fontWeight = markup.fontWeight || 'normal';\n    var textAlign = markup.textAlign || 'left';\n    ctx.font = ''.concat(fontWeight, ' ').concat(fontSize, 'px ').concat(fontFamily);\n    ctx.textAlign = textAlign;\n    ctx.fillText(markup.text, rect.x, rect.y);\n    drawMarkupStyles(ctx, styles);\n    return true;\n  };\n\n  var drawPath = function drawPath(ctx, size, markup) {\n    var styles = getMarkupStyles(markup, size);\n    applyMarkupStyles(ctx, styles);\n    ctx.beginPath();\n    var points = markup.points.map(function (point) {\n      return {\n        x: getMarkupValue(point.x, size, 1, 'width'),\n        y: getMarkupValue(point.y, size, 1, 'height')\n      };\n    });\n    ctx.moveTo(points[0].x, points[0].y);\n    var l = points.length;\n\n    for (var i = 1; i < l; i++) {\n      ctx.lineTo(points[i].x, points[i].y);\n    }\n\n    drawMarkupStyles(ctx, styles);\n    return true;\n  };\n\n  var drawLine = function drawLine(ctx, size, markup) {\n    var rect = getMarkupRect(markup, size);\n    var styles = getMarkupStyles(markup, size);\n    applyMarkupStyles(ctx, styles);\n    ctx.beginPath();\n    var origin = {\n      x: rect.x,\n      y: rect.y\n    };\n    var target = {\n      x: rect.x + rect.width,\n      y: rect.y + rect.height\n    };\n    ctx.moveTo(origin.x, origin.y);\n    ctx.lineTo(target.x, target.y);\n    var v = vectorNormalize({\n      x: target.x - origin.x,\n      y: target.y - origin.y\n    });\n    var l = 0.04 * Math.min(size.width, size.height);\n\n    if (markup.lineDecoration.indexOf('arrow-begin') !== -1) {\n      var arrowBeginRotationPoint = vectorMultiply(v, l);\n      var arrowBeginCenter = vectorAdd(origin, arrowBeginRotationPoint);\n      var arrowBeginA = vectorRotate(origin, 2, arrowBeginCenter);\n      var arrowBeginB = vectorRotate(origin, -2, arrowBeginCenter);\n      ctx.moveTo(arrowBeginA.x, arrowBeginA.y);\n      ctx.lineTo(origin.x, origin.y);\n      ctx.lineTo(arrowBeginB.x, arrowBeginB.y);\n    }\n\n    if (markup.lineDecoration.indexOf('arrow-end') !== -1) {\n      var arrowEndRotationPoint = vectorMultiply(v, -l);\n      var arrowEndCenter = vectorAdd(target, arrowEndRotationPoint);\n      var arrowEndA = vectorRotate(target, 2, arrowEndCenter);\n      var arrowEndB = vectorRotate(target, -2, arrowEndCenter);\n      ctx.moveTo(arrowEndA.x, arrowEndA.y);\n      ctx.lineTo(target.x, target.y);\n      ctx.lineTo(arrowEndB.x, arrowEndB.y);\n    }\n\n    drawMarkupStyles(ctx, styles);\n    return true;\n  };\n\n  var TYPE_DRAW_ROUTES = {\n    rect: drawRect,\n    ellipse: drawEllipse,\n    image: drawImage,\n    text: drawText,\n    line: drawLine,\n    path: drawPath\n  };\n\n  var imageDataToCanvas = function imageDataToCanvas(imageData) {\n    var image = document.createElement('canvas');\n    image.width = imageData.width;\n    image.height = imageData.height;\n    var ctx = image.getContext('2d');\n    ctx.putImageData(imageData, 0, 0);\n    return image;\n  };\n\n  var transformImage = function transformImage(file, instructions) {\n    var options = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n    return new Promise(function (resolve, reject) {\n      // if the file is not an image we do not have any business transforming it\n      if (!file || !isImage$1(file)) return reject({\n        status: 'not an image file',\n        file: file\n      }); // get separate options for easier use\n\n      var stripImageHead = options.stripImageHead,\n          beforeCreateBlob = options.beforeCreateBlob,\n          afterCreateBlob = options.afterCreateBlob,\n          canvasMemoryLimit = options.canvasMemoryLimit; // get crop\n\n      var crop = instructions.crop,\n          size = instructions.size,\n          filter = instructions.filter,\n          markup = instructions.markup,\n          output = instructions.output; // get exif orientation\n\n      var orientation = instructions.image && instructions.image.orientation ? Math.max(1, Math.min(8, instructions.image.orientation)) : null; // compression quality 0 => 100\n\n      var qualityAsPercentage = output && output.quality;\n      var quality = qualityAsPercentage === null ? null : qualityAsPercentage / 100; // output format\n\n      var type = output && output.type || null; // background color\n\n      var background = output && output.background || null; // get transforms\n\n      var transforms = []; // add resize transforms if set\n\n      if (size && (typeof size.width === 'number' || typeof size.height === 'number')) {\n        transforms.push({\n          type: 'resize',\n          data: size\n        });\n      } // add filters\n\n\n      if (filter && filter.length === 20) {\n        transforms.push({\n          type: 'filter',\n          data: filter\n        });\n      } // resolves with supplied blob\n\n\n      var resolveWithBlob = function resolveWithBlob(blob) {\n        var promisedBlob = afterCreateBlob ? afterCreateBlob(blob) : blob;\n        Promise.resolve(promisedBlob).then(resolve);\n      }; // done\n\n\n      var toBlob = function toBlob(imageData, options) {\n        var canvas = imageDataToCanvas(imageData);\n        var promisedCanvas = markup.length ? canvasApplyMarkup(canvas, markup) : canvas;\n        Promise.resolve(promisedCanvas).then(function (canvas) {\n          canvasToBlob(canvas, options, beforeCreateBlob).then(function (blob) {\n            // force release of canvas memory\n            canvasRelease(canvas); // remove image head (default)\n\n            if (stripImageHead) return resolveWithBlob(blob); // try to copy image head from original file to generated blob\n\n            getImageHead(file).then(function (imageHead) {\n              // re-inject image head in case of JPEG, as the image head is removed by canvas export\n              if (imageHead !== null) {\n                blob = new Blob([imageHead, blob.slice(20)], {\n                  type: blob.type\n                });\n              } // done!\n\n\n              resolveWithBlob(blob);\n            });\n          }).catch(reject);\n        });\n      }; // if this is an svg and we want it to stay an svg\n\n\n      if (/svg/.test(file.type) && type === null) {\n        return cropSVG(file, crop, markup, {\n          background: background\n        }).then(function (text) {\n          resolve(createBlob(text, 'image/svg+xml'));\n        });\n      } // get file url\n\n\n      var url = URL.createObjectURL(file); // turn the file into an image\n\n      loadImage(url).then(function (image) {\n        // url is no longer needed\n        URL.revokeObjectURL(url); // draw to canvas and start transform chain\n\n        var imageData = imageToImageData(image, orientation, crop, {\n          canvasMemoryLimit: canvasMemoryLimit,\n          background: background\n        }); // determine the format of the blob that we will output\n\n        var outputFormat = {\n          quality: quality,\n          type: type || file.type\n        }; // no transforms necessary, we done!\n\n        if (!transforms.length) {\n          return toBlob(imageData, outputFormat);\n        } // send to the transform worker to transform the blob on a separate thread\n\n\n        var worker = createWorker(TransformWorker);\n        worker.post({\n          transforms: transforms,\n          imageData: imageData\n        }, function (response) {\n          // finish up\n          toBlob(objectToImageData(response), outputFormat); // stop worker\n\n          worker.terminate();\n        }, [imageData.data.buffer]);\n      }).catch(reject);\n    });\n  };\n\n  function _typeof(obj) {\n    if (typeof Symbol === 'function' && typeof Symbol.iterator === 'symbol') {\n      _typeof = function _typeof(obj) {\n        return typeof obj;\n      };\n    } else {\n      _typeof = function _typeof(obj) {\n        return obj && typeof Symbol === 'function' && obj.constructor === Symbol && obj !== Symbol.prototype ? 'symbol' : typeof obj;\n      };\n    }\n\n    return _typeof(obj);\n  }\n\n  var REACT_ELEMENT_TYPE;\n\n  function _jsx(type, props, key, children) {\n    if (!REACT_ELEMENT_TYPE) {\n      REACT_ELEMENT_TYPE = typeof Symbol === 'function' && Symbol.for && Symbol.for('react.element') || 0xeac7;\n    }\n\n    var defaultProps = type && type.defaultProps;\n    var childrenLength = arguments.length - 3;\n\n    if (!props && childrenLength !== 0) {\n      props = {\n        children: void 0\n      };\n    }\n\n    if (props && defaultProps) {\n      for (var propName in defaultProps) {\n        if (props[propName] === void 0) {\n          props[propName] = defaultProps[propName];\n        }\n      }\n    } else if (!props) {\n      props = defaultProps || {};\n    }\n\n    if (childrenLength === 1) {\n      props.children = children;\n    } else if (childrenLength > 1) {\n      var childArray = new Array(childrenLength);\n\n      for (var i = 0; i < childrenLength; i++) {\n        childArray[i] = arguments[i + 3];\n      }\n\n      props.children = childArray;\n    }\n\n    return {\n      $$typeof: REACT_ELEMENT_TYPE,\n      type: type,\n      key: key === undefined ? null : '' + key,\n      ref: null,\n      props: props,\n      _owner: null\n    };\n  }\n\n  function _asyncIterator(iterable) {\n    var method;\n\n    if (typeof Symbol === 'function') {\n      if (Symbol.asyncIterator) {\n        method = iterable[Symbol.asyncIterator];\n        if (method != null) return method.call(iterable);\n      }\n\n      if (Symbol.iterator) {\n        method = iterable[Symbol.iterator];\n        if (method != null) return method.call(iterable);\n      }\n    }\n\n    throw new TypeError('Object is not async iterable');\n  }\n\n  function _AwaitValue(value) {\n    this.wrapped = value;\n  }\n\n  function _AsyncGenerator(gen) {\n    var front, back;\n\n    function send(key, arg) {\n      return new Promise(function (resolve, reject) {\n        var request = {\n          key: key,\n          arg: arg,\n          resolve: resolve,\n          reject: reject,\n          next: null\n        };\n\n        if (back) {\n          back = back.next = request;\n        } else {\n          front = back = request;\n          resume(key, arg);\n        }\n      });\n    }\n\n    function resume(key, arg) {\n      try {\n        var result = gen[key](arg);\n        var value = result.value;\n        var wrappedAwait = value instanceof _AwaitValue;\n        Promise.resolve(wrappedAwait ? value.wrapped : value).then(function (arg) {\n          if (wrappedAwait) {\n            resume('next', arg);\n            return;\n          }\n\n          settle(result.done ? 'return' : 'normal', arg);\n        }, function (err) {\n          resume('throw', err);\n        });\n      } catch (err) {\n        settle('throw', err);\n      }\n    }\n\n    function settle(type, value) {\n      switch (type) {\n        case 'return':\n          front.resolve({\n            value: value,\n            done: true\n          });\n          break;\n\n        case 'throw':\n          front.reject(value);\n          break;\n\n        default:\n          front.resolve({\n            value: value,\n            done: false\n          });\n          break;\n      }\n\n      front = front.next;\n\n      if (front) {\n        resume(front.key, front.arg);\n      } else {\n        back = null;\n      }\n    }\n\n    this._invoke = send;\n\n    if (typeof gen.return !== 'function') {\n      this.return = undefined;\n    }\n  }\n\n  if (typeof Symbol === 'function' && Symbol.asyncIterator) {\n    _AsyncGenerator.prototype[Symbol.asyncIterator] = function () {\n      return this;\n    };\n  }\n\n  _AsyncGenerator.prototype.next = function (arg) {\n    return this._invoke('next', arg);\n  };\n\n  _AsyncGenerator.prototype.throw = function (arg) {\n    return this._invoke('throw', arg);\n  };\n\n  _AsyncGenerator.prototype.return = function (arg) {\n    return this._invoke('return', arg);\n  };\n\n  function _wrapAsyncGenerator(fn) {\n    return function () {\n      return new _AsyncGenerator(fn.apply(this, arguments));\n    };\n  }\n\n  function _awaitAsyncGenerator(value) {\n    return new _AwaitValue(value);\n  }\n\n  function _asyncGeneratorDelegate(inner, awaitWrap) {\n    var iter = {},\n        waiting = false;\n\n    function pump(key, value) {\n      waiting = true;\n      value = new Promise(function (resolve) {\n        resolve(inner[key](value));\n      });\n      return {\n        done: false,\n        value: awaitWrap(value)\n      };\n    }\n\n    if (typeof Symbol === 'function' && Symbol.iterator) {\n      iter[Symbol.iterator] = function () {\n        return this;\n      };\n    }\n\n    iter.next = function (value) {\n      if (waiting) {\n        waiting = false;\n        return value;\n      }\n\n      return pump('next', value);\n    };\n\n    if (typeof inner.throw === 'function') {\n      iter.throw = function (value) {\n        if (waiting) {\n          waiting = false;\n          throw value;\n        }\n\n        return pump('throw', value);\n      };\n    }\n\n    if (typeof inner.return === 'function') {\n      iter.return = function (value) {\n        return pump('return', value);\n      };\n    }\n\n    return iter;\n  }\n\n  function asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) {\n    try {\n      var info = gen[key](arg);\n      var value = info.value;\n    } catch (error) {\n      reject(error);\n      return;\n    }\n\n    if (info.done) {\n      resolve(value);\n    } else {\n      Promise.resolve(value).then(_next, _throw);\n    }\n  }\n\n  function _asyncToGenerator(fn) {\n    return function () {\n      var self = this,\n          args = arguments;\n      return new Promise(function (resolve, reject) {\n        var gen = fn.apply(self, args);\n\n        function _next(value) {\n          asyncGeneratorStep(gen, resolve, reject, _next, _throw, 'next', value);\n        }\n\n        function _throw(err) {\n          asyncGeneratorStep(gen, resolve, reject, _next, _throw, 'throw', err);\n        }\n\n        _next(undefined);\n      });\n    };\n  }\n\n  function _classCallCheck(instance, Constructor) {\n    if (!(instance instanceof Constructor)) {\n      throw new TypeError('Cannot call a class as a function');\n    }\n  }\n\n  function _defineProperties(target, props) {\n    for (var i = 0; i < props.length; i++) {\n      var descriptor = props[i];\n      descriptor.enumerable = descriptor.enumerable || false;\n      descriptor.configurable = true;\n      if ('value' in descriptor) descriptor.writable = true;\n      Object.defineProperty(target, descriptor.key, descriptor);\n    }\n  }\n\n  function _createClass(Constructor, protoProps, staticProps) {\n    if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n    if (staticProps) _defineProperties(Constructor, staticProps);\n    return Constructor;\n  }\n\n  function _defineEnumerableProperties(obj, descs) {\n    for (var key in descs) {\n      var desc = descs[key];\n      desc.configurable = desc.enumerable = true;\n      if ('value' in desc) desc.writable = true;\n      Object.defineProperty(obj, key, desc);\n    }\n\n    if (Object.getOwnPropertySymbols) {\n      var objectSymbols = Object.getOwnPropertySymbols(descs);\n\n      for (var i = 0; i < objectSymbols.length; i++) {\n        var sym = objectSymbols[i];\n        var desc = descs[sym];\n        desc.configurable = desc.enumerable = true;\n        if ('value' in desc) desc.writable = true;\n        Object.defineProperty(obj, sym, desc);\n      }\n    }\n\n    return obj;\n  }\n\n  function _defaults(obj, defaults) {\n    var keys = Object.getOwnPropertyNames(defaults);\n\n    for (var i = 0; i < keys.length; i++) {\n      var key = keys[i];\n      var value = Object.getOwnPropertyDescriptor(defaults, key);\n\n      if (value && value.configurable && obj[key] === undefined) {\n        Object.defineProperty(obj, key, value);\n      }\n    }\n\n    return obj;\n  }\n\n  function _defineProperty(obj, key, value) {\n    if (key in obj) {\n      Object.defineProperty(obj, key, {\n        value: value,\n        enumerable: true,\n        configurable: true,\n        writable: true\n      });\n    } else {\n      obj[key] = value;\n    }\n\n    return obj;\n  }\n\n  function _extends() {\n    _extends = Object.assign || function (target) {\n      for (var i = 1; i < arguments.length; i++) {\n        var source = arguments[i];\n\n        for (var key in source) {\n          if (Object.prototype.hasOwnProperty.call(source, key)) {\n            target[key] = source[key];\n          }\n        }\n      }\n\n      return target;\n    };\n\n    return _extends.apply(this, arguments);\n  }\n\n  function _objectSpread(target) {\n    for (var i = 1; i < arguments.length; i++) {\n      var source = arguments[i] != null ? arguments[i] : {};\n      var ownKeys = Object.keys(source);\n\n      if (typeof Object.getOwnPropertySymbols === 'function') {\n        ownKeys = ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function (sym) {\n          return Object.getOwnPropertyDescriptor(source, sym).enumerable;\n        }));\n      }\n\n      ownKeys.forEach(function (key) {\n        _defineProperty(target, key, source[key]);\n      });\n    }\n\n    return target;\n  }\n\n  function _inherits(subClass, superClass) {\n    if (typeof superClass !== 'function' && superClass !== null) {\n      throw new TypeError('Super expression must either be null or a function');\n    }\n\n    subClass.prototype = Object.create(superClass && superClass.prototype, {\n      constructor: {\n        value: subClass,\n        writable: true,\n        configurable: true\n      }\n    });\n    if (superClass) _setPrototypeOf(subClass, superClass);\n  }\n\n  function _inheritsLoose(subClass, superClass) {\n    subClass.prototype = Object.create(superClass.prototype);\n    subClass.prototype.constructor = subClass;\n    subClass.__proto__ = superClass;\n  }\n\n  function _getPrototypeOf(o) {\n    _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) {\n      return o.__proto__ || Object.getPrototypeOf(o);\n    };\n    return _getPrototypeOf(o);\n  }\n\n  function _setPrototypeOf(o, p) {\n    _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) {\n      o.__proto__ = p;\n      return o;\n    };\n\n    return _setPrototypeOf(o, p);\n  }\n\n  function isNativeReflectConstruct() {\n    if (typeof Reflect === 'undefined' || !Reflect.construct) return false;\n    if (Reflect.construct.sham) return false;\n    if (typeof Proxy === 'function') return true;\n\n    try {\n      Date.prototype.toString.call(Reflect.construct(Date, [], function () {}));\n      return true;\n    } catch (e) {\n      return false;\n    }\n  }\n\n  function _construct(Parent, args, Class) {\n    if (isNativeReflectConstruct()) {\n      _construct = Reflect.construct;\n    } else {\n      _construct = function _construct(Parent, args, Class) {\n        var a = [null];\n        a.push.apply(a, args);\n        var Constructor = Function.bind.apply(Parent, a);\n        var instance = new Constructor();\n        if (Class) _setPrototypeOf(instance, Class.prototype);\n        return instance;\n      };\n    }\n\n    return _construct.apply(null, arguments);\n  }\n\n  function _isNativeFunction(fn) {\n    return Function.toString.call(fn).indexOf('[native code]') !== -1;\n  }\n\n  function _wrapNativeSuper(Class) {\n    var _cache = typeof Map === 'function' ? new Map() : undefined;\n\n    _wrapNativeSuper = function _wrapNativeSuper(Class) {\n      if (Class === null || !_isNativeFunction(Class)) return Class;\n\n      if (typeof Class !== 'function') {\n        throw new TypeError('Super expression must either be null or a function');\n      }\n\n      if (typeof _cache !== 'undefined') {\n        if (_cache.has(Class)) return _cache.get(Class);\n\n        _cache.set(Class, Wrapper);\n      }\n\n      function Wrapper() {\n        return _construct(Class, arguments, _getPrototypeOf(this).constructor);\n      }\n\n      Wrapper.prototype = Object.create(Class.prototype, {\n        constructor: {\n          value: Wrapper,\n          enumerable: false,\n          writable: true,\n          configurable: true\n        }\n      });\n      return _setPrototypeOf(Wrapper, Class);\n    };\n\n    return _wrapNativeSuper(Class);\n  }\n\n  function _instanceof(left, right) {\n    if (right != null && typeof Symbol !== 'undefined' && right[Symbol.hasInstance]) {\n      return right[Symbol.hasInstance](left);\n    } else {\n      return left instanceof right;\n    }\n  }\n\n  function _interopRequireDefault(obj) {\n    return obj && obj.__esModule ? obj : {\n      default: obj\n    };\n  }\n\n  function _interopRequireWildcard(obj) {\n    if (obj && obj.__esModule) {\n      return obj;\n    } else {\n      var newObj = {};\n\n      if (obj != null) {\n        for (var key in obj) {\n          if (Object.prototype.hasOwnProperty.call(obj, key)) {\n            var desc = Object.defineProperty && Object.getOwnPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : {};\n\n            if (desc.get || desc.set) {\n              Object.defineProperty(newObj, key, desc);\n            } else {\n              newObj[key] = obj[key];\n            }\n          }\n        }\n      }\n\n      newObj.default = obj;\n      return newObj;\n    }\n  }\n\n  function _newArrowCheck(innerThis, boundThis) {\n    if (innerThis !== boundThis) {\n      throw new TypeError('Cannot instantiate an arrow function');\n    }\n  }\n\n  function _objectDestructuringEmpty(obj) {\n    if (obj == null) throw new TypeError('Cannot destructure undefined');\n  }\n\n  function _objectWithoutPropertiesLoose(source, excluded) {\n    if (source == null) return {};\n    var target = {};\n    var sourceKeys = Object.keys(source);\n    var key, i;\n\n    for (i = 0; i < sourceKeys.length; i++) {\n      key = sourceKeys[i];\n      if (excluded.indexOf(key) >= 0) continue;\n      target[key] = source[key];\n    }\n\n    return target;\n  }\n\n  function _objectWithoutProperties(source, excluded) {\n    if (source == null) return {};\n\n    var target = _objectWithoutPropertiesLoose(source, excluded);\n\n    var key, i;\n\n    if (Object.getOwnPropertySymbols) {\n      var sourceSymbolKeys = Object.getOwnPropertySymbols(source);\n\n      for (i = 0; i < sourceSymbolKeys.length; i++) {\n        key = sourceSymbolKeys[i];\n        if (excluded.indexOf(key) >= 0) continue;\n        if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue;\n        target[key] = source[key];\n      }\n    }\n\n    return target;\n  }\n\n  function _assertThisInitialized(self) {\n    if (self === void 0) {\n      throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n    }\n\n    return self;\n  }\n\n  function _possibleConstructorReturn(self, call) {\n    if (call && (typeof call === 'object' || typeof call === 'function')) {\n      return call;\n    }\n\n    return _assertThisInitialized(self);\n  }\n\n  function _superPropBase(object, property) {\n    while (!Object.prototype.hasOwnProperty.call(object, property)) {\n      object = _getPrototypeOf(object);\n      if (object === null) break;\n    }\n\n    return object;\n  }\n\n  function _get(target, property, receiver) {\n    if (typeof Reflect !== 'undefined' && Reflect.get) {\n      _get = Reflect.get;\n    } else {\n      _get = function _get(target, property, receiver) {\n        var base = _superPropBase(target, property);\n\n        if (!base) return;\n        var desc = Object.getOwnPropertyDescriptor(base, property);\n\n        if (desc.get) {\n          return desc.get.call(receiver);\n        }\n\n        return desc.value;\n      };\n    }\n\n    return _get(target, property, receiver || target);\n  }\n\n  function set(target, property, value, receiver) {\n    if (typeof Reflect !== 'undefined' && Reflect.set) {\n      set = Reflect.set;\n    } else {\n      set = function set(target, property, value, receiver) {\n        var base = _superPropBase(target, property);\n\n        var desc;\n\n        if (base) {\n          desc = Object.getOwnPropertyDescriptor(base, property);\n\n          if (desc.set) {\n            desc.set.call(receiver, value);\n            return true;\n          } else if (!desc.writable) {\n            return false;\n          }\n        }\n\n        desc = Object.getOwnPropertyDescriptor(receiver, property);\n\n        if (desc) {\n          if (!desc.writable) {\n            return false;\n          }\n\n          desc.value = value;\n          Object.defineProperty(receiver, property, desc);\n        } else {\n          _defineProperty(receiver, property, value);\n        }\n\n        return true;\n      };\n    }\n\n    return set(target, property, value, receiver);\n  }\n\n  function _set(target, property, value, receiver, isStrict) {\n    var s = set(target, property, value, receiver || target);\n\n    if (!s && isStrict) {\n      throw new Error('failed to set property');\n    }\n\n    return value;\n  }\n\n  function _taggedTemplateLiteral(strings, raw) {\n    if (!raw) {\n      raw = strings.slice(0);\n    }\n\n    return Object.freeze(Object.defineProperties(strings, {\n      raw: {\n        value: Object.freeze(raw)\n      }\n    }));\n  }\n\n  function _taggedTemplateLiteralLoose(strings, raw) {\n    if (!raw) {\n      raw = strings.slice(0);\n    }\n\n    strings.raw = raw;\n    return strings;\n  }\n\n  function _temporalRef(val, name) {\n    if (val === _temporalUndefined) {\n      throw new ReferenceError(name + ' is not defined - temporal dead zone');\n    } else {\n      return val;\n    }\n  }\n\n  function _readOnlyError(name) {\n    throw new Error('\"' + name + '\" is read-only');\n  }\n\n  function _classNameTDZError(name) {\n    throw new Error('Class \"' + name + '\" cannot be referenced in computed property keys.');\n  }\n\n  var _temporalUndefined = {};\n\n  function _slicedToArray(arr, i) {\n    return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _nonIterableRest();\n  }\n\n  function _slicedToArrayLoose(arr, i) {\n    return _arrayWithHoles(arr) || _iterableToArrayLimitLoose(arr, i) || _nonIterableRest();\n  }\n\n  function _toArray(arr) {\n    return _arrayWithHoles(arr) || _iterableToArray(arr) || _nonIterableRest();\n  }\n\n  function _toConsumableArray(arr) {\n    return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _nonIterableSpread();\n  }\n\n  function _arrayWithoutHoles(arr) {\n    if (Array.isArray(arr)) {\n      for (var i = 0, arr2 = new Array(arr.length); i < arr.length; i++) {\n        arr2[i] = arr[i];\n      }\n\n      return arr2;\n    }\n  }\n\n  function _arrayWithHoles(arr) {\n    if (Array.isArray(arr)) return arr;\n  }\n\n  function _iterableToArray(iter) {\n    if (Symbol.iterator in Object(iter) || Object.prototype.toString.call(iter) === '[object Arguments]') return Array.from(iter);\n  }\n\n  function _iterableToArrayLimit(arr, i) {\n    var _arr = [];\n    var _n = true;\n    var _d = false;\n    var _e = undefined;\n\n    try {\n      for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) {\n        _arr.push(_s.value);\n\n        if (i && _arr.length === i) break;\n      }\n    } catch (err) {\n      _d = true;\n      _e = err;\n    } finally {\n      try {\n        if (!_n && _i['return'] != null) _i['return']();\n      } finally {\n        if (_d) throw _e;\n      }\n    }\n\n    return _arr;\n  }\n\n  function _iterableToArrayLimitLoose(arr, i) {\n    var _arr = [];\n\n    for (var _iterator = arr[Symbol.iterator](), _step; !(_step = _iterator.next()).done;) {\n      _arr.push(_step.value);\n\n      if (i && _arr.length === i) break;\n    }\n\n    return _arr;\n  }\n\n  function _nonIterableSpread() {\n    throw new TypeError('Invalid attempt to spread non-iterable instance');\n  }\n\n  function _nonIterableRest() {\n    throw new TypeError('Invalid attempt to destructure non-iterable instance');\n  }\n\n  function _skipFirstGeneratorNext(fn) {\n    return function () {\n      var it = fn.apply(this, arguments);\n      it.next();\n      return it;\n    };\n  }\n\n  function _toPrimitive(input, hint) {\n    if (typeof input !== 'object' || input === null) return input;\n    var prim = input[Symbol.toPrimitive];\n\n    if (prim !== undefined) {\n      var res = prim.call(input, hint || 'default');\n      if (typeof res !== 'object') return res;\n      throw new TypeError('@@toPrimitive must return a primitive value.');\n    }\n\n    return (hint === 'string' ? String : Number)(input);\n  }\n\n  function _toPropertyKey(arg) {\n    var key = _toPrimitive(arg, 'string');\n\n    return typeof key === 'symbol' ? key : String(key);\n  }\n\n  function _initializerWarningHelper(descriptor, context) {\n    throw new Error('Decorating class property failed. Please ensure that ' + 'proposal-class-properties is enabled and set to use loose mode. ' + 'To use proposal-class-properties in spec mode with decorators, wait for ' + 'the next major version of decorators in stage 2.');\n  }\n\n  function _initializerDefineProperty(target, property, descriptor, context) {\n    if (!descriptor) return;\n    Object.defineProperty(target, property, {\n      enumerable: descriptor.enumerable,\n      configurable: descriptor.configurable,\n      writable: descriptor.writable,\n      value: descriptor.initializer ? descriptor.initializer.call(context) : void 0\n    });\n  }\n\n  function _applyDecoratedDescriptor(target, property, decorators, descriptor, context) {\n    var desc = {};\n    Object.keys(descriptor).forEach(function (key) {\n      desc[key] = descriptor[key];\n    });\n    desc.enumerable = !!desc.enumerable;\n    desc.configurable = !!desc.configurable;\n\n    if ('value' in desc || desc.initializer) {\n      desc.writable = true;\n    }\n\n    desc = decorators.slice().reverse().reduce(function (desc, decorator) {\n      return decorator(target, property, desc) || desc;\n    }, desc);\n\n    if (context && desc.initializer !== void 0) {\n      desc.value = desc.initializer ? desc.initializer.call(context) : void 0;\n      desc.initializer = undefined;\n    }\n\n    if (desc.initializer === void 0) {\n      Object.defineProperty(target, property, desc);\n      desc = null;\n    }\n\n    return desc;\n  }\n\n  var id = 0;\n\n  function _classPrivateFieldLooseKey(name) {\n    return '__private_' + id++ + '_' + name;\n  }\n\n  function _classPrivateFieldLooseBase(receiver, privateKey) {\n    if (!Object.prototype.hasOwnProperty.call(receiver, privateKey)) {\n      throw new TypeError('attempted to use private field on non-instance');\n    }\n\n    return receiver;\n  }\n\n  function _classPrivateFieldGet(receiver, privateMap) {\n    if (!privateMap.has(receiver)) {\n      throw new TypeError('attempted to get private field on non-instance');\n    }\n\n    var descriptor = privateMap.get(receiver);\n\n    if (descriptor.get) {\n      return descriptor.get.call(receiver);\n    }\n\n    return descriptor.value;\n  }\n\n  function _classPrivateFieldSet(receiver, privateMap, value) {\n    if (!privateMap.has(receiver)) {\n      throw new TypeError('attempted to set private field on non-instance');\n    }\n\n    var descriptor = privateMap.get(receiver);\n\n    if (descriptor.set) {\n      descriptor.set.call(receiver, value);\n    } else {\n      if (!descriptor.writable) {\n        throw new TypeError('attempted to set read only private field');\n      }\n\n      descriptor.value = value;\n    }\n\n    return value;\n  }\n\n  function _classStaticPrivateFieldSpecGet(receiver, classConstructor, descriptor) {\n    if (receiver !== classConstructor) {\n      throw new TypeError('Private static access of wrong provenance');\n    }\n\n    return descriptor.value;\n  }\n\n  function _classStaticPrivateFieldSpecSet(receiver, classConstructor, descriptor, value) {\n    if (receiver !== classConstructor) {\n      throw new TypeError('Private static access of wrong provenance');\n    }\n\n    if (!descriptor.writable) {\n      throw new TypeError('attempted to set read only private field');\n    }\n\n    descriptor.value = value;\n    return value;\n  }\n\n  function _classStaticPrivateMethodGet(receiver, classConstructor, method) {\n    if (receiver !== classConstructor) {\n      throw new TypeError('Private static access of wrong provenance');\n    }\n\n    return method;\n  }\n\n  function _classStaticPrivateMethodSet() {\n    throw new TypeError('attempted to set read only static private field');\n  }\n\n  function _decorate(decorators, factory, superClass, mixins) {\n    var api = _getDecoratorsApi();\n\n    if (mixins) {\n      for (var i = 0; i < mixins.length; i++) {\n        api = mixins[i](api);\n      }\n    }\n\n    var r = factory(function initialize(O) {\n      api.initializeInstanceElements(O, decorated.elements);\n    }, superClass);\n    var decorated = api.decorateClass(_coalesceClassElements(r.d.map(_createElementDescriptor)), decorators);\n    api.initializeClassElements(r.F, decorated.elements);\n    return api.runClassFinishers(r.F, decorated.finishers);\n  }\n\n  function _getDecoratorsApi() {\n    _getDecoratorsApi = function _getDecoratorsApi() {\n      return api;\n    };\n\n    var api = {\n      elementsDefinitionOrder: [['method'], ['field']],\n      initializeInstanceElements: function initializeInstanceElements(O, elements) {\n        ['method', 'field'].forEach(function (kind) {\n          elements.forEach(function (element) {\n            if (element.kind === kind && element.placement === 'own') {\n              this.defineClassElement(O, element);\n            }\n          }, this);\n        }, this);\n      },\n      initializeClassElements: function initializeClassElements(F, elements) {\n        var proto = F.prototype;\n        ['method', 'field'].forEach(function (kind) {\n          elements.forEach(function (element) {\n            var placement = element.placement;\n\n            if (element.kind === kind && (placement === 'static' || placement === 'prototype')) {\n              var receiver = placement === 'static' ? F : proto;\n              this.defineClassElement(receiver, element);\n            }\n          }, this);\n        }, this);\n      },\n      defineClassElement: function defineClassElement(receiver, element) {\n        var descriptor = element.descriptor;\n\n        if (element.kind === 'field') {\n          var initializer = element.initializer;\n          descriptor = {\n            enumerable: descriptor.enumerable,\n            writable: descriptor.writable,\n            configurable: descriptor.configurable,\n            value: initializer === void 0 ? void 0 : initializer.call(receiver)\n          };\n        }\n\n        Object.defineProperty(receiver, element.key, descriptor);\n      },\n      decorateClass: function decorateClass(elements, decorators) {\n        var newElements = [];\n        var finishers = [];\n        var placements = {\n          static: [],\n          prototype: [],\n          own: []\n        };\n        elements.forEach(function (element) {\n          this.addElementPlacement(element, placements);\n        }, this);\n        elements.forEach(function (element) {\n          if (!_hasDecorators(element)) return newElements.push(element);\n          var elementFinishersExtras = this.decorateElement(element, placements);\n          newElements.push(elementFinishersExtras.element);\n          newElements.push.apply(newElements, elementFinishersExtras.extras);\n          finishers.push.apply(finishers, elementFinishersExtras.finishers);\n        }, this);\n\n        if (!decorators) {\n          return {\n            elements: newElements,\n            finishers: finishers\n          };\n        }\n\n        var result = this.decorateConstructor(newElements, decorators);\n        finishers.push.apply(finishers, result.finishers);\n        result.finishers = finishers;\n        return result;\n      },\n      addElementPlacement: function addElementPlacement(element, placements, silent) {\n        var keys = placements[element.placement];\n\n        if (!silent && keys.indexOf(element.key) !== -1) {\n          throw new TypeError('Duplicated element (' + element.key + ')');\n        }\n\n        keys.push(element.key);\n      },\n      decorateElement: function decorateElement(element, placements) {\n        var extras = [];\n        var finishers = [];\n\n        for (var decorators = element.decorators, i = decorators.length - 1; i >= 0; i--) {\n          var keys = placements[element.placement];\n          keys.splice(keys.indexOf(element.key), 1);\n          var elementObject = this.fromElementDescriptor(element);\n          var elementFinisherExtras = this.toElementFinisherExtras((0, decorators[i])(elementObject) || elementObject);\n          element = elementFinisherExtras.element;\n          this.addElementPlacement(element, placements);\n\n          if (elementFinisherExtras.finisher) {\n            finishers.push(elementFinisherExtras.finisher);\n          }\n\n          var newExtras = elementFinisherExtras.extras;\n\n          if (newExtras) {\n            for (var j = 0; j < newExtras.length; j++) {\n              this.addElementPlacement(newExtras[j], placements);\n            }\n\n            extras.push.apply(extras, newExtras);\n          }\n        }\n\n        return {\n          element: element,\n          finishers: finishers,\n          extras: extras\n        };\n      },\n      decorateConstructor: function decorateConstructor(elements, decorators) {\n        var finishers = [];\n\n        for (var i = decorators.length - 1; i >= 0; i--) {\n          var obj = this.fromClassDescriptor(elements);\n          var elementsAndFinisher = this.toClassDescriptor((0, decorators[i])(obj) || obj);\n\n          if (elementsAndFinisher.finisher !== undefined) {\n            finishers.push(elementsAndFinisher.finisher);\n          }\n\n          if (elementsAndFinisher.elements !== undefined) {\n            elements = elementsAndFinisher.elements;\n\n            for (var j = 0; j < elements.length - 1; j++) {\n              for (var k = j + 1; k < elements.length; k++) {\n                if (elements[j].key === elements[k].key && elements[j].placement === elements[k].placement) {\n                  throw new TypeError('Duplicated element (' + elements[j].key + ')');\n                }\n              }\n            }\n          }\n        }\n\n        return {\n          elements: elements,\n          finishers: finishers\n        };\n      },\n      fromElementDescriptor: function fromElementDescriptor(element) {\n        var obj = {\n          kind: element.kind,\n          key: element.key,\n          placement: element.placement,\n          descriptor: element.descriptor\n        };\n        var desc = {\n          value: 'Descriptor',\n          configurable: true\n        };\n        Object.defineProperty(obj, Symbol.toStringTag, desc);\n        if (element.kind === 'field') obj.initializer = element.initializer;\n        return obj;\n      },\n      toElementDescriptors: function toElementDescriptors(elementObjects) {\n        if (elementObjects === undefined) return;\n        return _toArray(elementObjects).map(function (elementObject) {\n          var element = this.toElementDescriptor(elementObject);\n          this.disallowProperty(elementObject, 'finisher', 'An element descriptor');\n          this.disallowProperty(elementObject, 'extras', 'An element descriptor');\n          return element;\n        }, this);\n      },\n      toElementDescriptor: function toElementDescriptor(elementObject) {\n        var kind = String(elementObject.kind);\n\n        if (kind !== 'method' && kind !== 'field') {\n          throw new TypeError('An element descriptor\\'s .kind property must be either \"method\" or' + ' \"field\", but a decorator created an element descriptor with' + ' .kind \"' + kind + '\"');\n        }\n\n        var key = _toPropertyKey(elementObject.key);\n\n        var placement = String(elementObject.placement);\n\n        if (placement !== 'static' && placement !== 'prototype' && placement !== 'own') {\n          throw new TypeError('An element descriptor\\'s .placement property must be one of \"static\",' + ' \"prototype\" or \"own\", but a decorator created an element descriptor' + ' with .placement \"' + placement + '\"');\n        }\n\n        var descriptor = elementObject.descriptor;\n        this.disallowProperty(elementObject, 'elements', 'An element descriptor');\n        var element = {\n          kind: kind,\n          key: key,\n          placement: placement,\n          descriptor: Object.assign({}, descriptor)\n        };\n\n        if (kind !== 'field') {\n          this.disallowProperty(elementObject, 'initializer', 'A method descriptor');\n        } else {\n          this.disallowProperty(descriptor, 'get', 'The property descriptor of a field descriptor');\n          this.disallowProperty(descriptor, 'set', 'The property descriptor of a field descriptor');\n          this.disallowProperty(descriptor, 'value', 'The property descriptor of a field descriptor');\n          element.initializer = elementObject.initializer;\n        }\n\n        return element;\n      },\n      toElementFinisherExtras: function toElementFinisherExtras(elementObject) {\n        var element = this.toElementDescriptor(elementObject);\n\n        var finisher = _optionalCallableProperty(elementObject, 'finisher');\n\n        var extras = this.toElementDescriptors(elementObject.extras);\n        return {\n          element: element,\n          finisher: finisher,\n          extras: extras\n        };\n      },\n      fromClassDescriptor: function fromClassDescriptor(elements) {\n        var obj = {\n          kind: 'class',\n          elements: elements.map(this.fromElementDescriptor, this)\n        };\n        var desc = {\n          value: 'Descriptor',\n          configurable: true\n        };\n        Object.defineProperty(obj, Symbol.toStringTag, desc);\n        return obj;\n      },\n      toClassDescriptor: function toClassDescriptor(obj) {\n        var kind = String(obj.kind);\n\n        if (kind !== 'class') {\n          throw new TypeError('A class descriptor\\'s .kind property must be \"class\", but a decorator' + ' created a class descriptor with .kind \"' + kind + '\"');\n        }\n\n        this.disallowProperty(obj, 'key', 'A class descriptor');\n        this.disallowProperty(obj, 'placement', 'A class descriptor');\n        this.disallowProperty(obj, 'descriptor', 'A class descriptor');\n        this.disallowProperty(obj, 'initializer', 'A class descriptor');\n        this.disallowProperty(obj, 'extras', 'A class descriptor');\n\n        var finisher = _optionalCallableProperty(obj, 'finisher');\n\n        var elements = this.toElementDescriptors(obj.elements);\n        return {\n          elements: elements,\n          finisher: finisher\n        };\n      },\n      runClassFinishers: function runClassFinishers(constructor, finishers) {\n        for (var i = 0; i < finishers.length; i++) {\n          var newConstructor = (0, finishers[i])(constructor);\n\n          if (newConstructor !== undefined) {\n            if (typeof newConstructor !== 'function') {\n              throw new TypeError('Finishers must return a constructor.');\n            }\n\n            constructor = newConstructor;\n          }\n        }\n\n        return constructor;\n      },\n      disallowProperty: function disallowProperty(obj, name, objectType) {\n        if (obj[name] !== undefined) {\n          throw new TypeError(objectType + \" can't have a .\" + name + ' property.');\n        }\n      }\n    };\n    return api;\n  }\n\n  function _createElementDescriptor(def) {\n    var key = _toPropertyKey(def.key);\n\n    var descriptor;\n\n    if (def.kind === 'method') {\n      descriptor = {\n        value: def.value,\n        writable: true,\n        configurable: true,\n        enumerable: false\n      };\n    } else if (def.kind === 'get') {\n      descriptor = {\n        get: def.value,\n        configurable: true,\n        enumerable: false\n      };\n    } else if (def.kind === 'set') {\n      descriptor = {\n        set: def.value,\n        configurable: true,\n        enumerable: false\n      };\n    } else if (def.kind === 'field') {\n      descriptor = {\n        configurable: true,\n        writable: true,\n        enumerable: true\n      };\n    }\n\n    var element = {\n      kind: def.kind === 'field' ? 'field' : 'method',\n      key: key,\n      placement: def.static ? 'static' : def.kind === 'field' ? 'own' : 'prototype',\n      descriptor: descriptor\n    };\n    if (def.decorators) element.decorators = def.decorators;\n    if (def.kind === 'field') element.initializer = def.value;\n    return element;\n  }\n\n  function _coalesceGetterSetter(element, other) {\n    if (element.descriptor.get !== undefined) {\n      other.descriptor.get = element.descriptor.get;\n    } else {\n      other.descriptor.set = element.descriptor.set;\n    }\n  }\n\n  function _coalesceClassElements(elements) {\n    var newElements = [];\n\n    var isSameElement = function isSameElement(other) {\n      return other.kind === 'method' && other.key === element.key && other.placement === element.placement;\n    };\n\n    for (var i = 0; i < elements.length; i++) {\n      var element = elements[i];\n      var other;\n\n      if (element.kind === 'method' && (other = newElements.find(isSameElement))) {\n        if (_isDataDescriptor(element.descriptor) || _isDataDescriptor(other.descriptor)) {\n          if (_hasDecorators(element) || _hasDecorators(other)) {\n            throw new ReferenceError('Duplicated methods (' + element.key + \") can't be decorated.\");\n          }\n\n          other.descriptor = element.descriptor;\n        } else {\n          if (_hasDecorators(element)) {\n            if (_hasDecorators(other)) {\n              throw new ReferenceError(\"Decorators can't be placed on different accessors with for \" + 'the same property (' + element.key + ').');\n            }\n\n            other.decorators = element.decorators;\n          }\n\n          _coalesceGetterSetter(element, other);\n        }\n      } else {\n        newElements.push(element);\n      }\n    }\n\n    return newElements;\n  }\n\n  function _hasDecorators(element) {\n    return element.decorators && element.decorators.length;\n  }\n\n  function _isDataDescriptor(desc) {\n    return desc !== undefined && !(desc.value === undefined && desc.writable === undefined);\n  }\n\n  function _optionalCallableProperty(obj, name) {\n    var value = obj[name];\n\n    if (value !== undefined && typeof value !== 'function') {\n      throw new TypeError(\"Expected '\" + name + \"' to be a function\");\n    }\n\n    return value;\n  }\n\n  function _classPrivateMethodGet(receiver, privateSet, fn) {\n    if (!privateSet.has(receiver)) {\n      throw new TypeError('attempted to get private field on non-instance');\n    }\n\n    return fn;\n  }\n\n  function _classPrivateMethodSet() {\n    throw new TypeError('attempted to reassign private method');\n  }\n\n  function _wrapRegExp(re, groups) {\n    _wrapRegExp = function _wrapRegExp(re, groups) {\n      return new BabelRegExp(re, groups);\n    };\n\n    var _RegExp = _wrapNativeSuper(RegExp);\n\n    var _super = RegExp.prototype;\n\n    var _groups = new WeakMap();\n\n    function BabelRegExp(re, groups) {\n      var _this = _RegExp.call(this, re);\n\n      _groups.set(_this, groups);\n\n      return _this;\n    }\n\n    _inherits(BabelRegExp, _RegExp);\n\n    BabelRegExp.prototype.exec = function (str) {\n      var result = _super.exec.call(this, str);\n\n      if (result) result.groups = buildGroups(result, this);\n      return result;\n    };\n\n    BabelRegExp.prototype[Symbol.replace] = function (str, substitution) {\n      if (typeof substitution === 'string') {\n        var groups = _groups.get(this);\n\n        return _super[Symbol.replace].call(this, str, substitution.replace(/\\$<([^>]+)>/g, function (_, name) {\n          return '$' + groups[name];\n        }));\n      } else if (typeof substitution === 'function') {\n        var _this = this;\n\n        return _super[Symbol.replace].call(this, str, function () {\n          var args = [];\n          args.push.apply(args, arguments);\n\n          if (typeof args[args.length - 1] !== 'object') {\n            args.push(buildGroups(args, _this));\n          }\n\n          return substitution.apply(this, args);\n        });\n      } else {\n        return _super[Symbol.replace].call(this, str, substitution);\n      }\n    };\n\n    function buildGroups(result, re) {\n      var g = _groups.get(re);\n\n      return Object.keys(g).reduce(function (groups, name) {\n        groups[name] = result[g[name]];\n        return groups;\n      }, Object.create(null));\n    }\n\n    return _wrapRegExp.apply(this, arguments);\n  }\n\n  var MARKUP_RECT = ['x', 'y', 'left', 'top', 'right', 'bottom', 'width', 'height'];\n\n  var toOptionalFraction = function toOptionalFraction(value) {\n    return typeof value === 'string' && /%/.test(value) ? parseFloat(value) / 100 : value;\n  }; // adds default markup properties, clones markup\n\n\n  var prepareMarkup = function prepareMarkup(markup) {\n    var _markup = _slicedToArray(markup, 2),\n        type = _markup[0],\n        props = _markup[1];\n\n    var rect = props.points ? {} : MARKUP_RECT.reduce(function (prev, curr) {\n      prev[curr] = toOptionalFraction(props[curr]);\n      return prev;\n    }, {});\n    return [type, Object.assign({\n      zIndex: 0\n    }, props, rect)];\n  };\n\n  var getImageSize = function getImageSize(file) {\n    return new Promise(function (resolve, reject) {\n      var imageElement = new Image();\n      imageElement.src = URL.createObjectURL(file); // start testing size\n\n      var measure = function measure() {\n        var width = imageElement.naturalWidth;\n        var height = imageElement.naturalHeight;\n        var hasSize = width && height;\n        if (!hasSize) return;\n        URL.revokeObjectURL(imageElement.src);\n        clearInterval(intervalId);\n        resolve({\n          width: width,\n          height: height\n        });\n      };\n\n      imageElement.onerror = function (err) {\n        URL.revokeObjectURL(imageElement.src);\n        clearInterval(intervalId);\n        reject(err);\n      };\n\n      var intervalId = setInterval(measure, 1);\n      measure();\n    });\n  };\n  /**\n   * Polyfill Edge and IE when in Browser\n   */\n\n\n  if (typeof window !== 'undefined' && typeof window.document !== 'undefined') {\n    if (!HTMLCanvasElement.prototype.toBlob) {\n      Object.defineProperty(HTMLCanvasElement.prototype, 'toBlob', {\n        value: function value(cb, type, quality) {\n          var canvas = this;\n          setTimeout(function () {\n            var dataURL = canvas.toDataURL(type, quality).split(',')[1];\n            var binStr = atob(dataURL);\n            var index = binStr.length;\n            var data = new Uint8Array(index);\n\n            while (index--) {\n              data[index] = binStr.charCodeAt(index);\n            }\n\n            cb(new Blob([data], {\n              type: type || 'image/png'\n            }));\n          });\n        }\n      });\n    }\n  }\n\n  var isBrowser = typeof window !== 'undefined' && typeof window.document !== 'undefined';\n  var isIOS = isBrowser && /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;\n  /**\n   * Image Transform Plugin\n   */\n\n  var plugin = function plugin(_ref) {\n    var addFilter = _ref.addFilter,\n        utils = _ref.utils;\n    var Type = utils.Type,\n        forin = utils.forin,\n        getFileFromBlob = utils.getFileFromBlob,\n        isFile = utils.isFile;\n    /**\n     * Helper functions\n     */\n    // valid transforms (in correct order)\n\n    var TRANSFORM_LIST = ['crop', 'resize', 'filter', 'markup', 'output'];\n\n    var createVariantCreator = function createVariantCreator(updateMetadata) {\n      return function (transform, file, metadata) {\n        return transform(file, updateMetadata ? updateMetadata(metadata) : metadata);\n      };\n    };\n\n    var isDefaultCrop = function isDefaultCrop(crop) {\n      return crop.aspectRatio === null && crop.rotation === 0 && crop.zoom === 1 && crop.center && crop.center.x === 0.5 && crop.center.y === 0.5 && crop.flip && crop.flip.horizontal === false && crop.flip.vertical === false;\n    };\n    /**\n     * Filters\n     */\n\n\n    addFilter('SHOULD_PREPARE_OUTPUT', function (shouldPrepareOutput, _ref2) {\n      var query = _ref2.query;\n      return new Promise(function (resolve) {\n        // If is not async should prepare now\n        resolve(!query('IS_ASYNC'));\n      });\n    });\n\n    var shouldTransformFile = function shouldTransformFile(query, file, item) {\n      return new Promise(function (resolve) {\n        if (!query('GET_ALLOW_IMAGE_TRANSFORM') || item.archived || !isFile(file) || !isImage(file)) {\n          return resolve(false);\n        } // if size can't be read this browser doesn't support image\n\n\n        getImageSize(file).then(function () {\n          var fn = query('GET_IMAGE_TRANSFORM_IMAGE_FILTER');\n\n          if (fn) {\n            var filterResult = fn(file);\n\n            if (filterResult == null) {\n              // undefined or null\n              return handleRevert(true);\n            }\n\n            if (typeof filterResult === 'boolean') {\n              return resolve(filterResult);\n            }\n\n            if (typeof filterResult.then === 'function') {\n              return filterResult.then(resolve);\n            }\n          }\n\n          resolve(true);\n        }).catch(function (err) {\n          resolve(false);\n        });\n      });\n    }; // subscribe to file transformations\n\n\n    addFilter('PREPARE_OUTPUT', function (file, _ref3) {\n      var query = _ref3.query,\n          item = _ref3.item;\n      return new Promise(function (resolve) {\n        shouldTransformFile(query, file, item).then(function (shouldTransform) {\n          // no need to transform, exit\n          if (!shouldTransform) return resolve(file); // get variants\n\n          var variants = []; // add original file\n\n          if (query('GET_IMAGE_TRANSFORM_VARIANTS_INCLUDE_ORIGINAL')) {\n            variants.push(function () {\n              return new Promise(function (resolve) {\n                resolve({\n                  name: query('GET_IMAGE_TRANSFORM_VARIANTS_ORIGINAL_NAME'),\n                  file: file\n                });\n              });\n            });\n          } // add default output version if output default set to true or if no variants defined\n\n\n          if (query('GET_IMAGE_TRANSFORM_VARIANTS_INCLUDE_DEFAULT')) {\n            variants.push(function (transform, file, metadata) {\n              return new Promise(function (resolve) {\n                transform(file, metadata).then(function (file) {\n                  return resolve({\n                    name: query('GET_IMAGE_TRANSFORM_VARIANTS_DEFAULT_NAME'),\n                    file: file\n                  });\n                });\n              });\n            });\n          } // get other variants\n\n\n          var variantsDefinition = query('GET_IMAGE_TRANSFORM_VARIANTS') || {};\n          forin(variantsDefinition, function (key, fn) {\n            var createVariant = createVariantCreator(fn);\n            variants.push(function (transform, file, metadata) {\n              return new Promise(function (resolve) {\n                createVariant(transform, file, metadata).then(function (file) {\n                  return resolve({\n                    name: key,\n                    file: file\n                  });\n                });\n              });\n            });\n          }); // output format (quality 0 => 100)\n\n          var qualityAsPercentage = query('GET_IMAGE_TRANSFORM_OUTPUT_QUALITY');\n          var qualityMode = query('GET_IMAGE_TRANSFORM_OUTPUT_QUALITY_MODE');\n          var quality = qualityAsPercentage === null ? null : qualityAsPercentage / 100;\n          var type = query('GET_IMAGE_TRANSFORM_OUTPUT_MIME_TYPE');\n          var clientTransforms = query('GET_IMAGE_TRANSFORM_CLIENT_TRANSFORMS') || TRANSFORM_LIST; // update transform metadata object\n\n          item.setMetadata('output', {\n            type: type,\n            quality: quality,\n            client: clientTransforms\n          }, true); // the function that is used to apply the file transformations\n\n          var transform = function transform(file, metadata) {\n            return new Promise(function (resolve, reject) {\n              var filteredMetadata = Object.assign({}, metadata);\n              Object.keys(filteredMetadata).filter(function (instruction) {\n                return instruction !== 'exif';\n              }).forEach(function (instruction) {\n                // if not in list, remove from object, the instruction will be handled by the server\n                if (clientTransforms.indexOf(instruction) === -1) {\n                  delete filteredMetadata[instruction];\n                }\n              });\n              var resize = filteredMetadata.resize,\n                  exif = filteredMetadata.exif,\n                  output = filteredMetadata.output,\n                  crop = filteredMetadata.crop,\n                  filter = filteredMetadata.filter,\n                  markup = filteredMetadata.markup;\n              var instructions = {\n                image: {\n                  orientation: exif ? exif.orientation : null\n                },\n                output: output && (output.type || typeof output.quality === 'number' || output.background) ? {\n                  type: output.type,\n                  quality: typeof output.quality === 'number' ? output.quality * 100 : null,\n                  background: output.background || query('GET_IMAGE_TRANSFORM_CANVAS_BACKGROUND_COLOR') || null\n                } : undefined,\n                size: resize && (resize.size.width || resize.size.height) ? Object.assign({\n                  mode: resize.mode,\n                  upscale: resize.upscale\n                }, resize.size) : undefined,\n                crop: crop && !isDefaultCrop(crop) ? Object.assign({}, crop) : undefined,\n                markup: markup && markup.length ? markup.map(prepareMarkup) : [],\n                filter: filter\n              };\n\n              if (instructions.output) {\n                // determine if file type will change\n                var willChangeType = output.type ? // type set\n                output.type !== file.type : // type not set\n                false;\n                var canChangeQuality = /\\/jpe?g$/.test(file.type);\n                var willChangeQuality = output.quality !== null ? // quality set\n                canChangeQuality && qualityMode === 'always' : // quality not set\n                false; // determine if file data will be modified\n\n                var willModifyImageData = !!(instructions.size || instructions.crop || instructions.filter || willChangeType || willChangeQuality); // if we're not modifying the image data then we don't have to modify the output\n\n                if (!willModifyImageData) return resolve(file);\n              }\n\n              var options = {\n                beforeCreateBlob: query('GET_IMAGE_TRANSFORM_BEFORE_CREATE_BLOB'),\n                afterCreateBlob: query('GET_IMAGE_TRANSFORM_AFTER_CREATE_BLOB'),\n                canvasMemoryLimit: query('GET_IMAGE_TRANSFORM_CANVAS_MEMORY_LIMIT'),\n                stripImageHead: query('GET_IMAGE_TRANSFORM_OUTPUT_STRIP_IMAGE_HEAD')\n              };\n              transformImage(file, instructions, options).then(function (blob) {\n                // set file object\n                var out = getFileFromBlob(blob, // rename the original filename to match the mime type of the output image\n                renameFileToMatchMimeType(file.name, getValidOutputMimeType(blob.type)));\n                resolve(out);\n              }).catch(reject);\n            });\n          }; // start creating variants\n\n\n          var variantPromises = variants.map(function (create) {\n            return create(transform, file, item.getMetadata());\n          }); // wait for results\n\n          Promise.all(variantPromises).then(function (files) {\n            // if single file object in array, return the single file object else, return array of\n            resolve(files.length === 1 && files[0].name === null ? // return the File object\n            files[0].file : // return an array of files { name:'name', file:File }\n            files);\n          });\n        });\n      });\n    }); // Expose plugin options\n\n    return {\n      options: {\n        allowImageTransform: [true, Type.BOOLEAN],\n        // filter images to transform\n        imageTransformImageFilter: [null, Type.FUNCTION],\n        // null, 'image/jpeg', 'image/png'\n        imageTransformOutputMimeType: [null, Type.STRING],\n        // null, 0 - 100\n        imageTransformOutputQuality: [null, Type.INT],\n        // set to false to copy image exif data to output\n        imageTransformOutputStripImageHead: [true, Type.BOOLEAN],\n        // only apply transforms in this list\n        imageTransformClientTransforms: [null, Type.ARRAY],\n        // only apply output quality when a transform is required\n        imageTransformOutputQualityMode: ['always', Type.STRING],\n        // 'always'\n        // 'optional'\n        // 'mismatch' (future feature, only applied if quality differs from input)\n        // get image transform variants\n        imageTransformVariants: [null, Type.OBJECT],\n        // should we post the default transformed file\n        imageTransformVariantsIncludeDefault: [true, Type.BOOLEAN],\n        // which name to prefix the default transformed file with\n        imageTransformVariantsDefaultName: [null, Type.STRING],\n        // should we post the original file\n        imageTransformVariantsIncludeOriginal: [false, Type.BOOLEAN],\n        // which name to prefix the original file with\n        imageTransformVariantsOriginalName: ['original_', Type.STRING],\n        // called before creating the blob, receives canvas, expects promise resolve with canvas\n        imageTransformBeforeCreateBlob: [null, Type.FUNCTION],\n        // expects promise resolved with blob\n        imageTransformAfterCreateBlob: [null, Type.FUNCTION],\n        // canvas memory limit\n        imageTransformCanvasMemoryLimit: [isBrowser && isIOS ? 4096 * 4096 : null, Type.INT],\n        // background image of the output canvas\n        imageTransformCanvasBackgroundColor: [null, Type.STRING]\n      }\n    };\n  }; // fire pluginloaded event if running in browser, this allows registering the plugin when using async script tags\n\n\n  if (isBrowser) {\n    document.dispatchEvent(new CustomEvent('FilePond:pluginloaded', {\n      detail: plugin\n    }));\n  }\n\n  return plugin;\n});","map":{"version":3,"sources":["/home/kalyan/Downloads/Instagram-Web-App-MERN-Stack-Clone-master/client/node_modules/filepond-plugin-image-transform/dist/filepond-plugin-image-transform.js"],"names":["global","factory","exports","module","define","amd","self","FilePondPluginImageTransform","isImage","file","test","type","getFilenameWithoutExtension","name","substr","lastIndexOf","ExtensionMap","jpeg","renameFileToMatchMimeType","filename","mimeType","split","extension","concat","getValidOutputMimeType","isImage$1","MATRICES","_","width","height","getImageOrientationMatrix","orientation","createVector","x","y","vectorDot","a","b","vectorSubtract","vectorDistanceSquared","vectorDistance","Math","sqrt","getOffsetPointOnEdge","length","rotation","A","B","C","sinA","sin","sinB","sinC","cosC","cos","ratio","c","getRotatedRectSize","rect","w","h","hor","ver","tl","abs","tr","bl","getImageRectZoomFactor","imageRect","cropRect","arguments","undefined","center","cx","cy","imageWidth","imageHeight","rotatedCropSize","max","getCenteredCropRect","container","aspectRatio","calculateCanvasSize","image","canvasAspectRatio","zoom","imageAspectRatio","canvasWidth","canvasHeight","imgWidth","imgHeight","scalar","canvasRelease","canvas","ctx","getContext","clearRect","isFlipped","flip","horizontal","vertical","getBitmap","naturalWidth","naturalHeight","document","createElement","swapped","transform","apply","matrix","drawImage","imageToImageData","imageElement","crop","options","canvasMemoryLimit","_options$background","background","bitmap","imageSize","canvasSize","requiredMemory","floor","canvasCenter","stage","shouldLimit","scaleToFit","scale","round","imageOffset","fillStyle","fillRect","translate","rotate","imageData","getImageData","IS_BROWSER","window","HTMLCanvasElement","prototype","toBlob","Object","defineProperty","value","callback","quality","dataURL","toDataURL","setTimeout","binStr","atob","len","arr","Uint8Array","i","charCodeAt","Blob","canvasToBlob","beforeCreateBlob","Promise","resolve","promisedImage","then","vectorMultiply","v","amount","createVector$1","vectorAdd","vectorNormalize","l","vectorRotate","radians","origin","t","getMarkupValue","size","axis","parseFloat","min","getMarkupStyles","markup","lineStyle","borderStyle","fill","backgroundColor","fontColor","stroke","borderColor","lineColor","strokeWidth","borderWidth","lineWidth","lineCap","lineJoin","dashes","map","join","opacity","isDefined","getMarkupRect","left","top","right","bottom","pointsToPathShape","points","point","index","setAttributes","element","attr","keys","forEach","key","setAttribute","ns","svg","tag","createElementNS","updateRect","assign","styles","updateEllipse","rx","ry","IMAGE_FIT_STYLE","contain","cover","updateImage","preserveAspectRatio","fit","TEXT_ANCHOR","updateText","fontSize","fontFamily","fontWeight","textAlign","text","textContent","updateLine","line","childNodes","begin","end","target","x1","y1","x2","y2","lineDecoration","style","display","indexOf","arrowBeginRotationPoint","arrowBeginCenter","arrowBeginA","arrowBeginB","d","arrowEndRotationPoint","arrowEndCenter","arrowEndA","arrowEndB","updatePath","createShape","node","id","createImage","shape","onload","setAttributeNS","src","createLine","appendChild","CREATE_TYPE_ROUTES","ellipse","path","UPDATE_TYPE_ROUTES","createMarkupByType","updateMarkupByType","sortMarkupByZIndex","zIndex","cropSVG","blob","fr","FileReader","onloadend","result","original","cssText","innerHTML","originalNode","querySelector","body","bBox","getBBox","parentNode","removeChild","titleNode","viewBoxAttribute","getAttribute","widthAttribute","heightAttribute","widthUnits","match","heightUnits","viewBoxList","viewBox","overflow","markupSVG","sort","reduce","prev","el","removeAttribute","outerHTML","replace","cropCenterX","cropCenterY","canvasZoomFactor","PI","cropTransforms","cropFlipHorizontal","cropFlipVertical","flipTransforms","transformed","readAsText","objectToImageData","obj","ImageData","e","createImageData","data","set","TransformWorker","TRANSFORMS","resize","filter","applyTransforms","transforms","cb","filterTransform","resizeTransform","onmessage","message","response","postMessage","buffer","br","bg","bb","applyFilterMatrix","m","ir","ig","ib","ia","mr","mg","mb","ma","or","og","ob","identityMatrix","JSON","stringify","isIdentityMatrix","m11","m12","m13","m14","m15","m21","m22","m23","m24","m25","m31","m32","m33","m34","m35","m41","m42","m43","m44","m45","r","g","_data$mode","mode","_data$upscale","upscale","scalarWidth","scalarHeight","originWidth","originHeight","targetWidth","targetHeight","inputData","outputData","Uint8ClampedArray","ratioWidth","ratioHeight","ratioWidthHalf","ceil","ratioHeightHalf","j","weight","weights","weightsAlpha","centerY","yy","dy","centerX","w0","xx","dx","ref","correctOrientation","view","offset","getUint32","intelByteAligned","getUint16","tags","setUint16","readData","DataView","marker","markerLength","orientationCorrected","byteLength","isData","slice","getImageHead","reader","readAsArrayBuffer","getBlobBuilder","BlobBuilder","WebKitBlobBuilder","MozBlobBuilder","MSBlobBuilder","createBlob","arrayBuffer","BB","append","getBlob","getUniqueId","random","toString","createWorker","fn","workerBlob","workerURL","URL","createObjectURL","worker","Worker","trips","transfer","post","transferList","terminate","revokeObjectURL","loadImage","url","reject","img","Image","onerror","chain","funcs","promise","func","Array","bind","canvasApplyMarkup","drawers","item","TYPE_DRAW_ROUTES","applyMarkupStyles","beginPath","setLineDash","strokeStyle","globalAlpha","drawMarkupStyles","drawRect","drawEllipse","kappa","ox","oy","xe","ye","xm","ym","moveTo","bezierCurveTo","done","isCrossOriginImage","location","href","crossOrigin","ar","_width","_height","_x","_y","drawText","font","fillText","drawPath","lineTo","drawLine","imageDataToCanvas","putImageData","transformImage","instructions","status","stripImageHead","afterCreateBlob","output","qualityAsPercentage","push","resolveWithBlob","promisedBlob","promisedCanvas","imageHead","catch","outputFormat","_typeof","Symbol","iterator","constructor","REACT_ELEMENT_TYPE","_jsx","props","children","for","defaultProps","childrenLength","propName","childArray","$$typeof","_owner","_asyncIterator","iterable","method","asyncIterator","call","TypeError","_AwaitValue","wrapped","_AsyncGenerator","gen","front","back","send","arg","request","next","resume","wrappedAwait","settle","err","_invoke","return","throw","_wrapAsyncGenerator","_awaitAsyncGenerator","_asyncGeneratorDelegate","inner","awaitWrap","iter","waiting","pump","asyncGeneratorStep","_next","_throw","info","error","_asyncToGenerator","args","_classCallCheck","instance","Constructor","_defineProperties","descriptor","enumerable","configurable","writable","_createClass","protoProps","staticProps","_defineEnumerableProperties","descs","desc","getOwnPropertySymbols","objectSymbols","sym","_defaults","defaults","getOwnPropertyNames","getOwnPropertyDescriptor","_defineProperty","_extends","source","hasOwnProperty","_objectSpread","ownKeys","_inherits","subClass","superClass","create","_setPrototypeOf","_inheritsLoose","__proto__","_getPrototypeOf","o","setPrototypeOf","getPrototypeOf","p","isNativeReflectConstruct","Reflect","construct","sham","Proxy","Date","_construct","Parent","Class","Function","_isNativeFunction","_wrapNativeSuper","_cache","Map","has","get","Wrapper","_instanceof","hasInstance","_interopRequireDefault","__esModule","default","_interopRequireWildcard","newObj","_newArrowCheck","innerThis","boundThis","_objectDestructuringEmpty","_objectWithoutPropertiesLoose","excluded","sourceKeys","_objectWithoutProperties","sourceSymbolKeys","propertyIsEnumerable","_assertThisInitialized","ReferenceError","_possibleConstructorReturn","_superPropBase","object","property","_get","receiver","base","_set","isStrict","s","Error","_taggedTemplateLiteral","strings","raw","freeze","defineProperties","_taggedTemplateLiteralLoose","_temporalRef","val","_temporalUndefined","_readOnlyError","_classNameTDZError","_slicedToArray","_arrayWithHoles","_iterableToArrayLimit","_nonIterableRest","_slicedToArrayLoose","_iterableToArrayLimitLoose","_toArray","_iterableToArray","_toConsumableArray","_arrayWithoutHoles","_nonIterableSpread","isArray","arr2","from","_arr","_n","_d","_e","_i","_s","_iterator","_step","_skipFirstGeneratorNext","it","_toPrimitive","input","hint","prim","toPrimitive","res","String","Number","_toPropertyKey","_initializerWarningHelper","context","_initializerDefineProperty","initializer","_applyDecoratedDescriptor","decorators","reverse","decorator","_classPrivateFieldLooseKey","_classPrivateFieldLooseBase","privateKey","_classPrivateFieldGet","privateMap","_classPrivateFieldSet","_classStaticPrivateFieldSpecGet","classConstructor","_classStaticPrivateFieldSpecSet","_classStaticPrivateMethodGet","_classStaticPrivateMethodSet","_decorate","mixins","api","_getDecoratorsApi","initialize","O","initializeInstanceElements","decorated","elements","decorateClass","_coalesceClassElements","_createElementDescriptor","initializeClassElements","F","runClassFinishers","finishers","elementsDefinitionOrder","kind","placement","defineClassElement","proto","newElements","placements","static","own","addElementPlacement","_hasDecorators","elementFinishersExtras","decorateElement","extras","decorateConstructor","silent","splice","elementObject","fromElementDescriptor","elementFinisherExtras","toElementFinisherExtras","finisher","newExtras","fromClassDescriptor","elementsAndFinisher","toClassDescriptor","k","toStringTag","toElementDescriptors","elementObjects","toElementDescriptor","disallowProperty","_optionalCallableProperty","newConstructor","objectType","def","_coalesceGetterSetter","other","isSameElement","find","_isDataDescriptor","_classPrivateMethodGet","privateSet","_classPrivateMethodSet","_wrapRegExp","re","groups","BabelRegExp","_RegExp","RegExp","_super","_groups","WeakMap","_this","exec","str","buildGroups","substitution","MARKUP_RECT","toOptionalFraction","prepareMarkup","_markup","curr","getImageSize","measure","hasSize","clearInterval","intervalId","setInterval","isBrowser","isIOS","navigator","userAgent","MSStream","plugin","_ref","addFilter","utils","Type","forin","getFileFromBlob","isFile","TRANSFORM_LIST","createVariantCreator","updateMetadata","metadata","isDefaultCrop","shouldPrepareOutput","_ref2","query","shouldTransformFile","archived","filterResult","handleRevert","_ref3","shouldTransform","variants","variantsDefinition","createVariant","qualityMode","clientTransforms","setMetadata","client","filteredMetadata","instruction","exif","willChangeType","canChangeQuality","willChangeQuality","willModifyImageData","out","variantPromises","getMetadata","all","files","allowImageTransform","BOOLEAN","imageTransformImageFilter","FUNCTION","imageTransformOutputMimeType","STRING","imageTransformOutputQuality","INT","imageTransformOutputStripImageHead","imageTransformClientTransforms","ARRAY","imageTransformOutputQualityMode","imageTransformVariants","OBJECT","imageTransformVariantsIncludeDefault","imageTransformVariantsDefaultName","imageTransformVariantsIncludeOriginal","imageTransformVariantsOriginalName","imageTransformBeforeCreateBlob","imageTransformAfterCreateBlob","imageTransformCanvasMemoryLimit","imageTransformCanvasBackgroundColor","dispatchEvent","CustomEvent","detail"],"mappings":"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","sourcesContent":["/*!\n * FilePondPluginImageTransform 3.7.4\n * Licensed under MIT, https://opensource.org/licenses/MIT/\n * Please visit https://pqina.nl/filepond/ for details.\n */\n\n/* eslint-disable */\n\n(function(global, factory) {\n  typeof exports === 'object' && typeof module !== 'undefined'\n    ? (module.exports = factory())\n    : typeof define === 'function' && define.amd\n    ? define(factory)\n    : ((global = global || self),\n      (global.FilePondPluginImageTransform = factory()));\n})(this, function() {\n  'use strict';\n\n  // test if file is of type image\n  var isImage = function isImage(file) {\n    return /^image/.test(file.type);\n  };\n\n  var getFilenameWithoutExtension = function getFilenameWithoutExtension(name) {\n    return name.substr(0, name.lastIndexOf('.')) || name;\n  };\n\n  // only handles image/jpg, image/jpeg, image/png, and image/svg+xml for now\n  var ExtensionMap = {\n    jpeg: 'jpg',\n    'svg+xml': 'svg'\n  };\n\n  var renameFileToMatchMimeType = function renameFileToMatchMimeType(\n    filename,\n    mimeType\n  ) {\n    var name = getFilenameWithoutExtension(filename);\n    var type = mimeType.split('/')[1];\n    var extension = ExtensionMap[type] || type;\n    return ''.concat(name, '.').concat(extension);\n  };\n\n  // returns all the valid output formats we can encode towards\n  var getValidOutputMimeType = function getValidOutputMimeType(type) {\n    return /jpeg|png|svg\\+xml/.test(type) ? type : 'image/jpeg';\n  };\n\n  // test if file is of type image\n  var isImage$1 = function isImage(file) {\n    return /^image/.test(file.type);\n  };\n\n  var MATRICES = {\n    1: function _() {\n      return [1, 0, 0, 1, 0, 0];\n    },\n    2: function _(width) {\n      return [-1, 0, 0, 1, width, 0];\n    },\n    3: function _(width, height) {\n      return [-1, 0, 0, -1, width, height];\n    },\n    4: function _(width, height) {\n      return [1, 0, 0, -1, 0, height];\n    },\n    5: function _() {\n      return [0, 1, 1, 0, 0, 0];\n    },\n    6: function _(width, height) {\n      return [0, 1, -1, 0, height, 0];\n    },\n    7: function _(width, height) {\n      return [0, -1, -1, 0, height, width];\n    },\n    8: function _(width) {\n      return [0, -1, 1, 0, 0, width];\n    }\n  };\n\n  var getImageOrientationMatrix = function getImageOrientationMatrix(\n    width,\n    height,\n    orientation\n  ) {\n    if (orientation === -1) {\n      orientation = 1;\n    }\n    return MATRICES[orientation](width, height);\n  };\n\n  var createVector = function createVector(x, y) {\n    return { x: x, y: y };\n  };\n\n  var vectorDot = function vectorDot(a, b) {\n    return a.x * b.x + a.y * b.y;\n  };\n\n  var vectorSubtract = function vectorSubtract(a, b) {\n    return createVector(a.x - b.x, a.y - b.y);\n  };\n\n  var vectorDistanceSquared = function vectorDistanceSquared(a, b) {\n    return vectorDot(vectorSubtract(a, b), vectorSubtract(a, b));\n  };\n\n  var vectorDistance = function vectorDistance(a, b) {\n    return Math.sqrt(vectorDistanceSquared(a, b));\n  };\n\n  var getOffsetPointOnEdge = function getOffsetPointOnEdge(length, rotation) {\n    var a = length;\n\n    var A = 1.5707963267948966;\n    var B = rotation;\n    var C = 1.5707963267948966 - rotation;\n\n    var sinA = Math.sin(A);\n    var sinB = Math.sin(B);\n    var sinC = Math.sin(C);\n    var cosC = Math.cos(C);\n    var ratio = a / sinA;\n    var b = ratio * sinB;\n    var c = ratio * sinC;\n\n    return createVector(cosC * b, cosC * c);\n  };\n\n  var getRotatedRectSize = function getRotatedRectSize(rect, rotation) {\n    var w = rect.width;\n    var h = rect.height;\n\n    var hor = getOffsetPointOnEdge(w, rotation);\n    var ver = getOffsetPointOnEdge(h, rotation);\n\n    var tl = createVector(rect.x + Math.abs(hor.x), rect.y - Math.abs(hor.y));\n\n    var tr = createVector(\n      rect.x + rect.width + Math.abs(ver.y),\n      rect.y + Math.abs(ver.x)\n    );\n\n    var bl = createVector(\n      rect.x - Math.abs(ver.y),\n      rect.y + rect.height - Math.abs(ver.x)\n    );\n\n    return {\n      width: vectorDistance(tl, tr),\n      height: vectorDistance(tl, bl)\n    };\n  };\n\n  var getImageRectZoomFactor = function getImageRectZoomFactor(\n    imageRect,\n    cropRect\n  ) {\n    var rotation =\n      arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;\n    var center =\n      arguments.length > 3 && arguments[3] !== undefined\n        ? arguments[3]\n        : { x: 0.5, y: 0.5 };\n\n    // calculate available space round image center position\n    var cx = center.x > 0.5 ? 1 - center.x : center.x;\n    var cy = center.y > 0.5 ? 1 - center.y : center.y;\n    var imageWidth = cx * 2 * imageRect.width;\n    var imageHeight = cy * 2 * imageRect.height;\n\n    // calculate rotated crop rectangle size\n    var rotatedCropSize = getRotatedRectSize(cropRect, rotation);\n\n    return Math.max(\n      rotatedCropSize.width / imageWidth,\n      rotatedCropSize.height / imageHeight\n    );\n  };\n\n  var getCenteredCropRect = function getCenteredCropRect(\n    container,\n    aspectRatio\n  ) {\n    var width = container.width;\n    var height = width * aspectRatio;\n    if (height > container.height) {\n      height = container.height;\n      width = height / aspectRatio;\n    }\n    var x = (container.width - width) * 0.5;\n    var y = (container.height - height) * 0.5;\n\n    return {\n      x: x,\n      y: y,\n      width: width,\n      height: height\n    };\n  };\n\n  var calculateCanvasSize = function calculateCanvasSize(\n    image,\n    canvasAspectRatio\n  ) {\n    var zoom =\n      arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 1;\n\n    var imageAspectRatio = image.height / image.width;\n\n    // determine actual pixels on x and y axis\n    var canvasWidth = 1;\n    var canvasHeight = canvasAspectRatio;\n    var imgWidth = 1;\n    var imgHeight = imageAspectRatio;\n    if (imgHeight > canvasHeight) {\n      imgHeight = canvasHeight;\n      imgWidth = imgHeight / imageAspectRatio;\n    }\n\n    var scalar = Math.max(canvasWidth / imgWidth, canvasHeight / imgHeight);\n    var width = image.width / (zoom * scalar * imgWidth);\n    var height = width * canvasAspectRatio;\n\n    return {\n      width: width,\n      height: height\n    };\n  };\n\n  var canvasRelease = function canvasRelease(canvas) {\n    canvas.width = 1;\n    canvas.height = 1;\n    var ctx = canvas.getContext('2d');\n    ctx.clearRect(0, 0, 1, 1);\n  };\n\n  var isFlipped = function isFlipped(flip) {\n    return flip && (flip.horizontal || flip.vertical);\n  };\n\n  var getBitmap = function getBitmap(image, orientation, flip) {\n    if (orientation <= 1 && !isFlipped(flip)) {\n      image.width = image.naturalWidth;\n      image.height = image.naturalHeight;\n      return image;\n    }\n\n    var canvas = document.createElement('canvas');\n    var width = image.naturalWidth;\n    var height = image.naturalHeight;\n\n    // if is rotated incorrectly swap width and height\n    var swapped = orientation >= 5 && orientation <= 8;\n    if (swapped) {\n      canvas.width = height;\n      canvas.height = width;\n    } else {\n      canvas.width = width;\n      canvas.height = height;\n    }\n\n    // draw the image but first fix orientation and set correct flip\n    var ctx = canvas.getContext('2d');\n\n    // get base transformation matrix\n    if (orientation) {\n      ctx.transform.apply(\n        ctx,\n        getImageOrientationMatrix(width, height, orientation)\n      );\n    }\n\n    if (isFlipped(flip)) {\n      // flip horizontal\n      // [-1, 0, 0, 1, width, 0]\n      var matrix = [1, 0, 0, 1, 0, 0];\n      if ((!swapped && flip.horizontal) || swapped & flip.vertical) {\n        matrix[0] = -1;\n        matrix[4] = width;\n      }\n\n      // flip vertical\n      // [1, 0, 0, -1, 0, height]\n      if ((!swapped && flip.vertical) || (swapped && flip.horizontal)) {\n        matrix[3] = -1;\n        matrix[5] = height;\n      }\n\n      ctx.transform.apply(ctx, matrix);\n    }\n\n    ctx.drawImage(image, 0, 0, width, height);\n\n    return canvas;\n  };\n\n  var imageToImageData = function imageToImageData(imageElement, orientation) {\n    var crop =\n      arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n    var options =\n      arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : {};\n    var canvasMemoryLimit = options.canvasMemoryLimit,\n      _options$background = options.background,\n      background = _options$background === void 0 ? null : _options$background;\n\n    var zoom = crop.zoom || 1;\n\n    // fixes possible image orientation problems by drawing the image on the correct canvas\n    var bitmap = getBitmap(imageElement, orientation, crop.flip);\n    var imageSize = {\n      width: bitmap.width,\n      height: bitmap.height\n    };\n\n    var aspectRatio = crop.aspectRatio || imageSize.height / imageSize.width;\n\n    var canvasSize = calculateCanvasSize(imageSize, aspectRatio, zoom);\n\n    if (canvasMemoryLimit) {\n      var requiredMemory = canvasSize.width * canvasSize.height;\n      if (requiredMemory > canvasMemoryLimit) {\n        var scalar = Math.sqrt(canvasMemoryLimit) / Math.sqrt(requiredMemory);\n        imageSize.width = Math.floor(imageSize.width * scalar);\n        imageSize.height = Math.floor(imageSize.height * scalar);\n        canvasSize = calculateCanvasSize(imageSize, aspectRatio, zoom);\n      }\n    }\n\n    var canvas = document.createElement('canvas');\n\n    var canvasCenter = {\n      x: canvasSize.width * 0.5,\n      y: canvasSize.height * 0.5\n    };\n\n    var stage = {\n      x: 0,\n      y: 0,\n      width: canvasSize.width,\n      height: canvasSize.height,\n      center: canvasCenter\n    };\n\n    var shouldLimit = typeof crop.scaleToFit === 'undefined' || crop.scaleToFit;\n\n    var scale =\n      zoom *\n      getImageRectZoomFactor(\n        imageSize,\n        getCenteredCropRect(stage, aspectRatio),\n        crop.rotation,\n        shouldLimit ? crop.center : { x: 0.5, y: 0.5 }\n      );\n\n    // start drawing\n    canvas.width = Math.round(canvasSize.width / scale);\n    canvas.height = Math.round(canvasSize.height / scale);\n\n    canvasCenter.x /= scale;\n    canvasCenter.y /= scale;\n\n    var imageOffset = {\n      x: canvasCenter.x - imageSize.width * (crop.center ? crop.center.x : 0.5),\n      y: canvasCenter.y - imageSize.height * (crop.center ? crop.center.y : 0.5)\n    };\n\n    var ctx = canvas.getContext('2d');\n    if (background) {\n      ctx.fillStyle = background;\n      ctx.fillRect(0, 0, canvas.width, canvas.height);\n    }\n\n    // move to draw offset\n    ctx.translate(canvasCenter.x, canvasCenter.y);\n    ctx.rotate(crop.rotation || 0);\n\n    // draw the image\n    ctx.drawImage(\n      bitmap,\n      imageOffset.x - canvasCenter.x,\n      imageOffset.y - canvasCenter.y,\n      imageSize.width,\n      imageSize.height\n    );\n\n    // get data from canvas\n    var imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);\n\n    // release canvas\n    canvasRelease(canvas);\n\n    // return data\n    return imageData;\n  };\n\n  /**\n   * Polyfill toBlob for Edge\n   */\n  var IS_BROWSER = (function() {\n    return (\n      typeof window !== 'undefined' && typeof window.document !== 'undefined'\n    );\n  })();\n  if (IS_BROWSER) {\n    if (!HTMLCanvasElement.prototype.toBlob) {\n      Object.defineProperty(HTMLCanvasElement.prototype, 'toBlob', {\n        value: function value(callback, type, quality) {\n          var dataURL = this.toDataURL(type, quality).split(',')[1];\n          setTimeout(function() {\n            var binStr = atob(dataURL);\n            var len = binStr.length;\n            var arr = new Uint8Array(len);\n            for (var i = 0; i < len; i++) {\n              arr[i] = binStr.charCodeAt(i);\n            }\n            callback(new Blob([arr], { type: type || 'image/png' }));\n          });\n        }\n      });\n    }\n  }\n\n  var canvasToBlob = function canvasToBlob(canvas, options) {\n    var beforeCreateBlob =\n      arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;\n    return new Promise(function(resolve) {\n      var promisedImage = beforeCreateBlob ? beforeCreateBlob(canvas) : canvas;\n      Promise.resolve(promisedImage).then(function(canvas) {\n        canvas.toBlob(resolve, options.type, options.quality);\n      });\n    });\n  };\n\n  var vectorMultiply = function vectorMultiply(v, amount) {\n    return createVector$1(v.x * amount, v.y * amount);\n  };\n\n  var vectorAdd = function vectorAdd(a, b) {\n    return createVector$1(a.x + b.x, a.y + b.y);\n  };\n\n  var vectorNormalize = function vectorNormalize(v) {\n    var l = Math.sqrt(v.x * v.x + v.y * v.y);\n    if (l === 0) {\n      return {\n        x: 0,\n        y: 0\n      };\n    }\n    return createVector$1(v.x / l, v.y / l);\n  };\n\n  var vectorRotate = function vectorRotate(v, radians, origin) {\n    var cos = Math.cos(radians);\n    var sin = Math.sin(radians);\n    var t = createVector$1(v.x - origin.x, v.y - origin.y);\n    return createVector$1(\n      origin.x + cos * t.x - sin * t.y,\n      origin.y + sin * t.x + cos * t.y\n    );\n  };\n\n  var createVector$1 = function createVector() {\n    var x =\n      arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 0;\n    var y =\n      arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;\n    return { x: x, y: y };\n  };\n\n  var getMarkupValue = function getMarkupValue(value, size) {\n    var scalar =\n      arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 1;\n    var axis = arguments.length > 3 ? arguments[3] : undefined;\n    if (typeof value === 'string') {\n      return parseFloat(value) * scalar;\n    }\n    if (typeof value === 'number') {\n      return value * (axis ? size[axis] : Math.min(size.width, size.height));\n    }\n    return;\n  };\n\n  var getMarkupStyles = function getMarkupStyles(markup, size, scale) {\n    var lineStyle = markup.borderStyle || markup.lineStyle || 'solid';\n    var fill = markup.backgroundColor || markup.fontColor || 'transparent';\n    var stroke = markup.borderColor || markup.lineColor || 'transparent';\n    var strokeWidth = getMarkupValue(\n      markup.borderWidth || markup.lineWidth,\n      size,\n      scale\n    );\n    var lineCap = markup.lineCap || 'round';\n    var lineJoin = markup.lineJoin || 'round';\n    var dashes =\n      typeof lineStyle === 'string'\n        ? ''\n        : lineStyle\n            .map(function(v) {\n              return getMarkupValue(v, size, scale);\n            })\n            .join(',');\n    var opacity = markup.opacity || 1;\n    return {\n      'stroke-linecap': lineCap,\n      'stroke-linejoin': lineJoin,\n      'stroke-width': strokeWidth || 0,\n      'stroke-dasharray': dashes,\n      stroke: stroke,\n      fill: fill,\n      opacity: opacity\n    };\n  };\n\n  var isDefined = function isDefined(value) {\n    return value != null;\n  };\n\n  var getMarkupRect = function getMarkupRect(rect, size) {\n    var scalar =\n      arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 1;\n\n    var left =\n      getMarkupValue(rect.x, size, scalar, 'width') ||\n      getMarkupValue(rect.left, size, scalar, 'width');\n    var top =\n      getMarkupValue(rect.y, size, scalar, 'height') ||\n      getMarkupValue(rect.top, size, scalar, 'height');\n    var width = getMarkupValue(rect.width, size, scalar, 'width');\n    var height = getMarkupValue(rect.height, size, scalar, 'height');\n    var right = getMarkupValue(rect.right, size, scalar, 'width');\n    var bottom = getMarkupValue(rect.bottom, size, scalar, 'height');\n\n    if (!isDefined(top)) {\n      if (isDefined(height) && isDefined(bottom)) {\n        top = size.height - height - bottom;\n      } else {\n        top = bottom;\n      }\n    }\n\n    if (!isDefined(left)) {\n      if (isDefined(width) && isDefined(right)) {\n        left = size.width - width - right;\n      } else {\n        left = right;\n      }\n    }\n\n    if (!isDefined(width)) {\n      if (isDefined(left) && isDefined(right)) {\n        width = size.width - left - right;\n      } else {\n        width = 0;\n      }\n    }\n\n    if (!isDefined(height)) {\n      if (isDefined(top) && isDefined(bottom)) {\n        height = size.height - top - bottom;\n      } else {\n        height = 0;\n      }\n    }\n\n    return {\n      x: left || 0,\n      y: top || 0,\n      width: width || 0,\n      height: height || 0\n    };\n  };\n\n  var pointsToPathShape = function pointsToPathShape(points) {\n    return points\n      .map(function(point, index) {\n        return ''\n          .concat(index === 0 ? 'M' : 'L', ' ')\n          .concat(point.x, ' ')\n          .concat(point.y);\n      })\n      .join(' ');\n  };\n\n  var setAttributes = function setAttributes(element, attr) {\n    return Object.keys(attr).forEach(function(key) {\n      return element.setAttribute(key, attr[key]);\n    });\n  };\n\n  var ns = 'http://www.w3.org/2000/svg';\n  var svg = function svg(tag, attr) {\n    var element = document.createElementNS(ns, tag);\n    if (attr) {\n      setAttributes(element, attr);\n    }\n    return element;\n  };\n\n  var updateRect = function updateRect(element) {\n    return setAttributes(\n      element,\n      Object.assign({}, element.rect, element.styles)\n    );\n  };\n\n  var updateEllipse = function updateEllipse(element) {\n    var cx = element.rect.x + element.rect.width * 0.5;\n    var cy = element.rect.y + element.rect.height * 0.5;\n    var rx = element.rect.width * 0.5;\n    var ry = element.rect.height * 0.5;\n    return setAttributes(\n      element,\n      Object.assign(\n        {\n          cx: cx,\n          cy: cy,\n          rx: rx,\n          ry: ry\n        },\n        element.styles\n      )\n    );\n  };\n\n  var IMAGE_FIT_STYLE = {\n    contain: 'xMidYMid meet',\n    cover: 'xMidYMid slice'\n  };\n\n  var updateImage = function updateImage(element, markup) {\n    setAttributes(\n      element,\n      Object.assign({}, element.rect, element.styles, {\n        preserveAspectRatio: IMAGE_FIT_STYLE[markup.fit] || 'none'\n      })\n    );\n  };\n\n  var TEXT_ANCHOR = {\n    left: 'start',\n    center: 'middle',\n    right: 'end'\n  };\n\n  var updateText = function updateText(element, markup, size, scale) {\n    var fontSize = getMarkupValue(markup.fontSize, size, scale);\n    var fontFamily = markup.fontFamily || 'sans-serif';\n    var fontWeight = markup.fontWeight || 'normal';\n    var textAlign = TEXT_ANCHOR[markup.textAlign] || 'start';\n\n    setAttributes(\n      element,\n      Object.assign({}, element.rect, element.styles, {\n        'stroke-width': 0,\n        'font-weight': fontWeight,\n        'font-size': fontSize,\n        'font-family': fontFamily,\n        'text-anchor': textAlign\n      })\n    );\n\n    // update text\n    if (element.text !== markup.text) {\n      element.text = markup.text;\n      element.textContent = markup.text.length ? markup.text : ' ';\n    }\n  };\n\n  var updateLine = function updateLine(element, markup, size, scale) {\n    setAttributes(\n      element,\n      Object.assign({}, element.rect, element.styles, {\n        fill: 'none'\n      })\n    );\n\n    var line = element.childNodes[0];\n    var begin = element.childNodes[1];\n    var end = element.childNodes[2];\n\n    var origin = element.rect;\n\n    var target = {\n      x: element.rect.x + element.rect.width,\n      y: element.rect.y + element.rect.height\n    };\n\n    setAttributes(line, {\n      x1: origin.x,\n      y1: origin.y,\n      x2: target.x,\n      y2: target.y\n    });\n\n    if (!markup.lineDecoration) return;\n\n    begin.style.display = 'none';\n    end.style.display = 'none';\n\n    var v = vectorNormalize({\n      x: target.x - origin.x,\n      y: target.y - origin.y\n    });\n\n    var l = getMarkupValue(0.05, size, scale);\n\n    if (markup.lineDecoration.indexOf('arrow-begin') !== -1) {\n      var arrowBeginRotationPoint = vectorMultiply(v, l);\n      var arrowBeginCenter = vectorAdd(origin, arrowBeginRotationPoint);\n      var arrowBeginA = vectorRotate(origin, 2, arrowBeginCenter);\n      var arrowBeginB = vectorRotate(origin, -2, arrowBeginCenter);\n\n      setAttributes(begin, {\n        style: 'display:block;',\n        d: 'M'\n          .concat(arrowBeginA.x, ',')\n          .concat(arrowBeginA.y, ' L')\n          .concat(origin.x, ',')\n          .concat(origin.y, ' L')\n          .concat(arrowBeginB.x, ',')\n          .concat(arrowBeginB.y)\n      });\n    }\n\n    if (markup.lineDecoration.indexOf('arrow-end') !== -1) {\n      var arrowEndRotationPoint = vectorMultiply(v, -l);\n      var arrowEndCenter = vectorAdd(target, arrowEndRotationPoint);\n      var arrowEndA = vectorRotate(target, 2, arrowEndCenter);\n      var arrowEndB = vectorRotate(target, -2, arrowEndCenter);\n\n      setAttributes(end, {\n        style: 'display:block;',\n        d: 'M'\n          .concat(arrowEndA.x, ',')\n          .concat(arrowEndA.y, ' L')\n          .concat(target.x, ',')\n          .concat(target.y, ' L')\n          .concat(arrowEndB.x, ',')\n          .concat(arrowEndB.y)\n      });\n    }\n  };\n\n  var updatePath = function updatePath(element, markup, size, scale) {\n    setAttributes(\n      element,\n      Object.assign({}, element.styles, {\n        fill: 'none',\n        d: pointsToPathShape(\n          markup.points.map(function(point) {\n            return {\n              x: getMarkupValue(point.x, size, scale, 'width'),\n              y: getMarkupValue(point.y, size, scale, 'height')\n            };\n          })\n        )\n      })\n    );\n  };\n\n  var createShape = function createShape(node) {\n    return function(markup) {\n      return svg(node, { id: markup.id });\n    };\n  };\n\n  var createImage = function createImage(markup) {\n    var shape = svg('image', {\n      id: markup.id,\n      'stroke-linecap': 'round',\n      'stroke-linejoin': 'round',\n      opacity: '0'\n    });\n\n    shape.onload = function() {\n      shape.setAttribute('opacity', markup.opacity || 1);\n    };\n    shape.setAttributeNS(\n      'http://www.w3.org/1999/xlink',\n      'xlink:href',\n      markup.src\n    );\n    return shape;\n  };\n\n  var createLine = function createLine(markup) {\n    var shape = svg('g', {\n      id: markup.id,\n      'stroke-linecap': 'round',\n      'stroke-linejoin': 'round'\n    });\n\n    var line = svg('line');\n    shape.appendChild(line);\n\n    var begin = svg('path');\n    shape.appendChild(begin);\n\n    var end = svg('path');\n    shape.appendChild(end);\n\n    return shape;\n  };\n\n  var CREATE_TYPE_ROUTES = {\n    image: createImage,\n    rect: createShape('rect'),\n    ellipse: createShape('ellipse'),\n    text: createShape('text'),\n    path: createShape('path'),\n    line: createLine\n  };\n\n  var UPDATE_TYPE_ROUTES = {\n    rect: updateRect,\n    ellipse: updateEllipse,\n    image: updateImage,\n    text: updateText,\n    path: updatePath,\n    line: updateLine\n  };\n\n  var createMarkupByType = function createMarkupByType(type, markup) {\n    return CREATE_TYPE_ROUTES[type](markup);\n  };\n\n  var updateMarkupByType = function updateMarkupByType(\n    element,\n    type,\n    markup,\n    size,\n    scale\n  ) {\n    if (type !== 'path') {\n      element.rect = getMarkupRect(markup, size, scale);\n    }\n    element.styles = getMarkupStyles(markup, size, scale);\n    UPDATE_TYPE_ROUTES[type](element, markup, size, scale);\n  };\n\n  var sortMarkupByZIndex = function sortMarkupByZIndex(a, b) {\n    if (a[1].zIndex > b[1].zIndex) {\n      return 1;\n    }\n    if (a[1].zIndex < b[1].zIndex) {\n      return -1;\n    }\n    return 0;\n  };\n\n  var cropSVG = function cropSVG(blob) {\n    var crop =\n      arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    var markup = arguments.length > 2 ? arguments[2] : undefined;\n    var options = arguments.length > 3 ? arguments[3] : undefined;\n    return new Promise(function(resolve) {\n      var _options$background = options.background,\n        background =\n          _options$background === void 0 ? null : _options$background;\n\n      // load blob contents and wrap in crop svg\n      var fr = new FileReader();\n      fr.onloadend = function() {\n        // get svg text\n        var text = fr.result;\n\n        // create element with svg and get size\n        var original = document.createElement('div');\n        original.style.cssText =\n          'position:absolute;pointer-events:none;width:0;height:0;visibility:hidden;';\n        original.innerHTML = text;\n        var originalNode = original.querySelector('svg');\n        document.body.appendChild(original);\n\n        // request bounding box dimensions\n        var bBox = originalNode.getBBox();\n        original.parentNode.removeChild(original);\n\n        // get title\n        var titleNode = original.querySelector('title');\n\n        // calculate new heights and widths\n        var viewBoxAttribute = originalNode.getAttribute('viewBox') || '';\n        var widthAttribute = originalNode.getAttribute('width') || '';\n        var heightAttribute = originalNode.getAttribute('height') || '';\n        var width = parseFloat(widthAttribute) || null;\n        var height = parseFloat(heightAttribute) || null;\n        var widthUnits = (widthAttribute.match(/[a-z]+/) || [])[0] || '';\n        var heightUnits = (heightAttribute.match(/[a-z]+/) || [])[0] || '';\n\n        // create new size\n        var viewBoxList = viewBoxAttribute.split(' ').map(parseFloat);\n        var viewBox = viewBoxList.length\n          ? {\n              x: viewBoxList[0],\n              y: viewBoxList[1],\n              width: viewBoxList[2],\n              height: viewBoxList[3]\n            }\n          : bBox;\n\n        var imageWidth = width != null ? width : viewBox.width;\n        var imageHeight = height != null ? height : viewBox.height;\n\n        originalNode.style.overflow = 'visible';\n        originalNode.setAttribute('width', imageWidth);\n        originalNode.setAttribute('height', imageHeight);\n\n        // markup\n        var markupSVG = '';\n        if (markup && markup.length) {\n          var size = {\n            width: imageWidth,\n            height: imageHeight\n          };\n\n          markupSVG = markup\n            .sort(sortMarkupByZIndex)\n            .reduce(function(prev, shape) {\n              var el = createMarkupByType(shape[0], shape[1]);\n              updateMarkupByType(el, shape[0], shape[1], size);\n              el.removeAttribute('id');\n              if (el.getAttribute('opacity') === 1) {\n                el.removeAttribute('opacity');\n              }\n              return prev + '\\n' + el.outerHTML + '\\n';\n            }, '');\n          markupSVG = '\\n\\n<g>'.concat(\n            markupSVG.replace(/&nbsp;/g, ' '),\n            '</g>\\n\\n'\n          );\n        }\n\n        var aspectRatio = crop.aspectRatio || imageHeight / imageWidth;\n\n        var canvasWidth = imageWidth;\n        var canvasHeight = canvasWidth * aspectRatio;\n\n        var shouldLimit =\n          typeof crop.scaleToFit === 'undefined' || crop.scaleToFit;\n\n        var cropCenterX = crop.center ? crop.center.x : 0.5;\n        var cropCenterY = crop.center ? crop.center.y : 0.5;\n\n        var canvasZoomFactor = getImageRectZoomFactor(\n          {\n            width: imageWidth,\n            height: imageHeight\n          },\n\n          getCenteredCropRect(\n            {\n              width: canvasWidth,\n              height: canvasHeight\n            },\n\n            aspectRatio\n          ),\n\n          crop.rotation,\n          shouldLimit\n            ? { x: cropCenterX, y: cropCenterY }\n            : {\n                x: 0.5,\n                y: 0.5\n              }\n        );\n\n        var scale = crop.zoom * canvasZoomFactor;\n\n        var rotation = crop.rotation * (180 / Math.PI);\n\n        var canvasCenter = {\n          x: canvasWidth * 0.5,\n          y: canvasHeight * 0.5\n        };\n\n        var imageOffset = {\n          x: canvasCenter.x - imageWidth * cropCenterX,\n          y: canvasCenter.y - imageHeight * cropCenterY\n        };\n\n        var cropTransforms = [\n          // rotate\n          'rotate('\n            .concat(rotation, ' ')\n            .concat(canvasCenter.x, ' ')\n            .concat(canvasCenter.y, ')'),\n\n          // scale\n          'translate('.concat(canvasCenter.x, ' ').concat(canvasCenter.y, ')'),\n          'scale('.concat(scale, ')'),\n          'translate('\n            .concat(-canvasCenter.x, ' ')\n            .concat(-canvasCenter.y, ')'),\n\n          // offset\n          'translate('.concat(imageOffset.x, ' ').concat(imageOffset.y, ')')\n        ];\n\n        var cropFlipHorizontal = crop.flip && crop.flip.horizontal;\n        var cropFlipVertical = crop.flip && crop.flip.vertical;\n\n        var flipTransforms = [\n          'scale('\n            .concat(cropFlipHorizontal ? -1 : 1, ' ')\n            .concat(cropFlipVertical ? -1 : 1, ')'),\n          'translate('\n            .concat(cropFlipHorizontal ? -imageWidth : 0, ' ')\n            .concat(cropFlipVertical ? -imageHeight : 0, ')')\n        ];\n\n        // crop\n        var transformed = '<?xml version=\"1.0\" encoding=\"UTF-8\"?>\\n<svg width=\"'\n          .concat(canvasWidth)\n          .concat(widthUnits, '\" height=\"')\n          .concat(canvasHeight)\n          .concat(heightUnits, '\" \\nviewBox=\"0 0 ')\n          .concat(canvasWidth, ' ')\n          .concat(canvasHeight, '\" ')\n          .concat(\n            background ? 'style=\"background:' + background + '\" ' : '',\n            '\\npreserveAspectRatio=\"xMinYMin\"\\nxmlns:xlink=\"http://www.w3.org/1999/xlink\"\\nxmlns=\"http://www.w3.org/2000/svg\">\\n<!-- Generated by PQINA - https://pqina.nl/ -->\\n<title>'\n          )\n          .concat(\n            titleNode ? titleNode.textContent : '',\n            '</title>\\n<g transform=\"'\n          )\n          .concat(cropTransforms.join(' '), '\">\\n<g transform=\"')\n          .concat(flipTransforms.join(' '), '\">\\n')\n          .concat(originalNode.outerHTML)\n          .concat(markupSVG, '\\n</g>\\n</g>\\n</svg>');\n\n        // create new svg file\n        resolve(transformed);\n      };\n\n      fr.readAsText(blob);\n    });\n  };\n\n  var objectToImageData = function objectToImageData(obj) {\n    var imageData;\n    try {\n      imageData = new ImageData(obj.width, obj.height);\n    } catch (e) {\n      // IE + Old EDGE (tested on 12)\n      var canvas = document.createElement('canvas');\n      imageData = canvas\n        .getContext('2d')\n        .createImageData(obj.width, obj.height);\n    }\n    imageData.data.set(obj.data);\n    return imageData;\n  };\n\n  /* javascript-obfuscator:disable */\n  var TransformWorker = function TransformWorker() {\n    // maps transform types to transform functions\n    var TRANSFORMS = { resize: resize, filter: filter };\n\n    // applies all image transforms to the image data array\n    var applyTransforms = function applyTransforms(transforms, imageData) {\n      transforms.forEach(function(transform) {\n        imageData = TRANSFORMS[transform.type](imageData, transform.data);\n      });\n      return imageData;\n    };\n\n    // transform image hub\n    var transform = function transform(data, cb) {\n      var transforms = data.transforms;\n\n      // if has filter and has resize, move filter to resize operation\n      var filterTransform = null;\n      transforms.forEach(function(transform) {\n        if (transform.type === 'filter') {\n          filterTransform = transform;\n        }\n      });\n      if (filterTransform) {\n        // find resize\n        var resizeTransform = null;\n        transforms.forEach(function(transform) {\n          if (transform.type === 'resize') {\n            resizeTransform = transform;\n          }\n        });\n\n        if (resizeTransform) {\n          // update resize operation\n          resizeTransform.data.matrix = filterTransform.data;\n\n          // remove filter\n          transforms = transforms.filter(function(transform) {\n            return transform.type !== 'filter';\n          });\n        }\n      }\n\n      cb(applyTransforms(transforms, data.imageData));\n    };\n\n    // eslint-disable-next-line no-restricted-globals\n    self.onmessage = function(e) {\n      transform(e.data.message, function(response) {\n        // eslint-disable-next-line no-restricted-globals\n        self.postMessage({ id: e.data.id, message: response }, [\n          response.data.buffer\n        ]);\n      });\n    };\n\n    var br = 1.0;\n    var bg = 1.0;\n    var bb = 1.0;\n    function applyFilterMatrix(index, data, m) {\n      var ir = data[index] / 255;\n      var ig = data[index + 1] / 255;\n      var ib = data[index + 2] / 255;\n      var ia = data[index + 3] / 255;\n\n      var mr = ir * m[0] + ig * m[1] + ib * m[2] + ia * m[3] + m[4];\n      var mg = ir * m[5] + ig * m[6] + ib * m[7] + ia * m[8] + m[9];\n      var mb = ir * m[10] + ig * m[11] + ib * m[12] + ia * m[13] + m[14];\n      var ma = ir * m[15] + ig * m[16] + ib * m[17] + ia * m[18] + m[19];\n\n      var or = Math.max(0, mr * ma) + br * (1.0 - ma);\n      var og = Math.max(0, mg * ma) + bg * (1.0 - ma);\n      var ob = Math.max(0, mb * ma) + bb * (1.0 - ma);\n\n      data[index] = Math.max(0.0, Math.min(1.0, or)) * 255;\n      data[index + 1] = Math.max(0.0, Math.min(1.0, og)) * 255;\n      data[index + 2] = Math.max(0.0, Math.min(1.0, ob)) * 255;\n    }\n\n    var identityMatrix = self.JSON.stringify([\n      1,\n      0,\n      0,\n      0,\n      0,\n      0,\n      1,\n      0,\n      0,\n      0,\n      0,\n      0,\n      1,\n      0,\n      0,\n      0,\n      0,\n      0,\n      1,\n      0\n    ]);\n    function isIdentityMatrix(filter) {\n      return self.JSON.stringify(filter || []) === identityMatrix;\n    }\n\n    function filter(imageData, matrix) {\n      if (!matrix || isIdentityMatrix(matrix)) return imageData;\n\n      var data = imageData.data;\n      var l = data.length;\n\n      var m11 = matrix[0];\n      var m12 = matrix[1];\n      var m13 = matrix[2];\n      var m14 = matrix[3];\n      var m15 = matrix[4];\n\n      var m21 = matrix[5];\n      var m22 = matrix[6];\n      var m23 = matrix[7];\n      var m24 = matrix[8];\n      var m25 = matrix[9];\n\n      var m31 = matrix[10];\n      var m32 = matrix[11];\n      var m33 = matrix[12];\n      var m34 = matrix[13];\n      var m35 = matrix[14];\n\n      var m41 = matrix[15];\n      var m42 = matrix[16];\n      var m43 = matrix[17];\n      var m44 = matrix[18];\n      var m45 = matrix[19];\n\n      var index = 0,\n        r = 0.0,\n        g = 0.0,\n        b = 0.0,\n        a = 0.0,\n        mr = 0.0,\n        mg = 0.0,\n        mb = 0.0,\n        ma = 0.0,\n        or = 0.0,\n        og = 0.0,\n        ob = 0.0;\n\n      for (; index < l; index += 4) {\n        r = data[index] / 255;\n        g = data[index + 1] / 255;\n        b = data[index + 2] / 255;\n        a = data[index + 3] / 255;\n\n        mr = r * m11 + g * m12 + b * m13 + a * m14 + m15;\n        mg = r * m21 + g * m22 + b * m23 + a * m24 + m25;\n        mb = r * m31 + g * m32 + b * m33 + a * m34 + m35;\n        ma = r * m41 + g * m42 + b * m43 + a * m44 + m45;\n\n        or = Math.max(0, mr * ma) + br * (1.0 - ma);\n        og = Math.max(0, mg * ma) + bg * (1.0 - ma);\n        ob = Math.max(0, mb * ma) + bb * (1.0 - ma);\n\n        data[index] = Math.max(0.0, Math.min(1.0, or)) * 255;\n        data[index + 1] = Math.max(0.0, Math.min(1.0, og)) * 255;\n        data[index + 2] = Math.max(0.0, Math.min(1.0, ob)) * 255;\n        // don't update alpha value\n      }\n\n      return imageData;\n    }\n\n    function resize(imageData, data) {\n      var _data$mode = data.mode,\n        mode = _data$mode === void 0 ? 'contain' : _data$mode,\n        _data$upscale = data.upscale,\n        upscale = _data$upscale === void 0 ? false : _data$upscale,\n        width = data.width,\n        height = data.height,\n        matrix = data.matrix;\n\n      // test if is identity matrix\n      matrix = !matrix || isIdentityMatrix(matrix) ? null : matrix;\n\n      // need at least a width or a height\n      // also 0 is not a valid width or height\n      if (!width && !height) {\n        return filter(imageData, matrix);\n      }\n\n      // make sure all bounds are set\n      if (width === null) {\n        width = height;\n      } else if (height === null) {\n        height = width;\n      }\n\n      if (mode !== 'force') {\n        var scalarWidth = width / imageData.width;\n        var scalarHeight = height / imageData.height;\n        var scalar = 1;\n\n        if (mode === 'cover') {\n          scalar = Math.max(scalarWidth, scalarHeight);\n        } else if (mode === 'contain') {\n          scalar = Math.min(scalarWidth, scalarHeight);\n        }\n\n        // if image is too small, exit here with original image\n        if (scalar > 1 && upscale === false) {\n          return filter(imageData, matrix);\n        }\n\n        width = imageData.width * scalar;\n        height = imageData.height * scalar;\n      }\n\n      var originWidth = imageData.width;\n      var originHeight = imageData.height;\n      var targetWidth = Math.round(width);\n      var targetHeight = Math.round(height);\n      var inputData = imageData.data;\n      var outputData = new Uint8ClampedArray(targetWidth * targetHeight * 4);\n      var ratioWidth = originWidth / targetWidth;\n      var ratioHeight = originHeight / targetHeight;\n      var ratioWidthHalf = Math.ceil(ratioWidth * 0.5);\n      var ratioHeightHalf = Math.ceil(ratioHeight * 0.5);\n\n      for (var j = 0; j < targetHeight; j++) {\n        for (var i = 0; i < targetWidth; i++) {\n          var x2 = (i + j * targetWidth) * 4;\n          var weight = 0;\n          var weights = 0;\n          var weightsAlpha = 0;\n          var r = 0;\n          var g = 0;\n          var b = 0;\n          var a = 0;\n          var centerY = (j + 0.5) * ratioHeight;\n\n          for (\n            var yy = Math.floor(j * ratioHeight);\n            yy < (j + 1) * ratioHeight;\n            yy++\n          ) {\n            var dy = Math.abs(centerY - (yy + 0.5)) / ratioHeightHalf;\n            var centerX = (i + 0.5) * ratioWidth;\n            var w0 = dy * dy;\n\n            for (\n              var xx = Math.floor(i * ratioWidth);\n              xx < (i + 1) * ratioWidth;\n              xx++\n            ) {\n              var dx = Math.abs(centerX - (xx + 0.5)) / ratioWidthHalf;\n              var w = Math.sqrt(w0 + dx * dx);\n\n              if (w >= -1 && w <= 1) {\n                weight = 2 * w * w * w - 3 * w * w + 1;\n\n                if (weight > 0) {\n                  dx = 4 * (xx + yy * originWidth);\n\n                  var ref = inputData[dx + 3];\n                  a += weight * ref;\n                  weightsAlpha += weight;\n\n                  if (ref < 255) {\n                    weight = (weight * ref) / 250;\n                  }\n\n                  r += weight * inputData[dx];\n                  g += weight * inputData[dx + 1];\n                  b += weight * inputData[dx + 2];\n                  weights += weight;\n                }\n              }\n            }\n          }\n\n          outputData[x2] = r / weights;\n          outputData[x2 + 1] = g / weights;\n          outputData[x2 + 2] = b / weights;\n          outputData[x2 + 3] = a / weightsAlpha;\n\n          matrix && applyFilterMatrix(x2, outputData, matrix);\n        }\n      }\n\n      return {\n        data: outputData,\n        width: targetWidth,\n        height: targetHeight\n      };\n    }\n  };\n  /* javascript-obfuscator:enable */\n\n  var correctOrientation = function correctOrientation(view, offset) {\n    // Missing 0x45786966 Marker? No Exif Header, stop here\n    if (view.getUint32(offset + 4, false) !== 0x45786966) return;\n\n    // next byte!\n    offset += 4;\n\n    // First 2bytes defines byte align of TIFF data.\n    // If it is 0x4949=\"I I\", it means \"Intel\" type byte align\n    var intelByteAligned = view.getUint16((offset += 6), false) === 0x4949;\n    offset += view.getUint32(offset + 4, intelByteAligned);\n\n    var tags = view.getUint16(offset, intelByteAligned);\n    offset += 2;\n\n    // find Orientation tag\n    for (var i = 0; i < tags; i++) {\n      if (view.getUint16(offset + i * 12, intelByteAligned) === 0x0112) {\n        view.setUint16(offset + i * 12 + 8, 1, intelByteAligned);\n        return true;\n      }\n    }\n    return false;\n  };\n\n  var readData = function readData(data) {\n    var view = new DataView(data);\n\n    // Every JPEG file starts from binary value '0xFFD8'\n    // If it's not present, exit here\n    if (view.getUint16(0) !== 0xffd8) return null;\n\n    var offset = 2; // Start at 2 as we skipped two bytes (FFD8)\n    var marker;\n    var markerLength;\n    var orientationCorrected = false;\n\n    while (offset < view.byteLength) {\n      marker = view.getUint16(offset, false);\n      markerLength = view.getUint16(offset + 2, false) + 2;\n\n      // Test if is APP and COM markers\n      var isData = (marker >= 0xffe0 && marker <= 0xffef) || marker === 0xfffe;\n      if (!isData) {\n        break;\n      }\n\n      if (!orientationCorrected) {\n        orientationCorrected = correctOrientation(view, offset, markerLength);\n      }\n\n      if (offset + markerLength > view.byteLength) {\n        break;\n      }\n\n      offset += markerLength;\n    }\n    return data.slice(0, offset);\n  };\n\n  var getImageHead = function getImageHead(file) {\n    return new Promise(function(resolve) {\n      var reader = new FileReader();\n      reader.onload = function() {\n        return resolve(readData(reader.result) || null);\n      };\n      reader.readAsArrayBuffer(file.slice(0, 256 * 1024));\n    });\n  };\n\n  var getBlobBuilder = function getBlobBuilder() {\n    return (window.BlobBuilder =\n      window.BlobBuilder ||\n      window.WebKitBlobBuilder ||\n      window.MozBlobBuilder ||\n      window.MSBlobBuilder);\n  };\n\n  var createBlob = function createBlob(arrayBuffer, mimeType) {\n    var BB = getBlobBuilder();\n\n    if (BB) {\n      var bb = new BB();\n      bb.append(arrayBuffer);\n      return bb.getBlob(mimeType);\n    }\n\n    return new Blob([arrayBuffer], {\n      type: mimeType\n    });\n  };\n\n  var getUniqueId = function getUniqueId() {\n    return Math.random()\n      .toString(36)\n      .substr(2, 9);\n  };\n\n  var createWorker = function createWorker(fn) {\n    var workerBlob = new Blob(['(', fn.toString(), ')()'], {\n      type: 'application/javascript'\n    });\n    var workerURL = URL.createObjectURL(workerBlob);\n    var worker = new Worker(workerURL);\n\n    var trips = [];\n\n    return {\n      transfer: function transfer() {}, // (message, cb) => {}\n      post: function post(message, cb, transferList) {\n        var id = getUniqueId();\n        trips[id] = cb;\n\n        worker.onmessage = function(e) {\n          var cb = trips[e.data.id];\n          if (!cb) return;\n          cb(e.data.message);\n          delete trips[e.data.id];\n        };\n\n        worker.postMessage(\n          {\n            id: id,\n            message: message\n          },\n\n          transferList\n        );\n      },\n      terminate: function terminate() {\n        worker.terminate();\n        URL.revokeObjectURL(workerURL);\n      }\n    };\n  };\n\n  var loadImage = function loadImage(url) {\n    return new Promise(function(resolve, reject) {\n      var img = new Image();\n      img.onload = function() {\n        resolve(img);\n      };\n      img.onerror = function(e) {\n        reject(e);\n      };\n      img.src = url;\n    });\n  };\n\n  var chain = function chain(funcs) {\n    return funcs.reduce(function(promise, func) {\n      return promise.then(function(result) {\n        return func().then(Array.prototype.concat.bind(result));\n      });\n    }, Promise.resolve([]));\n  };\n\n  var canvasApplyMarkup = function canvasApplyMarkup(canvas, markup) {\n    return new Promise(function(resolve) {\n      var size = {\n        width: canvas.width,\n        height: canvas.height\n      };\n\n      var ctx = canvas.getContext('2d');\n\n      var drawers = markup.sort(sortMarkupByZIndex).map(function(item) {\n        return function() {\n          return new Promise(function(resolve) {\n            var result = TYPE_DRAW_ROUTES[item[0]](ctx, size, item[1], resolve);\n            if (result) resolve();\n          });\n        };\n      });\n\n      chain(drawers).then(function() {\n        return resolve(canvas);\n      });\n    });\n  };\n\n  var applyMarkupStyles = function applyMarkupStyles(ctx, styles) {\n    ctx.beginPath();\n    ctx.lineCap = styles['stroke-linecap'];\n    ctx.lineJoin = styles['stroke-linejoin'];\n    ctx.lineWidth = styles['stroke-width'];\n    if (styles['stroke-dasharray'].length) {\n      ctx.setLineDash(styles['stroke-dasharray'].split(','));\n    }\n    ctx.fillStyle = styles['fill'];\n    ctx.strokeStyle = styles['stroke'];\n    ctx.globalAlpha = styles.opacity || 1;\n  };\n\n  var drawMarkupStyles = function drawMarkupStyles(ctx) {\n    ctx.fill();\n    ctx.stroke();\n    ctx.globalAlpha = 1;\n  };\n\n  var drawRect = function drawRect(ctx, size, markup) {\n    var rect = getMarkupRect(markup, size);\n    var styles = getMarkupStyles(markup, size);\n    applyMarkupStyles(ctx, styles);\n    ctx.rect(rect.x, rect.y, rect.width, rect.height);\n    drawMarkupStyles(ctx, styles);\n    return true;\n  };\n\n  var drawEllipse = function drawEllipse(ctx, size, markup) {\n    var rect = getMarkupRect(markup, size);\n    var styles = getMarkupStyles(markup, size);\n    applyMarkupStyles(ctx, styles);\n\n    var x = rect.x,\n      y = rect.y,\n      w = rect.width,\n      h = rect.height,\n      kappa = 0.5522848,\n      ox = (w / 2) * kappa,\n      oy = (h / 2) * kappa,\n      xe = x + w,\n      ye = y + h,\n      xm = x + w / 2,\n      ym = y + h / 2;\n\n    ctx.moveTo(x, ym);\n    ctx.bezierCurveTo(x, ym - oy, xm - ox, y, xm, y);\n    ctx.bezierCurveTo(xm + ox, y, xe, ym - oy, xe, ym);\n    ctx.bezierCurveTo(xe, ym + oy, xm + ox, ye, xm, ye);\n    ctx.bezierCurveTo(xm - ox, ye, x, ym + oy, x, ym);\n\n    drawMarkupStyles(ctx, styles);\n    return true;\n  };\n\n  var drawImage = function drawImage(ctx, size, markup, done) {\n    var rect = getMarkupRect(markup, size);\n    var styles = getMarkupStyles(markup, size);\n    applyMarkupStyles(ctx, styles);\n\n    var image = new Image();\n\n    // if is cross origin image add cross origin attribute\n    var isCrossOriginImage =\n      new URL(markup.src, window.location.href).origin !==\n      window.location.origin;\n    if (isCrossOriginImage) image.crossOrigin = '';\n\n    image.onload = function() {\n      if (markup.fit === 'cover') {\n        var ar = rect.width / rect.height;\n        var width = ar > 1 ? image.width : image.height * ar;\n        var height = ar > 1 ? image.width / ar : image.height;\n        var x = image.width * 0.5 - width * 0.5;\n        var y = image.height * 0.5 - height * 0.5;\n        ctx.drawImage(\n          image,\n          x,\n          y,\n          width,\n          height,\n          rect.x,\n          rect.y,\n          rect.width,\n          rect.height\n        );\n      } else if (markup.fit === 'contain') {\n        var scalar = Math.min(\n          rect.width / image.width,\n          rect.height / image.height\n        );\n        var _width = scalar * image.width;\n        var _height = scalar * image.height;\n        var _x = rect.x + rect.width * 0.5 - _width * 0.5;\n        var _y = rect.y + rect.height * 0.5 - _height * 0.5;\n        ctx.drawImage(\n          image,\n          0,\n          0,\n          image.width,\n          image.height,\n          _x,\n          _y,\n          _width,\n          _height\n        );\n      } else {\n        ctx.drawImage(\n          image,\n          0,\n          0,\n          image.width,\n          image.height,\n          rect.x,\n          rect.y,\n          rect.width,\n          rect.height\n        );\n      }\n\n      drawMarkupStyles(ctx, styles);\n      done();\n    };\n    image.src = markup.src;\n  };\n\n  var drawText = function drawText(ctx, size, markup) {\n    var rect = getMarkupRect(markup, size);\n    var styles = getMarkupStyles(markup, size);\n    applyMarkupStyles(ctx, styles);\n\n    var fontSize = getMarkupValue(markup.fontSize, size);\n    var fontFamily = markup.fontFamily || 'sans-serif';\n    var fontWeight = markup.fontWeight || 'normal';\n    var textAlign = markup.textAlign || 'left';\n\n    ctx.font = ''\n      .concat(fontWeight, ' ')\n      .concat(fontSize, 'px ')\n      .concat(fontFamily);\n    ctx.textAlign = textAlign;\n    ctx.fillText(markup.text, rect.x, rect.y);\n\n    drawMarkupStyles(ctx, styles);\n    return true;\n  };\n\n  var drawPath = function drawPath(ctx, size, markup) {\n    var styles = getMarkupStyles(markup, size);\n    applyMarkupStyles(ctx, styles);\n    ctx.beginPath();\n\n    var points = markup.points.map(function(point) {\n      return {\n        x: getMarkupValue(point.x, size, 1, 'width'),\n        y: getMarkupValue(point.y, size, 1, 'height')\n      };\n    });\n\n    ctx.moveTo(points[0].x, points[0].y);\n    var l = points.length;\n    for (var i = 1; i < l; i++) {\n      ctx.lineTo(points[i].x, points[i].y);\n    }\n\n    drawMarkupStyles(ctx, styles);\n    return true;\n  };\n\n  var drawLine = function drawLine(ctx, size, markup) {\n    var rect = getMarkupRect(markup, size);\n    var styles = getMarkupStyles(markup, size);\n    applyMarkupStyles(ctx, styles);\n\n    ctx.beginPath();\n\n    var origin = {\n      x: rect.x,\n      y: rect.y\n    };\n\n    var target = {\n      x: rect.x + rect.width,\n      y: rect.y + rect.height\n    };\n\n    ctx.moveTo(origin.x, origin.y);\n    ctx.lineTo(target.x, target.y);\n\n    var v = vectorNormalize({\n      x: target.x - origin.x,\n      y: target.y - origin.y\n    });\n\n    var l = 0.04 * Math.min(size.width, size.height);\n\n    if (markup.lineDecoration.indexOf('arrow-begin') !== -1) {\n      var arrowBeginRotationPoint = vectorMultiply(v, l);\n      var arrowBeginCenter = vectorAdd(origin, arrowBeginRotationPoint);\n      var arrowBeginA = vectorRotate(origin, 2, arrowBeginCenter);\n      var arrowBeginB = vectorRotate(origin, -2, arrowBeginCenter);\n\n      ctx.moveTo(arrowBeginA.x, arrowBeginA.y);\n      ctx.lineTo(origin.x, origin.y);\n      ctx.lineTo(arrowBeginB.x, arrowBeginB.y);\n    }\n    if (markup.lineDecoration.indexOf('arrow-end') !== -1) {\n      var arrowEndRotationPoint = vectorMultiply(v, -l);\n      var arrowEndCenter = vectorAdd(target, arrowEndRotationPoint);\n      var arrowEndA = vectorRotate(target, 2, arrowEndCenter);\n      var arrowEndB = vectorRotate(target, -2, arrowEndCenter);\n\n      ctx.moveTo(arrowEndA.x, arrowEndA.y);\n      ctx.lineTo(target.x, target.y);\n      ctx.lineTo(arrowEndB.x, arrowEndB.y);\n    }\n\n    drawMarkupStyles(ctx, styles);\n    return true;\n  };\n\n  var TYPE_DRAW_ROUTES = {\n    rect: drawRect,\n    ellipse: drawEllipse,\n    image: drawImage,\n    text: drawText,\n    line: drawLine,\n    path: drawPath\n  };\n\n  var imageDataToCanvas = function imageDataToCanvas(imageData) {\n    var image = document.createElement('canvas');\n    image.width = imageData.width;\n    image.height = imageData.height;\n    var ctx = image.getContext('2d');\n    ctx.putImageData(imageData, 0, 0);\n    return image;\n  };\n\n  var transformImage = function transformImage(file, instructions) {\n    var options =\n      arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n    return new Promise(function(resolve, reject) {\n      // if the file is not an image we do not have any business transforming it\n      if (!file || !isImage$1(file))\n        return reject({ status: 'not an image file', file: file });\n\n      // get separate options for easier use\n      var stripImageHead = options.stripImageHead,\n        beforeCreateBlob = options.beforeCreateBlob,\n        afterCreateBlob = options.afterCreateBlob,\n        canvasMemoryLimit = options.canvasMemoryLimit;\n\n      // get crop\n      var crop = instructions.crop,\n        size = instructions.size,\n        filter = instructions.filter,\n        markup = instructions.markup,\n        output = instructions.output;\n\n      // get exif orientation\n      var orientation =\n        instructions.image && instructions.image.orientation\n          ? Math.max(1, Math.min(8, instructions.image.orientation))\n          : null;\n\n      // compression quality 0 => 100\n      var qualityAsPercentage = output && output.quality;\n      var quality =\n        qualityAsPercentage === null ? null : qualityAsPercentage / 100;\n\n      // output format\n      var type = (output && output.type) || null;\n\n      // background color\n      var background = (output && output.background) || null;\n\n      // get transforms\n      var transforms = [];\n\n      // add resize transforms if set\n      if (\n        size &&\n        (typeof size.width === 'number' || typeof size.height === 'number')\n      ) {\n        transforms.push({ type: 'resize', data: size });\n      }\n\n      // add filters\n      if (filter && filter.length === 20) {\n        transforms.push({ type: 'filter', data: filter });\n      }\n\n      // resolves with supplied blob\n      var resolveWithBlob = function resolveWithBlob(blob) {\n        var promisedBlob = afterCreateBlob ? afterCreateBlob(blob) : blob;\n        Promise.resolve(promisedBlob).then(resolve);\n      };\n\n      // done\n      var toBlob = function toBlob(imageData, options) {\n        var canvas = imageDataToCanvas(imageData);\n        var promisedCanvas = markup.length\n          ? canvasApplyMarkup(canvas, markup)\n          : canvas;\n        Promise.resolve(promisedCanvas).then(function(canvas) {\n          canvasToBlob(canvas, options, beforeCreateBlob)\n            .then(function(blob) {\n              // force release of canvas memory\n              canvasRelease(canvas);\n\n              // remove image head (default)\n              if (stripImageHead) return resolveWithBlob(blob);\n\n              // try to copy image head from original file to generated blob\n              getImageHead(file).then(function(imageHead) {\n                // re-inject image head in case of JPEG, as the image head is removed by canvas export\n                if (imageHead !== null) {\n                  blob = new Blob([imageHead, blob.slice(20)], {\n                    type: blob.type\n                  });\n                }\n\n                // done!\n                resolveWithBlob(blob);\n              });\n            })\n            .catch(reject);\n        });\n      };\n\n      // if this is an svg and we want it to stay an svg\n      if (/svg/.test(file.type) && type === null) {\n        return cropSVG(file, crop, markup, { background: background }).then(\n          function(text) {\n            resolve(createBlob(text, 'image/svg+xml'));\n          }\n        );\n      }\n\n      // get file url\n      var url = URL.createObjectURL(file);\n\n      // turn the file into an image\n      loadImage(url)\n        .then(function(image) {\n          // url is no longer needed\n          URL.revokeObjectURL(url);\n\n          // draw to canvas and start transform chain\n          var imageData = imageToImageData(image, orientation, crop, {\n            canvasMemoryLimit: canvasMemoryLimit,\n            background: background\n          });\n\n          // determine the format of the blob that we will output\n          var outputFormat = {\n            quality: quality,\n            type: type || file.type\n          };\n\n          // no transforms necessary, we done!\n          if (!transforms.length) {\n            return toBlob(imageData, outputFormat);\n          }\n\n          // send to the transform worker to transform the blob on a separate thread\n          var worker = createWorker(TransformWorker);\n          worker.post(\n            {\n              transforms: transforms,\n              imageData: imageData\n            },\n\n            function(response) {\n              // finish up\n              toBlob(objectToImageData(response), outputFormat);\n\n              // stop worker\n              worker.terminate();\n            },\n            [imageData.data.buffer]\n          );\n        })\n        .catch(reject);\n    });\n  };\n\n  function _typeof(obj) {\n    if (typeof Symbol === 'function' && typeof Symbol.iterator === 'symbol') {\n      _typeof = function(obj) {\n        return typeof obj;\n      };\n    } else {\n      _typeof = function(obj) {\n        return obj &&\n          typeof Symbol === 'function' &&\n          obj.constructor === Symbol &&\n          obj !== Symbol.prototype\n          ? 'symbol'\n          : typeof obj;\n      };\n    }\n\n    return _typeof(obj);\n  }\n\n  var REACT_ELEMENT_TYPE;\n\n  function _jsx(type, props, key, children) {\n    if (!REACT_ELEMENT_TYPE) {\n      REACT_ELEMENT_TYPE =\n        (typeof Symbol === 'function' &&\n          Symbol.for &&\n          Symbol.for('react.element')) ||\n        0xeac7;\n    }\n\n    var defaultProps = type && type.defaultProps;\n    var childrenLength = arguments.length - 3;\n\n    if (!props && childrenLength !== 0) {\n      props = {\n        children: void 0\n      };\n    }\n\n    if (props && defaultProps) {\n      for (var propName in defaultProps) {\n        if (props[propName] === void 0) {\n          props[propName] = defaultProps[propName];\n        }\n      }\n    } else if (!props) {\n      props = defaultProps || {};\n    }\n\n    if (childrenLength === 1) {\n      props.children = children;\n    } else if (childrenLength > 1) {\n      var childArray = new Array(childrenLength);\n\n      for (var i = 0; i < childrenLength; i++) {\n        childArray[i] = arguments[i + 3];\n      }\n\n      props.children = childArray;\n    }\n\n    return {\n      $$typeof: REACT_ELEMENT_TYPE,\n      type: type,\n      key: key === undefined ? null : '' + key,\n      ref: null,\n      props: props,\n      _owner: null\n    };\n  }\n\n  function _asyncIterator(iterable) {\n    var method;\n\n    if (typeof Symbol === 'function') {\n      if (Symbol.asyncIterator) {\n        method = iterable[Symbol.asyncIterator];\n        if (method != null) return method.call(iterable);\n      }\n\n      if (Symbol.iterator) {\n        method = iterable[Symbol.iterator];\n        if (method != null) return method.call(iterable);\n      }\n    }\n\n    throw new TypeError('Object is not async iterable');\n  }\n\n  function _AwaitValue(value) {\n    this.wrapped = value;\n  }\n\n  function _AsyncGenerator(gen) {\n    var front, back;\n\n    function send(key, arg) {\n      return new Promise(function(resolve, reject) {\n        var request = {\n          key: key,\n          arg: arg,\n          resolve: resolve,\n          reject: reject,\n          next: null\n        };\n\n        if (back) {\n          back = back.next = request;\n        } else {\n          front = back = request;\n          resume(key, arg);\n        }\n      });\n    }\n\n    function resume(key, arg) {\n      try {\n        var result = gen[key](arg);\n        var value = result.value;\n        var wrappedAwait = value instanceof _AwaitValue;\n        Promise.resolve(wrappedAwait ? value.wrapped : value).then(\n          function(arg) {\n            if (wrappedAwait) {\n              resume('next', arg);\n              return;\n            }\n\n            settle(result.done ? 'return' : 'normal', arg);\n          },\n          function(err) {\n            resume('throw', err);\n          }\n        );\n      } catch (err) {\n        settle('throw', err);\n      }\n    }\n\n    function settle(type, value) {\n      switch (type) {\n        case 'return':\n          front.resolve({\n            value: value,\n            done: true\n          });\n          break;\n\n        case 'throw':\n          front.reject(value);\n          break;\n\n        default:\n          front.resolve({\n            value: value,\n            done: false\n          });\n          break;\n      }\n\n      front = front.next;\n\n      if (front) {\n        resume(front.key, front.arg);\n      } else {\n        back = null;\n      }\n    }\n\n    this._invoke = send;\n\n    if (typeof gen.return !== 'function') {\n      this.return = undefined;\n    }\n  }\n\n  if (typeof Symbol === 'function' && Symbol.asyncIterator) {\n    _AsyncGenerator.prototype[Symbol.asyncIterator] = function() {\n      return this;\n    };\n  }\n\n  _AsyncGenerator.prototype.next = function(arg) {\n    return this._invoke('next', arg);\n  };\n\n  _AsyncGenerator.prototype.throw = function(arg) {\n    return this._invoke('throw', arg);\n  };\n\n  _AsyncGenerator.prototype.return = function(arg) {\n    return this._invoke('return', arg);\n  };\n\n  function _wrapAsyncGenerator(fn) {\n    return function() {\n      return new _AsyncGenerator(fn.apply(this, arguments));\n    };\n  }\n\n  function _awaitAsyncGenerator(value) {\n    return new _AwaitValue(value);\n  }\n\n  function _asyncGeneratorDelegate(inner, awaitWrap) {\n    var iter = {},\n      waiting = false;\n\n    function pump(key, value) {\n      waiting = true;\n      value = new Promise(function(resolve) {\n        resolve(inner[key](value));\n      });\n      return {\n        done: false,\n        value: awaitWrap(value)\n      };\n    }\n\n    if (typeof Symbol === 'function' && Symbol.iterator) {\n      iter[Symbol.iterator] = function() {\n        return this;\n      };\n    }\n\n    iter.next = function(value) {\n      if (waiting) {\n        waiting = false;\n        return value;\n      }\n\n      return pump('next', value);\n    };\n\n    if (typeof inner.throw === 'function') {\n      iter.throw = function(value) {\n        if (waiting) {\n          waiting = false;\n          throw value;\n        }\n\n        return pump('throw', value);\n      };\n    }\n\n    if (typeof inner.return === 'function') {\n      iter.return = function(value) {\n        return pump('return', value);\n      };\n    }\n\n    return iter;\n  }\n\n  function asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) {\n    try {\n      var info = gen[key](arg);\n      var value = info.value;\n    } catch (error) {\n      reject(error);\n      return;\n    }\n\n    if (info.done) {\n      resolve(value);\n    } else {\n      Promise.resolve(value).then(_next, _throw);\n    }\n  }\n\n  function _asyncToGenerator(fn) {\n    return function() {\n      var self = this,\n        args = arguments;\n      return new Promise(function(resolve, reject) {\n        var gen = fn.apply(self, args);\n\n        function _next(value) {\n          asyncGeneratorStep(\n            gen,\n            resolve,\n            reject,\n            _next,\n            _throw,\n            'next',\n            value\n          );\n        }\n\n        function _throw(err) {\n          asyncGeneratorStep(gen, resolve, reject, _next, _throw, 'throw', err);\n        }\n\n        _next(undefined);\n      });\n    };\n  }\n\n  function _classCallCheck(instance, Constructor) {\n    if (!(instance instanceof Constructor)) {\n      throw new TypeError('Cannot call a class as a function');\n    }\n  }\n\n  function _defineProperties(target, props) {\n    for (var i = 0; i < props.length; i++) {\n      var descriptor = props[i];\n      descriptor.enumerable = descriptor.enumerable || false;\n      descriptor.configurable = true;\n      if ('value' in descriptor) descriptor.writable = true;\n      Object.defineProperty(target, descriptor.key, descriptor);\n    }\n  }\n\n  function _createClass(Constructor, protoProps, staticProps) {\n    if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n    if (staticProps) _defineProperties(Constructor, staticProps);\n    return Constructor;\n  }\n\n  function _defineEnumerableProperties(obj, descs) {\n    for (var key in descs) {\n      var desc = descs[key];\n      desc.configurable = desc.enumerable = true;\n      if ('value' in desc) desc.writable = true;\n      Object.defineProperty(obj, key, desc);\n    }\n\n    if (Object.getOwnPropertySymbols) {\n      var objectSymbols = Object.getOwnPropertySymbols(descs);\n\n      for (var i = 0; i < objectSymbols.length; i++) {\n        var sym = objectSymbols[i];\n        var desc = descs[sym];\n        desc.configurable = desc.enumerable = true;\n        if ('value' in desc) desc.writable = true;\n        Object.defineProperty(obj, sym, desc);\n      }\n    }\n\n    return obj;\n  }\n\n  function _defaults(obj, defaults) {\n    var keys = Object.getOwnPropertyNames(defaults);\n\n    for (var i = 0; i < keys.length; i++) {\n      var key = keys[i];\n      var value = Object.getOwnPropertyDescriptor(defaults, key);\n\n      if (value && value.configurable && obj[key] === undefined) {\n        Object.defineProperty(obj, key, value);\n      }\n    }\n\n    return obj;\n  }\n\n  function _defineProperty(obj, key, value) {\n    if (key in obj) {\n      Object.defineProperty(obj, key, {\n        value: value,\n        enumerable: true,\n        configurable: true,\n        writable: true\n      });\n    } else {\n      obj[key] = value;\n    }\n\n    return obj;\n  }\n\n  function _extends() {\n    _extends =\n      Object.assign ||\n      function(target) {\n        for (var i = 1; i < arguments.length; i++) {\n          var source = arguments[i];\n\n          for (var key in source) {\n            if (Object.prototype.hasOwnProperty.call(source, key)) {\n              target[key] = source[key];\n            }\n          }\n        }\n\n        return target;\n      };\n\n    return _extends.apply(this, arguments);\n  }\n\n  function _objectSpread(target) {\n    for (var i = 1; i < arguments.length; i++) {\n      var source = arguments[i] != null ? arguments[i] : {};\n      var ownKeys = Object.keys(source);\n\n      if (typeof Object.getOwnPropertySymbols === 'function') {\n        ownKeys = ownKeys.concat(\n          Object.getOwnPropertySymbols(source).filter(function(sym) {\n            return Object.getOwnPropertyDescriptor(source, sym).enumerable;\n          })\n        );\n      }\n\n      ownKeys.forEach(function(key) {\n        _defineProperty(target, key, source[key]);\n      });\n    }\n\n    return target;\n  }\n\n  function _inherits(subClass, superClass) {\n    if (typeof superClass !== 'function' && superClass !== null) {\n      throw new TypeError('Super expression must either be null or a function');\n    }\n\n    subClass.prototype = Object.create(superClass && superClass.prototype, {\n      constructor: {\n        value: subClass,\n        writable: true,\n        configurable: true\n      }\n    });\n    if (superClass) _setPrototypeOf(subClass, superClass);\n  }\n\n  function _inheritsLoose(subClass, superClass) {\n    subClass.prototype = Object.create(superClass.prototype);\n    subClass.prototype.constructor = subClass;\n    subClass.__proto__ = superClass;\n  }\n\n  function _getPrototypeOf(o) {\n    _getPrototypeOf = Object.setPrototypeOf\n      ? Object.getPrototypeOf\n      : function _getPrototypeOf(o) {\n          return o.__proto__ || Object.getPrototypeOf(o);\n        };\n    return _getPrototypeOf(o);\n  }\n\n  function _setPrototypeOf(o, p) {\n    _setPrototypeOf =\n      Object.setPrototypeOf ||\n      function _setPrototypeOf(o, p) {\n        o.__proto__ = p;\n        return o;\n      };\n\n    return _setPrototypeOf(o, p);\n  }\n\n  function isNativeReflectConstruct() {\n    if (typeof Reflect === 'undefined' || !Reflect.construct) return false;\n    if (Reflect.construct.sham) return false;\n    if (typeof Proxy === 'function') return true;\n\n    try {\n      Date.prototype.toString.call(Reflect.construct(Date, [], function() {}));\n      return true;\n    } catch (e) {\n      return false;\n    }\n  }\n\n  function _construct(Parent, args, Class) {\n    if (isNativeReflectConstruct()) {\n      _construct = Reflect.construct;\n    } else {\n      _construct = function _construct(Parent, args, Class) {\n        var a = [null];\n        a.push.apply(a, args);\n        var Constructor = Function.bind.apply(Parent, a);\n        var instance = new Constructor();\n        if (Class) _setPrototypeOf(instance, Class.prototype);\n        return instance;\n      };\n    }\n\n    return _construct.apply(null, arguments);\n  }\n\n  function _isNativeFunction(fn) {\n    return Function.toString.call(fn).indexOf('[native code]') !== -1;\n  }\n\n  function _wrapNativeSuper(Class) {\n    var _cache = typeof Map === 'function' ? new Map() : undefined;\n\n    _wrapNativeSuper = function _wrapNativeSuper(Class) {\n      if (Class === null || !_isNativeFunction(Class)) return Class;\n\n      if (typeof Class !== 'function') {\n        throw new TypeError(\n          'Super expression must either be null or a function'\n        );\n      }\n\n      if (typeof _cache !== 'undefined') {\n        if (_cache.has(Class)) return _cache.get(Class);\n\n        _cache.set(Class, Wrapper);\n      }\n\n      function Wrapper() {\n        return _construct(Class, arguments, _getPrototypeOf(this).constructor);\n      }\n\n      Wrapper.prototype = Object.create(Class.prototype, {\n        constructor: {\n          value: Wrapper,\n          enumerable: false,\n          writable: true,\n          configurable: true\n        }\n      });\n      return _setPrototypeOf(Wrapper, Class);\n    };\n\n    return _wrapNativeSuper(Class);\n  }\n\n  function _instanceof(left, right) {\n    if (\n      right != null &&\n      typeof Symbol !== 'undefined' &&\n      right[Symbol.hasInstance]\n    ) {\n      return right[Symbol.hasInstance](left);\n    } else {\n      return left instanceof right;\n    }\n  }\n\n  function _interopRequireDefault(obj) {\n    return obj && obj.__esModule\n      ? obj\n      : {\n          default: obj\n        };\n  }\n\n  function _interopRequireWildcard(obj) {\n    if (obj && obj.__esModule) {\n      return obj;\n    } else {\n      var newObj = {};\n\n      if (obj != null) {\n        for (var key in obj) {\n          if (Object.prototype.hasOwnProperty.call(obj, key)) {\n            var desc =\n              Object.defineProperty && Object.getOwnPropertyDescriptor\n                ? Object.getOwnPropertyDescriptor(obj, key)\n                : {};\n\n            if (desc.get || desc.set) {\n              Object.defineProperty(newObj, key, desc);\n            } else {\n              newObj[key] = obj[key];\n            }\n          }\n        }\n      }\n\n      newObj.default = obj;\n      return newObj;\n    }\n  }\n\n  function _newArrowCheck(innerThis, boundThis) {\n    if (innerThis !== boundThis) {\n      throw new TypeError('Cannot instantiate an arrow function');\n    }\n  }\n\n  function _objectDestructuringEmpty(obj) {\n    if (obj == null) throw new TypeError('Cannot destructure undefined');\n  }\n\n  function _objectWithoutPropertiesLoose(source, excluded) {\n    if (source == null) return {};\n    var target = {};\n    var sourceKeys = Object.keys(source);\n    var key, i;\n\n    for (i = 0; i < sourceKeys.length; i++) {\n      key = sourceKeys[i];\n      if (excluded.indexOf(key) >= 0) continue;\n      target[key] = source[key];\n    }\n\n    return target;\n  }\n\n  function _objectWithoutProperties(source, excluded) {\n    if (source == null) return {};\n\n    var target = _objectWithoutPropertiesLoose(source, excluded);\n\n    var key, i;\n\n    if (Object.getOwnPropertySymbols) {\n      var sourceSymbolKeys = Object.getOwnPropertySymbols(source);\n\n      for (i = 0; i < sourceSymbolKeys.length; i++) {\n        key = sourceSymbolKeys[i];\n        if (excluded.indexOf(key) >= 0) continue;\n        if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue;\n        target[key] = source[key];\n      }\n    }\n\n    return target;\n  }\n\n  function _assertThisInitialized(self) {\n    if (self === void 0) {\n      throw new ReferenceError(\n        \"this hasn't been initialised - super() hasn't been called\"\n      );\n    }\n\n    return self;\n  }\n\n  function _possibleConstructorReturn(self, call) {\n    if (call && (typeof call === 'object' || typeof call === 'function')) {\n      return call;\n    }\n\n    return _assertThisInitialized(self);\n  }\n\n  function _superPropBase(object, property) {\n    while (!Object.prototype.hasOwnProperty.call(object, property)) {\n      object = _getPrototypeOf(object);\n      if (object === null) break;\n    }\n\n    return object;\n  }\n\n  function _get(target, property, receiver) {\n    if (typeof Reflect !== 'undefined' && Reflect.get) {\n      _get = Reflect.get;\n    } else {\n      _get = function _get(target, property, receiver) {\n        var base = _superPropBase(target, property);\n\n        if (!base) return;\n        var desc = Object.getOwnPropertyDescriptor(base, property);\n\n        if (desc.get) {\n          return desc.get.call(receiver);\n        }\n\n        return desc.value;\n      };\n    }\n\n    return _get(target, property, receiver || target);\n  }\n\n  function set(target, property, value, receiver) {\n    if (typeof Reflect !== 'undefined' && Reflect.set) {\n      set = Reflect.set;\n    } else {\n      set = function set(target, property, value, receiver) {\n        var base = _superPropBase(target, property);\n\n        var desc;\n\n        if (base) {\n          desc = Object.getOwnPropertyDescriptor(base, property);\n\n          if (desc.set) {\n            desc.set.call(receiver, value);\n            return true;\n          } else if (!desc.writable) {\n            return false;\n          }\n        }\n\n        desc = Object.getOwnPropertyDescriptor(receiver, property);\n\n        if (desc) {\n          if (!desc.writable) {\n            return false;\n          }\n\n          desc.value = value;\n          Object.defineProperty(receiver, property, desc);\n        } else {\n          _defineProperty(receiver, property, value);\n        }\n\n        return true;\n      };\n    }\n\n    return set(target, property, value, receiver);\n  }\n\n  function _set(target, property, value, receiver, isStrict) {\n    var s = set(target, property, value, receiver || target);\n\n    if (!s && isStrict) {\n      throw new Error('failed to set property');\n    }\n\n    return value;\n  }\n\n  function _taggedTemplateLiteral(strings, raw) {\n    if (!raw) {\n      raw = strings.slice(0);\n    }\n\n    return Object.freeze(\n      Object.defineProperties(strings, {\n        raw: {\n          value: Object.freeze(raw)\n        }\n      })\n    );\n  }\n\n  function _taggedTemplateLiteralLoose(strings, raw) {\n    if (!raw) {\n      raw = strings.slice(0);\n    }\n\n    strings.raw = raw;\n    return strings;\n  }\n\n  function _temporalRef(val, name) {\n    if (val === _temporalUndefined) {\n      throw new ReferenceError(name + ' is not defined - temporal dead zone');\n    } else {\n      return val;\n    }\n  }\n\n  function _readOnlyError(name) {\n    throw new Error('\"' + name + '\" is read-only');\n  }\n\n  function _classNameTDZError(name) {\n    throw new Error(\n      'Class \"' + name + '\" cannot be referenced in computed property keys.'\n    );\n  }\n\n  var _temporalUndefined = {};\n\n  function _slicedToArray(arr, i) {\n    return (\n      _arrayWithHoles(arr) ||\n      _iterableToArrayLimit(arr, i) ||\n      _nonIterableRest()\n    );\n  }\n\n  function _slicedToArrayLoose(arr, i) {\n    return (\n      _arrayWithHoles(arr) ||\n      _iterableToArrayLimitLoose(arr, i) ||\n      _nonIterableRest()\n    );\n  }\n\n  function _toArray(arr) {\n    return _arrayWithHoles(arr) || _iterableToArray(arr) || _nonIterableRest();\n  }\n\n  function _toConsumableArray(arr) {\n    return (\n      _arrayWithoutHoles(arr) || _iterableToArray(arr) || _nonIterableSpread()\n    );\n  }\n\n  function _arrayWithoutHoles(arr) {\n    if (Array.isArray(arr)) {\n      for (var i = 0, arr2 = new Array(arr.length); i < arr.length; i++)\n        arr2[i] = arr[i];\n\n      return arr2;\n    }\n  }\n\n  function _arrayWithHoles(arr) {\n    if (Array.isArray(arr)) return arr;\n  }\n\n  function _iterableToArray(iter) {\n    if (\n      Symbol.iterator in Object(iter) ||\n      Object.prototype.toString.call(iter) === '[object Arguments]'\n    )\n      return Array.from(iter);\n  }\n\n  function _iterableToArrayLimit(arr, i) {\n    var _arr = [];\n    var _n = true;\n    var _d = false;\n    var _e = undefined;\n\n    try {\n      for (\n        var _i = arr[Symbol.iterator](), _s;\n        !(_n = (_s = _i.next()).done);\n        _n = true\n      ) {\n        _arr.push(_s.value);\n\n        if (i && _arr.length === i) break;\n      }\n    } catch (err) {\n      _d = true;\n      _e = err;\n    } finally {\n      try {\n        if (!_n && _i['return'] != null) _i['return']();\n      } finally {\n        if (_d) throw _e;\n      }\n    }\n\n    return _arr;\n  }\n\n  function _iterableToArrayLimitLoose(arr, i) {\n    var _arr = [];\n\n    for (\n      var _iterator = arr[Symbol.iterator](), _step;\n      !(_step = _iterator.next()).done;\n\n    ) {\n      _arr.push(_step.value);\n\n      if (i && _arr.length === i) break;\n    }\n\n    return _arr;\n  }\n\n  function _nonIterableSpread() {\n    throw new TypeError('Invalid attempt to spread non-iterable instance');\n  }\n\n  function _nonIterableRest() {\n    throw new TypeError('Invalid attempt to destructure non-iterable instance');\n  }\n\n  function _skipFirstGeneratorNext(fn) {\n    return function() {\n      var it = fn.apply(this, arguments);\n      it.next();\n      return it;\n    };\n  }\n\n  function _toPrimitive(input, hint) {\n    if (typeof input !== 'object' || input === null) return input;\n    var prim = input[Symbol.toPrimitive];\n\n    if (prim !== undefined) {\n      var res = prim.call(input, hint || 'default');\n      if (typeof res !== 'object') return res;\n      throw new TypeError('@@toPrimitive must return a primitive value.');\n    }\n\n    return (hint === 'string' ? String : Number)(input);\n  }\n\n  function _toPropertyKey(arg) {\n    var key = _toPrimitive(arg, 'string');\n\n    return typeof key === 'symbol' ? key : String(key);\n  }\n\n  function _initializerWarningHelper(descriptor, context) {\n    throw new Error(\n      'Decorating class property failed. Please ensure that ' +\n        'proposal-class-properties is enabled and set to use loose mode. ' +\n        'To use proposal-class-properties in spec mode with decorators, wait for ' +\n        'the next major version of decorators in stage 2.'\n    );\n  }\n\n  function _initializerDefineProperty(target, property, descriptor, context) {\n    if (!descriptor) return;\n    Object.defineProperty(target, property, {\n      enumerable: descriptor.enumerable,\n      configurable: descriptor.configurable,\n      writable: descriptor.writable,\n      value: descriptor.initializer\n        ? descriptor.initializer.call(context)\n        : void 0\n    });\n  }\n\n  function _applyDecoratedDescriptor(\n    target,\n    property,\n    decorators,\n    descriptor,\n    context\n  ) {\n    var desc = {};\n    Object.keys(descriptor).forEach(function(key) {\n      desc[key] = descriptor[key];\n    });\n    desc.enumerable = !!desc.enumerable;\n    desc.configurable = !!desc.configurable;\n\n    if ('value' in desc || desc.initializer) {\n      desc.writable = true;\n    }\n\n    desc = decorators\n      .slice()\n      .reverse()\n      .reduce(function(desc, decorator) {\n        return decorator(target, property, desc) || desc;\n      }, desc);\n\n    if (context && desc.initializer !== void 0) {\n      desc.value = desc.initializer ? desc.initializer.call(context) : void 0;\n      desc.initializer = undefined;\n    }\n\n    if (desc.initializer === void 0) {\n      Object.defineProperty(target, property, desc);\n      desc = null;\n    }\n\n    return desc;\n  }\n\n  var id = 0;\n\n  function _classPrivateFieldLooseKey(name) {\n    return '__private_' + id++ + '_' + name;\n  }\n\n  function _classPrivateFieldLooseBase(receiver, privateKey) {\n    if (!Object.prototype.hasOwnProperty.call(receiver, privateKey)) {\n      throw new TypeError('attempted to use private field on non-instance');\n    }\n\n    return receiver;\n  }\n\n  function _classPrivateFieldGet(receiver, privateMap) {\n    if (!privateMap.has(receiver)) {\n      throw new TypeError('attempted to get private field on non-instance');\n    }\n\n    var descriptor = privateMap.get(receiver);\n\n    if (descriptor.get) {\n      return descriptor.get.call(receiver);\n    }\n\n    return descriptor.value;\n  }\n\n  function _classPrivateFieldSet(receiver, privateMap, value) {\n    if (!privateMap.has(receiver)) {\n      throw new TypeError('attempted to set private field on non-instance');\n    }\n\n    var descriptor = privateMap.get(receiver);\n\n    if (descriptor.set) {\n      descriptor.set.call(receiver, value);\n    } else {\n      if (!descriptor.writable) {\n        throw new TypeError('attempted to set read only private field');\n      }\n\n      descriptor.value = value;\n    }\n\n    return value;\n  }\n\n  function _classStaticPrivateFieldSpecGet(\n    receiver,\n    classConstructor,\n    descriptor\n  ) {\n    if (receiver !== classConstructor) {\n      throw new TypeError('Private static access of wrong provenance');\n    }\n\n    return descriptor.value;\n  }\n\n  function _classStaticPrivateFieldSpecSet(\n    receiver,\n    classConstructor,\n    descriptor,\n    value\n  ) {\n    if (receiver !== classConstructor) {\n      throw new TypeError('Private static access of wrong provenance');\n    }\n\n    if (!descriptor.writable) {\n      throw new TypeError('attempted to set read only private field');\n    }\n\n    descriptor.value = value;\n    return value;\n  }\n\n  function _classStaticPrivateMethodGet(receiver, classConstructor, method) {\n    if (receiver !== classConstructor) {\n      throw new TypeError('Private static access of wrong provenance');\n    }\n\n    return method;\n  }\n\n  function _classStaticPrivateMethodSet() {\n    throw new TypeError('attempted to set read only static private field');\n  }\n\n  function _decorate(decorators, factory, superClass, mixins) {\n    var api = _getDecoratorsApi();\n\n    if (mixins) {\n      for (var i = 0; i < mixins.length; i++) {\n        api = mixins[i](api);\n      }\n    }\n\n    var r = factory(function initialize(O) {\n      api.initializeInstanceElements(O, decorated.elements);\n    }, superClass);\n    var decorated = api.decorateClass(\n      _coalesceClassElements(r.d.map(_createElementDescriptor)),\n      decorators\n    );\n    api.initializeClassElements(r.F, decorated.elements);\n    return api.runClassFinishers(r.F, decorated.finishers);\n  }\n\n  function _getDecoratorsApi() {\n    _getDecoratorsApi = function() {\n      return api;\n    };\n\n    var api = {\n      elementsDefinitionOrder: [['method'], ['field']],\n      initializeInstanceElements: function(O, elements) {\n        ['method', 'field'].forEach(function(kind) {\n          elements.forEach(function(element) {\n            if (element.kind === kind && element.placement === 'own') {\n              this.defineClassElement(O, element);\n            }\n          }, this);\n        }, this);\n      },\n      initializeClassElements: function(F, elements) {\n        var proto = F.prototype;\n        ['method', 'field'].forEach(function(kind) {\n          elements.forEach(function(element) {\n            var placement = element.placement;\n\n            if (\n              element.kind === kind &&\n              (placement === 'static' || placement === 'prototype')\n            ) {\n              var receiver = placement === 'static' ? F : proto;\n              this.defineClassElement(receiver, element);\n            }\n          }, this);\n        }, this);\n      },\n      defineClassElement: function(receiver, element) {\n        var descriptor = element.descriptor;\n\n        if (element.kind === 'field') {\n          var initializer = element.initializer;\n          descriptor = {\n            enumerable: descriptor.enumerable,\n            writable: descriptor.writable,\n            configurable: descriptor.configurable,\n            value: initializer === void 0 ? void 0 : initializer.call(receiver)\n          };\n        }\n\n        Object.defineProperty(receiver, element.key, descriptor);\n      },\n      decorateClass: function(elements, decorators) {\n        var newElements = [];\n        var finishers = [];\n        var placements = {\n          static: [],\n          prototype: [],\n          own: []\n        };\n        elements.forEach(function(element) {\n          this.addElementPlacement(element, placements);\n        }, this);\n        elements.forEach(function(element) {\n          if (!_hasDecorators(element)) return newElements.push(element);\n          var elementFinishersExtras = this.decorateElement(\n            element,\n            placements\n          );\n          newElements.push(elementFinishersExtras.element);\n          newElements.push.apply(newElements, elementFinishersExtras.extras);\n          finishers.push.apply(finishers, elementFinishersExtras.finishers);\n        }, this);\n\n        if (!decorators) {\n          return {\n            elements: newElements,\n            finishers: finishers\n          };\n        }\n\n        var result = this.decorateConstructor(newElements, decorators);\n        finishers.push.apply(finishers, result.finishers);\n        result.finishers = finishers;\n        return result;\n      },\n      addElementPlacement: function(element, placements, silent) {\n        var keys = placements[element.placement];\n\n        if (!silent && keys.indexOf(element.key) !== -1) {\n          throw new TypeError('Duplicated element (' + element.key + ')');\n        }\n\n        keys.push(element.key);\n      },\n      decorateElement: function(element, placements) {\n        var extras = [];\n        var finishers = [];\n\n        for (\n          var decorators = element.decorators, i = decorators.length - 1;\n          i >= 0;\n          i--\n        ) {\n          var keys = placements[element.placement];\n          keys.splice(keys.indexOf(element.key), 1);\n          var elementObject = this.fromElementDescriptor(element);\n          var elementFinisherExtras = this.toElementFinisherExtras(\n            (0, decorators[i])(elementObject) || elementObject\n          );\n          element = elementFinisherExtras.element;\n          this.addElementPlacement(element, placements);\n\n          if (elementFinisherExtras.finisher) {\n            finishers.push(elementFinisherExtras.finisher);\n          }\n\n          var newExtras = elementFinisherExtras.extras;\n\n          if (newExtras) {\n            for (var j = 0; j < newExtras.length; j++) {\n              this.addElementPlacement(newExtras[j], placements);\n            }\n\n            extras.push.apply(extras, newExtras);\n          }\n        }\n\n        return {\n          element: element,\n          finishers: finishers,\n          extras: extras\n        };\n      },\n      decorateConstructor: function(elements, decorators) {\n        var finishers = [];\n\n        for (var i = decorators.length - 1; i >= 0; i--) {\n          var obj = this.fromClassDescriptor(elements);\n          var elementsAndFinisher = this.toClassDescriptor(\n            (0, decorators[i])(obj) || obj\n          );\n\n          if (elementsAndFinisher.finisher !== undefined) {\n            finishers.push(elementsAndFinisher.finisher);\n          }\n\n          if (elementsAndFinisher.elements !== undefined) {\n            elements = elementsAndFinisher.elements;\n\n            for (var j = 0; j < elements.length - 1; j++) {\n              for (var k = j + 1; k < elements.length; k++) {\n                if (\n                  elements[j].key === elements[k].key &&\n                  elements[j].placement === elements[k].placement\n                ) {\n                  throw new TypeError(\n                    'Duplicated element (' + elements[j].key + ')'\n                  );\n                }\n              }\n            }\n          }\n        }\n\n        return {\n          elements: elements,\n          finishers: finishers\n        };\n      },\n      fromElementDescriptor: function(element) {\n        var obj = {\n          kind: element.kind,\n          key: element.key,\n          placement: element.placement,\n          descriptor: element.descriptor\n        };\n        var desc = {\n          value: 'Descriptor',\n          configurable: true\n        };\n        Object.defineProperty(obj, Symbol.toStringTag, desc);\n        if (element.kind === 'field') obj.initializer = element.initializer;\n        return obj;\n      },\n      toElementDescriptors: function(elementObjects) {\n        if (elementObjects === undefined) return;\n        return _toArray(elementObjects).map(function(elementObject) {\n          var element = this.toElementDescriptor(elementObject);\n          this.disallowProperty(\n            elementObject,\n            'finisher',\n            'An element descriptor'\n          );\n          this.disallowProperty(\n            elementObject,\n            'extras',\n            'An element descriptor'\n          );\n          return element;\n        }, this);\n      },\n      toElementDescriptor: function(elementObject) {\n        var kind = String(elementObject.kind);\n\n        if (kind !== 'method' && kind !== 'field') {\n          throw new TypeError(\n            'An element descriptor\\'s .kind property must be either \"method\" or' +\n              ' \"field\", but a decorator created an element descriptor with' +\n              ' .kind \"' +\n              kind +\n              '\"'\n          );\n        }\n\n        var key = _toPropertyKey(elementObject.key);\n\n        var placement = String(elementObject.placement);\n\n        if (\n          placement !== 'static' &&\n          placement !== 'prototype' &&\n          placement !== 'own'\n        ) {\n          throw new TypeError(\n            'An element descriptor\\'s .placement property must be one of \"static\",' +\n              ' \"prototype\" or \"own\", but a decorator created an element descriptor' +\n              ' with .placement \"' +\n              placement +\n              '\"'\n          );\n        }\n\n        var descriptor = elementObject.descriptor;\n        this.disallowProperty(\n          elementObject,\n          'elements',\n          'An element descriptor'\n        );\n        var element = {\n          kind: kind,\n          key: key,\n          placement: placement,\n          descriptor: Object.assign({}, descriptor)\n        };\n\n        if (kind !== 'field') {\n          this.disallowProperty(\n            elementObject,\n            'initializer',\n            'A method descriptor'\n          );\n        } else {\n          this.disallowProperty(\n            descriptor,\n            'get',\n            'The property descriptor of a field descriptor'\n          );\n          this.disallowProperty(\n            descriptor,\n            'set',\n            'The property descriptor of a field descriptor'\n          );\n          this.disallowProperty(\n            descriptor,\n            'value',\n            'The property descriptor of a field descriptor'\n          );\n          element.initializer = elementObject.initializer;\n        }\n\n        return element;\n      },\n      toElementFinisherExtras: function(elementObject) {\n        var element = this.toElementDescriptor(elementObject);\n\n        var finisher = _optionalCallableProperty(elementObject, 'finisher');\n\n        var extras = this.toElementDescriptors(elementObject.extras);\n        return {\n          element: element,\n          finisher: finisher,\n          extras: extras\n        };\n      },\n      fromClassDescriptor: function(elements) {\n        var obj = {\n          kind: 'class',\n          elements: elements.map(this.fromElementDescriptor, this)\n        };\n        var desc = {\n          value: 'Descriptor',\n          configurable: true\n        };\n        Object.defineProperty(obj, Symbol.toStringTag, desc);\n        return obj;\n      },\n      toClassDescriptor: function(obj) {\n        var kind = String(obj.kind);\n\n        if (kind !== 'class') {\n          throw new TypeError(\n            'A class descriptor\\'s .kind property must be \"class\", but a decorator' +\n              ' created a class descriptor with .kind \"' +\n              kind +\n              '\"'\n          );\n        }\n\n        this.disallowProperty(obj, 'key', 'A class descriptor');\n        this.disallowProperty(obj, 'placement', 'A class descriptor');\n        this.disallowProperty(obj, 'descriptor', 'A class descriptor');\n        this.disallowProperty(obj, 'initializer', 'A class descriptor');\n        this.disallowProperty(obj, 'extras', 'A class descriptor');\n\n        var finisher = _optionalCallableProperty(obj, 'finisher');\n\n        var elements = this.toElementDescriptors(obj.elements);\n        return {\n          elements: elements,\n          finisher: finisher\n        };\n      },\n      runClassFinishers: function(constructor, finishers) {\n        for (var i = 0; i < finishers.length; i++) {\n          var newConstructor = (0, finishers[i])(constructor);\n\n          if (newConstructor !== undefined) {\n            if (typeof newConstructor !== 'function') {\n              throw new TypeError('Finishers must return a constructor.');\n            }\n\n            constructor = newConstructor;\n          }\n        }\n\n        return constructor;\n      },\n      disallowProperty: function(obj, name, objectType) {\n        if (obj[name] !== undefined) {\n          throw new TypeError(\n            objectType + \" can't have a .\" + name + ' property.'\n          );\n        }\n      }\n    };\n    return api;\n  }\n\n  function _createElementDescriptor(def) {\n    var key = _toPropertyKey(def.key);\n\n    var descriptor;\n\n    if (def.kind === 'method') {\n      descriptor = {\n        value: def.value,\n        writable: true,\n        configurable: true,\n        enumerable: false\n      };\n    } else if (def.kind === 'get') {\n      descriptor = {\n        get: def.value,\n        configurable: true,\n        enumerable: false\n      };\n    } else if (def.kind === 'set') {\n      descriptor = {\n        set: def.value,\n        configurable: true,\n        enumerable: false\n      };\n    } else if (def.kind === 'field') {\n      descriptor = {\n        configurable: true,\n        writable: true,\n        enumerable: true\n      };\n    }\n\n    var element = {\n      kind: def.kind === 'field' ? 'field' : 'method',\n      key: key,\n      placement: def.static\n        ? 'static'\n        : def.kind === 'field'\n        ? 'own'\n        : 'prototype',\n      descriptor: descriptor\n    };\n    if (def.decorators) element.decorators = def.decorators;\n    if (def.kind === 'field') element.initializer = def.value;\n    return element;\n  }\n\n  function _coalesceGetterSetter(element, other) {\n    if (element.descriptor.get !== undefined) {\n      other.descriptor.get = element.descriptor.get;\n    } else {\n      other.descriptor.set = element.descriptor.set;\n    }\n  }\n\n  function _coalesceClassElements(elements) {\n    var newElements = [];\n\n    var isSameElement = function(other) {\n      return (\n        other.kind === 'method' &&\n        other.key === element.key &&\n        other.placement === element.placement\n      );\n    };\n\n    for (var i = 0; i < elements.length; i++) {\n      var element = elements[i];\n      var other;\n\n      if (\n        element.kind === 'method' &&\n        (other = newElements.find(isSameElement))\n      ) {\n        if (\n          _isDataDescriptor(element.descriptor) ||\n          _isDataDescriptor(other.descriptor)\n        ) {\n          if (_hasDecorators(element) || _hasDecorators(other)) {\n            throw new ReferenceError(\n              'Duplicated methods (' + element.key + \") can't be decorated.\"\n            );\n          }\n\n          other.descriptor = element.descriptor;\n        } else {\n          if (_hasDecorators(element)) {\n            if (_hasDecorators(other)) {\n              throw new ReferenceError(\n                \"Decorators can't be placed on different accessors with for \" +\n                  'the same property (' +\n                  element.key +\n                  ').'\n              );\n            }\n\n            other.decorators = element.decorators;\n          }\n\n          _coalesceGetterSetter(element, other);\n        }\n      } else {\n        newElements.push(element);\n      }\n    }\n\n    return newElements;\n  }\n\n  function _hasDecorators(element) {\n    return element.decorators && element.decorators.length;\n  }\n\n  function _isDataDescriptor(desc) {\n    return (\n      desc !== undefined &&\n      !(desc.value === undefined && desc.writable === undefined)\n    );\n  }\n\n  function _optionalCallableProperty(obj, name) {\n    var value = obj[name];\n\n    if (value !== undefined && typeof value !== 'function') {\n      throw new TypeError(\"Expected '\" + name + \"' to be a function\");\n    }\n\n    return value;\n  }\n\n  function _classPrivateMethodGet(receiver, privateSet, fn) {\n    if (!privateSet.has(receiver)) {\n      throw new TypeError('attempted to get private field on non-instance');\n    }\n\n    return fn;\n  }\n\n  function _classPrivateMethodSet() {\n    throw new TypeError('attempted to reassign private method');\n  }\n\n  function _wrapRegExp(re, groups) {\n    _wrapRegExp = function(re, groups) {\n      return new BabelRegExp(re, groups);\n    };\n\n    var _RegExp = _wrapNativeSuper(RegExp);\n\n    var _super = RegExp.prototype;\n\n    var _groups = new WeakMap();\n\n    function BabelRegExp(re, groups) {\n      var _this = _RegExp.call(this, re);\n\n      _groups.set(_this, groups);\n\n      return _this;\n    }\n\n    _inherits(BabelRegExp, _RegExp);\n\n    BabelRegExp.prototype.exec = function(str) {\n      var result = _super.exec.call(this, str);\n\n      if (result) result.groups = buildGroups(result, this);\n      return result;\n    };\n\n    BabelRegExp.prototype[Symbol.replace] = function(str, substitution) {\n      if (typeof substitution === 'string') {\n        var groups = _groups.get(this);\n\n        return _super[Symbol.replace].call(\n          this,\n          str,\n          substitution.replace(/\\$<([^>]+)>/g, function(_, name) {\n            return '$' + groups[name];\n          })\n        );\n      } else if (typeof substitution === 'function') {\n        var _this = this;\n\n        return _super[Symbol.replace].call(this, str, function() {\n          var args = [];\n          args.push.apply(args, arguments);\n\n          if (typeof args[args.length - 1] !== 'object') {\n            args.push(buildGroups(args, _this));\n          }\n\n          return substitution.apply(this, args);\n        });\n      } else {\n        return _super[Symbol.replace].call(this, str, substitution);\n      }\n    };\n\n    function buildGroups(result, re) {\n      var g = _groups.get(re);\n\n      return Object.keys(g).reduce(function(groups, name) {\n        groups[name] = result[g[name]];\n        return groups;\n      }, Object.create(null));\n    }\n\n    return _wrapRegExp.apply(this, arguments);\n  }\n\n  var MARKUP_RECT = [\n    'x',\n    'y',\n    'left',\n    'top',\n    'right',\n    'bottom',\n    'width',\n    'height'\n  ];\n\n  var toOptionalFraction = function toOptionalFraction(value) {\n    return typeof value === 'string' && /%/.test(value)\n      ? parseFloat(value) / 100\n      : value;\n  };\n\n  // adds default markup properties, clones markup\n  var prepareMarkup = function prepareMarkup(markup) {\n    var _markup = _slicedToArray(markup, 2),\n      type = _markup[0],\n      props = _markup[1];\n\n    var rect = props.points\n      ? {}\n      : MARKUP_RECT.reduce(function(prev, curr) {\n          prev[curr] = toOptionalFraction(props[curr]);\n          return prev;\n        }, {});\n\n    return [\n      type,\n      Object.assign(\n        {\n          zIndex: 0\n        },\n        props,\n        rect\n      )\n    ];\n  };\n\n  var getImageSize = function getImageSize(file) {\n    return new Promise(function(resolve, reject) {\n      var imageElement = new Image();\n      imageElement.src = URL.createObjectURL(file);\n\n      // start testing size\n      var measure = function measure() {\n        var width = imageElement.naturalWidth;\n        var height = imageElement.naturalHeight;\n        var hasSize = width && height;\n        if (!hasSize) return;\n\n        URL.revokeObjectURL(imageElement.src);\n        clearInterval(intervalId);\n        resolve({ width: width, height: height });\n      };\n\n      imageElement.onerror = function(err) {\n        URL.revokeObjectURL(imageElement.src);\n        clearInterval(intervalId);\n        reject(err);\n      };\n\n      var intervalId = setInterval(measure, 1);\n\n      measure();\n    });\n  };\n\n  /**\n   * Polyfill Edge and IE when in Browser\n   */\n  if (typeof window !== 'undefined' && typeof window.document !== 'undefined') {\n    if (!HTMLCanvasElement.prototype.toBlob) {\n      Object.defineProperty(HTMLCanvasElement.prototype, 'toBlob', {\n        value: function value(cb, type, quality) {\n          var canvas = this;\n          setTimeout(function() {\n            var dataURL = canvas.toDataURL(type, quality).split(',')[1];\n            var binStr = atob(dataURL);\n            var index = binStr.length;\n            var data = new Uint8Array(index);\n            while (index--) {\n              data[index] = binStr.charCodeAt(index);\n            }\n            cb(new Blob([data], { type: type || 'image/png' }));\n          });\n        }\n      });\n    }\n  }\n\n  var isBrowser =\n    typeof window !== 'undefined' && typeof window.document !== 'undefined';\n  var isIOS =\n    isBrowser &&\n    /iPad|iPhone|iPod/.test(navigator.userAgent) &&\n    !window.MSStream;\n\n  /**\n   * Image Transform Plugin\n   */\n  var plugin = function plugin(_ref) {\n    var addFilter = _ref.addFilter,\n      utils = _ref.utils;\n    var Type = utils.Type,\n      forin = utils.forin,\n      getFileFromBlob = utils.getFileFromBlob,\n      isFile = utils.isFile;\n\n    /**\n     * Helper functions\n     */\n\n    // valid transforms (in correct order)\n    var TRANSFORM_LIST = ['crop', 'resize', 'filter', 'markup', 'output'];\n\n    var createVariantCreator = function createVariantCreator(updateMetadata) {\n      return function(transform, file, metadata) {\n        return transform(\n          file,\n          updateMetadata ? updateMetadata(metadata) : metadata\n        );\n      };\n    };\n\n    var isDefaultCrop = function isDefaultCrop(crop) {\n      return (\n        crop.aspectRatio === null &&\n        crop.rotation === 0 &&\n        crop.zoom === 1 &&\n        crop.center &&\n        crop.center.x === 0.5 &&\n        crop.center.y === 0.5 &&\n        crop.flip &&\n        crop.flip.horizontal === false &&\n        crop.flip.vertical === false\n      );\n    };\n\n    /**\n     * Filters\n     */\n    addFilter('SHOULD_PREPARE_OUTPUT', function(shouldPrepareOutput, _ref2) {\n      var query = _ref2.query;\n      return new Promise(function(resolve) {\n        // If is not async should prepare now\n        resolve(!query('IS_ASYNC'));\n      });\n    });\n\n    var shouldTransformFile = function shouldTransformFile(query, file, item) {\n      return new Promise(function(resolve) {\n        if (\n          !query('GET_ALLOW_IMAGE_TRANSFORM') ||\n          item.archived ||\n          !isFile(file) ||\n          !isImage(file)\n        ) {\n          return resolve(false);\n        }\n\n        // if size can't be read this browser doesn't support image\n        getImageSize(file)\n          .then(function() {\n            var fn = query('GET_IMAGE_TRANSFORM_IMAGE_FILTER');\n            if (fn) {\n              var filterResult = fn(file);\n              if (filterResult == null) {\n                // undefined or null\n                return handleRevert(true);\n              }\n              if (typeof filterResult === 'boolean') {\n                return resolve(filterResult);\n              }\n              if (typeof filterResult.then === 'function') {\n                return filterResult.then(resolve);\n              }\n            }\n\n            resolve(true);\n          })\n          .catch(function(err) {\n            resolve(false);\n          });\n      });\n    };\n\n    // subscribe to file transformations\n    addFilter('PREPARE_OUTPUT', function(file, _ref3) {\n      var query = _ref3.query,\n        item = _ref3.item;\n      return new Promise(function(resolve) {\n        shouldTransformFile(query, file, item).then(function(shouldTransform) {\n          // no need to transform, exit\n          if (!shouldTransform) return resolve(file);\n\n          // get variants\n          var variants = [];\n\n          // add original file\n          if (query('GET_IMAGE_TRANSFORM_VARIANTS_INCLUDE_ORIGINAL')) {\n            variants.push(function() {\n              return new Promise(function(resolve) {\n                resolve({\n                  name: query('GET_IMAGE_TRANSFORM_VARIANTS_ORIGINAL_NAME'),\n                  file: file\n                });\n              });\n            });\n          }\n\n          // add default output version if output default set to true or if no variants defined\n          if (query('GET_IMAGE_TRANSFORM_VARIANTS_INCLUDE_DEFAULT')) {\n            variants.push(function(transform, file, metadata) {\n              return new Promise(function(resolve) {\n                transform(file, metadata).then(function(file) {\n                  return resolve({\n                    name: query('GET_IMAGE_TRANSFORM_VARIANTS_DEFAULT_NAME'),\n                    file: file\n                  });\n                });\n              });\n            });\n          }\n\n          // get other variants\n          var variantsDefinition = query('GET_IMAGE_TRANSFORM_VARIANTS') || {};\n          forin(variantsDefinition, function(key, fn) {\n            var createVariant = createVariantCreator(fn);\n            variants.push(function(transform, file, metadata) {\n              return new Promise(function(resolve) {\n                createVariant(transform, file, metadata).then(function(file) {\n                  return resolve({ name: key, file: file });\n                });\n              });\n            });\n          });\n\n          // output format (quality 0 => 100)\n          var qualityAsPercentage = query('GET_IMAGE_TRANSFORM_OUTPUT_QUALITY');\n          var qualityMode = query('GET_IMAGE_TRANSFORM_OUTPUT_QUALITY_MODE');\n          var quality =\n            qualityAsPercentage === null ? null : qualityAsPercentage / 100;\n          var type = query('GET_IMAGE_TRANSFORM_OUTPUT_MIME_TYPE');\n          var clientTransforms =\n            query('GET_IMAGE_TRANSFORM_CLIENT_TRANSFORMS') || TRANSFORM_LIST;\n\n          // update transform metadata object\n          item.setMetadata(\n            'output',\n            {\n              type: type,\n              quality: quality,\n              client: clientTransforms\n            },\n            true\n          );\n\n          // the function that is used to apply the file transformations\n          var transform = function transform(file, metadata) {\n            return new Promise(function(resolve, reject) {\n              var filteredMetadata = Object.assign({}, metadata);\n\n              Object.keys(filteredMetadata)\n                .filter(function(instruction) {\n                  return instruction !== 'exif';\n                })\n                .forEach(function(instruction) {\n                  // if not in list, remove from object, the instruction will be handled by the server\n                  if (clientTransforms.indexOf(instruction) === -1) {\n                    delete filteredMetadata[instruction];\n                  }\n                });\n              var resize = filteredMetadata.resize,\n                exif = filteredMetadata.exif,\n                output = filteredMetadata.output,\n                crop = filteredMetadata.crop,\n                filter = filteredMetadata.filter,\n                markup = filteredMetadata.markup;\n\n              var instructions = {\n                image: {\n                  orientation: exif ? exif.orientation : null\n                },\n\n                output:\n                  output &&\n                  (output.type ||\n                    typeof output.quality === 'number' ||\n                    output.background)\n                    ? {\n                        type: output.type,\n                        quality:\n                          typeof output.quality === 'number'\n                            ? output.quality * 100\n                            : null,\n                        background:\n                          output.background ||\n                          query(\n                            'GET_IMAGE_TRANSFORM_CANVAS_BACKGROUND_COLOR'\n                          ) ||\n                          null\n                      }\n                    : undefined,\n                size:\n                  resize && (resize.size.width || resize.size.height)\n                    ? Object.assign(\n                        {\n                          mode: resize.mode,\n                          upscale: resize.upscale\n                        },\n                        resize.size\n                      )\n                    : undefined,\n                crop:\n                  crop && !isDefaultCrop(crop)\n                    ? Object.assign({}, crop)\n                    : undefined,\n                markup:\n                  markup && markup.length ? markup.map(prepareMarkup) : [],\n                filter: filter\n              };\n\n              if (instructions.output) {\n                // determine if file type will change\n                var willChangeType = output.type\n                  ? // type set\n                    output.type !== file.type\n                  : // type not set\n                    false;\n\n                var canChangeQuality = /\\/jpe?g$/.test(file.type);\n                var willChangeQuality =\n                  output.quality !== null\n                    ? // quality set\n                      canChangeQuality && qualityMode === 'always'\n                    : // quality not set\n                      false;\n\n                // determine if file data will be modified\n                var willModifyImageData = !!(\n                  instructions.size ||\n                  instructions.crop ||\n                  instructions.filter ||\n                  willChangeType ||\n                  willChangeQuality\n                );\n\n                // if we're not modifying the image data then we don't have to modify the output\n                if (!willModifyImageData) return resolve(file);\n              }\n\n              var options = {\n                beforeCreateBlob: query(\n                  'GET_IMAGE_TRANSFORM_BEFORE_CREATE_BLOB'\n                ),\n                afterCreateBlob: query('GET_IMAGE_TRANSFORM_AFTER_CREATE_BLOB'),\n                canvasMemoryLimit: query(\n                  'GET_IMAGE_TRANSFORM_CANVAS_MEMORY_LIMIT'\n                ),\n                stripImageHead: query(\n                  'GET_IMAGE_TRANSFORM_OUTPUT_STRIP_IMAGE_HEAD'\n                )\n              };\n\n              transformImage(file, instructions, options)\n                .then(function(blob) {\n                  // set file object\n                  var out = getFileFromBlob(\n                    blob,\n                    // rename the original filename to match the mime type of the output image\n                    renameFileToMatchMimeType(\n                      file.name,\n                      getValidOutputMimeType(blob.type)\n                    )\n                  );\n\n                  resolve(out);\n                })\n                .catch(reject);\n            });\n          };\n\n          // start creating variants\n          var variantPromises = variants.map(function(create) {\n            return create(transform, file, item.getMetadata());\n          });\n\n          // wait for results\n          Promise.all(variantPromises).then(function(files) {\n            // if single file object in array, return the single file object else, return array of\n            resolve(\n              files.length === 1 && files[0].name === null\n                ? // return the File object\n                  files[0].file\n                : // return an array of files { name:'name', file:File }\n                  files\n            );\n          });\n        });\n      });\n    });\n\n    // Expose plugin options\n    return {\n      options: {\n        allowImageTransform: [true, Type.BOOLEAN],\n\n        // filter images to transform\n        imageTransformImageFilter: [null, Type.FUNCTION],\n\n        // null, 'image/jpeg', 'image/png'\n        imageTransformOutputMimeType: [null, Type.STRING],\n\n        // null, 0 - 100\n        imageTransformOutputQuality: [null, Type.INT],\n\n        // set to false to copy image exif data to output\n        imageTransformOutputStripImageHead: [true, Type.BOOLEAN],\n\n        // only apply transforms in this list\n        imageTransformClientTransforms: [null, Type.ARRAY],\n\n        // only apply output quality when a transform is required\n        imageTransformOutputQualityMode: ['always', Type.STRING],\n        // 'always'\n        // 'optional'\n        // 'mismatch' (future feature, only applied if quality differs from input)\n\n        // get image transform variants\n        imageTransformVariants: [null, Type.OBJECT],\n\n        // should we post the default transformed file\n        imageTransformVariantsIncludeDefault: [true, Type.BOOLEAN],\n\n        // which name to prefix the default transformed file with\n        imageTransformVariantsDefaultName: [null, Type.STRING],\n\n        // should we post the original file\n        imageTransformVariantsIncludeOriginal: [false, Type.BOOLEAN],\n\n        // which name to prefix the original file with\n        imageTransformVariantsOriginalName: ['original_', Type.STRING],\n\n        // called before creating the blob, receives canvas, expects promise resolve with canvas\n        imageTransformBeforeCreateBlob: [null, Type.FUNCTION],\n\n        // expects promise resolved with blob\n        imageTransformAfterCreateBlob: [null, Type.FUNCTION],\n\n        // canvas memory limit\n        imageTransformCanvasMemoryLimit: [\n          isBrowser && isIOS ? 4096 * 4096 : null,\n          Type.INT\n        ],\n\n        // background image of the output canvas\n        imageTransformCanvasBackgroundColor: [null, Type.STRING]\n      }\n    };\n  };\n\n  // fire pluginloaded event if running in browser, this allows registering the plugin when using async script tags\n  if (isBrowser) {\n    document.dispatchEvent(\n      new CustomEvent('FilePond:pluginloaded', { detail: plugin })\n    );\n  }\n\n  return plugin;\n});\n"]},"metadata":{},"sourceType":"script"}